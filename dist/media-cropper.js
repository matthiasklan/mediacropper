!function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}(function(modules){for(var i in modules)if(Object.prototype.hasOwnProperty.call(modules,i))switch(typeof modules[i]){case"function":break;case"object":modules[i]=function(_m){var args=_m.slice(1),fn=modules[_m[0]];return function(a,b,c){fn.apply(this,[a,b,c].concat(args))}}(modules[i]);break;default:modules[i]=modules[modules[i]]}return modules}([function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var _mediaCropper=__webpack_require__(17),_mediaCropper2=_interopRequireDefault(_mediaCropper);window.MediaCropper=_mediaCropper2["default"]},function(module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},function(module,exports,__webpack_require__){(function(process){function Duplex(options){return this instanceof Duplex?(Readable.call(this,options),Writable.call(this,options),options&&options.readable===!1&&(this.readable=!1),options&&options.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,options&&options.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",onend)):new Duplex(options)}function onend(){this.allowHalfOpen||this._writableState.ended||process.nextTick(this.end.bind(this))}function forEach(xs,f){for(var i=0,l=xs.length;l>i;i++)f(xs[i],i)}module.exports=Duplex;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys},util=__webpack_require__(6);util.inherits=__webpack_require__(1);var Readable=__webpack_require__(13),Writable=__webpack_require__(9);util.inherits(Duplex,Readable),forEach(objectKeys(Writable.prototype),function(method){Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])})}).call(exports,__webpack_require__(4))},function(module,exports,__webpack_require__){(function(Buffer,global){/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
"use strict";function typedArraySupport(){function Bar(){}try{var arr=new Uint8Array(1);return arr.foo=function(){return 42},arr.constructor=Bar,42===arr.foo()&&arr.constructor===Bar&&"function"==typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return!1}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Buffer(arg){return this instanceof Buffer?(Buffer.TYPED_ARRAY_SUPPORT||(this.length=0,this.parent=void 0),"number"==typeof arg?fromNumber(this,arg):"string"==typeof arg?fromString(this,arg,arguments.length>1?arguments[1]:"utf8"):fromObject(this,arg)):arguments.length>1?new Buffer(arg,arguments[1]):new Buffer(arg)}function fromNumber(that,length){if(that=allocate(that,0>length?0:0|checked(length)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;length>i;i++)that[i]=0;return that}function fromString(that,string,encoding){"string"==typeof encoding&&""!==encoding||(encoding="utf8");var length=0|byteLength(string,encoding);return that=allocate(that,length),that.write(string,encoding),that}function fromObject(that,object){if(Buffer.isBuffer(object))return fromBuffer(that,object);if(isArray(object))return fromArray(that,object);if(null==object)throw new TypeError("must start with number, buffer, array or string");if("undefined"!=typeof ArrayBuffer){if(object.buffer instanceof ArrayBuffer)return fromTypedArray(that,object);if(object instanceof ArrayBuffer)return fromArrayBuffer(that,object)}return object.length?fromArrayLike(that,object):fromJsonObject(that,object)}function fromBuffer(that,buffer){var length=0|checked(buffer.length);return that=allocate(that,length),buffer.copy(that,0,0,length),that}function fromArray(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromTypedArray(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromArrayBuffer(that,array){return Buffer.TYPED_ARRAY_SUPPORT?(array.byteLength,that=Buffer._augment(new Uint8Array(array))):that=fromTypedArray(that,new Uint8Array(array)),that}function fromArrayLike(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromJsonObject(that,object){var array,length=0;"Buffer"===object.type&&isArray(object.data)&&(array=object.data,length=0|checked(array.length)),that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function allocate(that,length){Buffer.TYPED_ARRAY_SUPPORT?(that=Buffer._augment(new Uint8Array(length)),that.__proto__=Buffer.prototype):(that.length=length,that._isBuffer=!0);var fromPool=0!==length&&length<=Buffer.poolSize>>>1;return fromPool&&(that.parent=rootParent),that}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function SlowBuffer(subject,encoding){if(!(this instanceof SlowBuffer))return new SlowBuffer(subject,encoding);var buf=new Buffer(subject,encoding);return delete buf.parent,buf}function byteLength(string,encoding){"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if(start=0|start,end=void 0===end||end===1/0?this.length:0|end,encoding||(encoding="utf8"),0>start&&(start=0),end>this.length&&(end=this.length),start>=end)return"";for(;;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining;var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;length>i;i++){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))throw new Error("Invalid hex string");buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;end>i;){var firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(end>=i+bytesPerSequence){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:128>firstByte&&(codePoint=firstByte);break;case 2:secondByte=buf[i+1],128===(192&secondByte)&&(tempCodePoint=(31&firstByte)<<6|63&secondByte,tempCodePoint>127&&(codePoint=tempCodePoint));break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128===(192&secondByte)&&128===(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte,tempCodePoint>2047&&(55296>tempCodePoint||tempCodePoint>57343)&&(codePoint=tempCodePoint));break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128===(192&secondByte)&&128===(192&thirdByte)&&128===(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte,tempCodePoint>65535&&1114112>tempCodePoint&&(codePoint=tempCodePoint))}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return decodeCodePointsArray(res)}function decodeCodePointsArray(codePoints){var len=codePoints.length;if(MAX_ARGUMENTS_LENGTH>=len)return String.fromCharCode.apply(String,codePoints);for(var res="",i=0;len>i;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(127&buf[i]);return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||0>start)&&(start=0),(!end||0>end||end>len)&&(end=len);for(var out="",i=start;end>i;i++)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!==0||0>offset)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||min>value)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){0>value&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);j>i;i++)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){0>value&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);j>i;i++)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||min>value)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range");if(0>offset)throw new RangeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){if(str=stringtrim(str).replace(INVALID_BASE64_RE,""),str.length<2)return"";for(;str.length%4!==0;)str+="=";return str}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function toHex(n){return 16>n?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;length>i;i++){if(codePoint=string.charCodeAt(i),codePoint>55295&&57344>codePoint){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(56320>codePoint){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,128>codePoint){if((units-=1)<0)break;bytes.push(codePoint)}else if(2048>codePoint){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(65536>codePoint){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(1114112>codePoint))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;i++)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);i++)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;length>i&&!(i+offset>=dst.length||i>=src.length);i++)dst[i+offset]=src[i];return i}var base64=__webpack_require__(18),ieee754=__webpack_require__(23),isArray=__webpack_require__(24);exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:typedArraySupport(),Buffer.TYPED_ARRAY_SUPPORT?(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array):(Buffer.prototype.length=void 0,Buffer.prototype.parent=void 0),Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);len>i&&a[i]===b[i];)++i;return i!==len&&(x=a[i],y=b[i]),y>x?-1:x>y?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError("list argument must be an Array of Buffers.");if(0===list.length)return new Buffer(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;i++)length+=list[i].length;var buf=new Buffer(length),pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos),pos+=item.length}return buf},Buffer.byteLength=byteLength,Buffer.prototype.toString=function(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?!0:0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?0:Buffer.compare(this,b)},Buffer.prototype.indexOf=function(val,byteOffset){function arrayIndexOf(arr,val,byteOffset){for(var foundIndex=-1,i=0;byteOffset+i<arr.length;i++)if(arr[byteOffset+i]===val[-1===foundIndex?0:i-foundIndex]){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===val.length)return byteOffset+foundIndex}else foundIndex=-1;return-1}if(byteOffset>2147483647?byteOffset=2147483647:-2147483648>byteOffset&&(byteOffset=-2147483648),byteOffset>>=0,0===this.length)return-1;if(byteOffset>=this.length)return-1;if(0>byteOffset&&(byteOffset=Math.max(this.length+byteOffset,0)),"string"==typeof val)return 0===val.length?-1:String.prototype.indexOf.call(this,val,byteOffset);if(Buffer.isBuffer(val))return arrayIndexOf(this,val,byteOffset);if("number"==typeof val)return Buffer.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,val,byteOffset):arrayIndexOf(this,[val],byteOffset);throw new TypeError("val must be string, number or Buffer")},Buffer.prototype.get=function(offset){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(offset)},Buffer.prototype.set=function(v,offset){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(v,offset)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else if(isFinite(offset))offset=0|offset,isFinite(length)?(length=0|length,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0);else{var swap=encoding;encoding=offset,offset=0|length,length=swap}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(0>length||0>offset)||offset>this.length)throw new RangeError("attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,0>start?(start+=len,0>start&&(start=0)):start>len&&(start=len),0>end?(end+=len,0>end&&(end=0)):end>len&&(end=len),start>end&&(end=start);var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT)newBuf=Buffer._augment(this.subarray(start,end));else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;sliceLen>i;i++)newBuf[i]=this[i+start]}return newBuf.length&&(newBuf.parent=this.parent||this),newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset=0|offset,byteLength=0|byteLength,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset=0|offset,byteLength=0|byteLength,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0>value?1:0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0>value?1:0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),0>value&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),0>value&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&start>end&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(0>targetStart)throw new RangeError("targetStart out of bounds");if(0>start||start>=this.length)throw new RangeError("sourceStart out of bounds");if(0>end)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&targetStart>start&&end>targetStart)for(i=len-1;i>=0;i--)target[i+targetStart]=this[i+start];else if(1e3>len||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;len>i;i++)target[i+targetStart]=this[i+start];else target._set(this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(value,start,end){if(value||(value=0),start||(start=0),end||(end=this.length),start>end)throw new RangeError("end < start");if(end!==start&&0!==this.length){if(0>start||start>=this.length)throw new RangeError("start out of bounds");if(0>end||end>this.length)throw new RangeError("end out of bounds");var i;if("number"==typeof value)for(i=start;end>i;i++)this[i]=value;else{var bytes=utf8ToBytes(value.toString()),len=bytes.length;for(i=start;end>i;i++)this[i]=bytes[i%len]}return this}},Buffer.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(Buffer.TYPED_ARRAY_SUPPORT)return new Buffer(this).buffer;for(var buf=new Uint8Array(this.length),i=0,len=buf.length;len>i;i+=1)buf[i]=this[i];return buf.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var BP=Buffer.prototype;Buffer._augment=function(arr){return arr.constructor=Buffer,arr._isBuffer=!0,arr._set=arr.set,arr.get=BP.get,arr.set=BP.set,arr.write=BP.write,arr.toString=BP.toString,arr.toLocaleString=BP.toString,arr.toJSON=BP.toJSON,arr.equals=BP.equals,arr.compare=BP.compare,arr.indexOf=BP.indexOf,arr.copy=BP.copy,arr.slice=BP.slice,arr.readUIntLE=BP.readUIntLE,arr.readUIntBE=BP.readUIntBE,arr.readUInt8=BP.readUInt8,arr.readUInt16LE=BP.readUInt16LE,arr.readUInt16BE=BP.readUInt16BE,arr.readUInt32LE=BP.readUInt32LE,arr.readUInt32BE=BP.readUInt32BE,arr.readIntLE=BP.readIntLE,arr.readIntBE=BP.readIntBE,arr.readInt8=BP.readInt8,arr.readInt16LE=BP.readInt16LE,arr.readInt16BE=BP.readInt16BE,arr.readInt32LE=BP.readInt32LE,arr.readInt32BE=BP.readInt32BE,arr.readFloatLE=BP.readFloatLE,arr.readFloatBE=BP.readFloatBE,arr.readDoubleLE=BP.readDoubleLE,arr.readDoubleBE=BP.readDoubleBE,arr.writeUInt8=BP.writeUInt8,arr.writeUIntLE=BP.writeUIntLE,arr.writeUIntBE=BP.writeUIntBE,arr.writeUInt16LE=BP.writeUInt16LE,arr.writeUInt16BE=BP.writeUInt16BE,arr.writeUInt32LE=BP.writeUInt32LE,arr.writeUInt32BE=BP.writeUInt32BE,arr.writeIntLE=BP.writeIntLE,arr.writeIntBE=BP.writeIntBE,arr.writeInt8=BP.writeInt8,arr.writeInt16LE=BP.writeInt16LE,arr.writeInt16BE=BP.writeInt16BE,arr.writeInt32LE=BP.writeInt32LE,arr.writeInt32BE=BP.writeInt32BE,arr.writeFloatLE=BP.writeFloatLE,arr.writeFloatBE=BP.writeFloatBE,arr.writeDoubleLE=BP.writeDoubleLE,arr.writeDoubleBE=BP.writeDoubleBE,arr.fill=BP.fill,arr.inspect=BP.inspect,arr.toArrayBuffer=BP.toArrayBuffer,arr};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g}).call(exports,__webpack_require__(3).Buffer,function(){return this}())},function(module,exports){function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=setTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,clearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var currentQueue,process=module.exports={},queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},function(module,exports,__webpack_require__){function Stream(){EE.call(this)}module.exports=Stream;var EE=__webpack_require__(7).EventEmitter,inherits=__webpack_require__(1);inherits(Stream,EE),Stream.Readable=__webpack_require__(31),Stream.Writable=__webpack_require__(33),Stream.Duplex=__webpack_require__(29),Stream.Transform=__webpack_require__(32),Stream.PassThrough=__webpack_require__(30),Stream.Stream=Stream,Stream.prototype.pipe=function(dest,options){function ondata(chunk){dest.writable&&!1===dest.write(chunk)&&source.pause&&source.pause()}function ondrain(){source.readable&&source.resume&&source.resume()}function onend(){didOnEnd||(didOnEnd=!0,dest.end())}function onclose(){didOnEnd||(didOnEnd=!0,"function"==typeof dest.destroy&&dest.destroy())}function onerror(er){if(cleanup(),0===EE.listenerCount(this,"error"))throw er}function cleanup(){source.removeListener("data",ondata),dest.removeListener("drain",ondrain),source.removeListener("end",onend),source.removeListener("close",onclose),source.removeListener("error",onerror),dest.removeListener("error",onerror),source.removeListener("end",cleanup),source.removeListener("close",cleanup),dest.removeListener("close",cleanup)}var source=this;source.on("data",ondata),dest.on("drain",ondrain),dest._isStdio||options&&options.end===!1||(source.on("end",onend),source.on("close",onclose));var didOnEnd=!1;return source.on("error",onerror),dest.on("error",onerror),source.on("end",cleanup),source.on("close",cleanup),dest.on("close",cleanup),dest.emit("pipe",source),dest}},function(module,exports,__webpack_require__){(function(Buffer){function isArray(arg){return Array.isArray?Array.isArray(arg):"[object Array]"===objectToString(arg)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return"[object Date]"===objectToString(d)}function isError(e){return"[object Error]"===objectToString(e)||e instanceof Error}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||"undefined"==typeof arg}function objectToString(o){
return Object.prototype.toString.call(o)}exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=Buffer.isBuffer}).call(exports,__webpack_require__(3).Buffer)},function(module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||0>n||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1),handler.apply(this,args)}else if(isObject(handler))for(args=Array.prototype.slice.call(arguments,1),listeners=handler.slice(),len=listeners.length,i=0;len>i;i++)listeners[i].apply(this,args);return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned&&(m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else if(listeners)for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;if(evlistener)return evlistener.length}return 0},EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)}},function(module,exports,__webpack_require__){function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null,ts.writecb=null,util.isNullOrUndefined(data)||stream.push(data),cb&&cb(er);var rs=stream._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&stream._read(rs.highWaterMark)}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options),this._transformState=new TransformState(options,this);var stream=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("prefinish",function(){util.isFunction(this._flush)?this._flush(function(er){done(stream,er)}):done(stream)})}function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState,ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}module.exports=Transform;var Duplex=__webpack_require__(2),util=__webpack_require__(6);util.inherits=__webpack_require__(1),util.inherits(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(n){var ts=this._transformState;util.isNull(ts.writechunk)||!ts.writecb||ts.transforming?ts.needTransform=!0:(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform))}},function(module,exports,__webpack_require__){(function(process){function WriteReq(chunk,encoding,cb){this.chunk=chunk,this.encoding=encoding,this.callback=cb}function WritableState(options,stream){var Duplex=__webpack_require__(2);options=options||{};var hwm=options.highWaterMark,defaultHwm=options.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.writableObjectMode),this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var noDecode=options.decodeStrings===!1;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){onwrite(stream,er)},this.writecb=null,this.writelen=0,this.buffer=[],this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function Writable(options){var Duplex=__webpack_require__(2);return this instanceof Writable||this instanceof Duplex?(this._writableState=new WritableState(options,this),this.writable=!0,void Stream.call(this)):new Writable(options)}function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er),process.nextTick(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=!0;if(!(util.isBuffer(chunk)||util.isString(chunk)||util.isNullOrUndefined(chunk)||state.objectMode)){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er),process.nextTick(function(){cb(er)}),valid=!1}return valid}function decodeChunk(state,chunk,encoding){return!state.objectMode&&state.decodeStrings!==!1&&util.isString(chunk)&&(chunk=new Buffer(chunk,encoding)),chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding),util.isBuffer(chunk)&&(encoding="buffer");var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;return ret||(state.needDrain=!0),state.writing||state.corked?state.buffer.push(new WriteReq(chunk,encoding,cb)):doWrite(stream,state,!1,len,chunk,encoding,cb),ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,writev?stream._writev(chunk,state.onwrite):stream._write(chunk,encoding,state.onwrite),state.sync=!1}function onwriteError(stream,state,sync,er,cb){sync?process.nextTick(function(){state.pendingcb--,cb(er)}):(state.pendingcb--,cb(er)),stream._writableState.errorEmitted=!0,stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}function onwrite(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if(onwriteStateUpdate(state),er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);finished||state.corked||state.bufferProcessing||!state.buffer.length||clearBuffer(stream,state),sync?process.nextTick(function(){afterWrite(stream,state,finished,cb)}):afterWrite(stream,state,finished,cb)}}function afterWrite(stream,state,finished,cb){finished||onwriteDrain(stream,state),state.pendingcb--,cb(),finishMaybe(stream,state)}function onwriteDrain(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}function clearBuffer(stream,state){if(state.bufferProcessing=!0,stream._writev&&state.buffer.length>1){for(var cbs=[],c=0;c<state.buffer.length;c++)cbs.push(state.buffer[c].callback);state.pendingcb++,doWrite(stream,state,!0,state.length,state.buffer,"",function(err){for(var i=0;i<cbs.length;i++)state.pendingcb--,cbs[i](err)}),state.buffer=[]}else{for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c],chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback,len=state.objectMode?1:chunk.length;if(doWrite(stream,state,!1,len,chunk,encoding,cb),state.writing){c++;break}}c<state.buffer.length?state.buffer=state.buffer.slice(c):state.buffer.length=0}state.bufferProcessing=!1}function needFinish(stream,state){return state.ending&&0===state.length&&!state.finished&&!state.writing}function prefinish(stream,state){state.prefinished||(state.prefinished=!0,stream.emit("prefinish"))}function finishMaybe(stream,state){var need=needFinish(stream,state);return need&&(0===state.pendingcb?(prefinish(stream,state),state.finished=!0,stream.emit("finish")):prefinish(stream,state)),need}function endWritable(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?process.nextTick(cb):stream.once("finish",cb)),state.ended=!0}module.exports=Writable;var Buffer=__webpack_require__(3).Buffer;Writable.WritableState=WritableState;var util=__webpack_require__(6);util.inherits=__webpack_require__(1);var Stream=__webpack_require__(5);util.inherits(Writable,Stream),Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState,ret=!1;return util.isFunction(encoding)&&(cb=encoding,encoding=null),util.isBuffer(chunk)?encoding="buffer":encoding||(encoding=state.defaultEncoding),util.isFunction(cb)||(cb=function(){}),state.ended?writeAfterEnd(this,state,cb):validChunk(this,state,chunk,cb)&&(state.pendingcb++,ret=writeOrBuffer(this,state,chunk,encoding,cb)),ret},Writable.prototype.cork=function(){var state=this._writableState;state.corked++},Writable.prototype.uncork=function(){var state=this._writableState;state.corked&&(state.corked--,state.writing||state.corked||state.finished||state.bufferProcessing||!state.buffer.length||clearBuffer(this,state))},Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;util.isFunction(chunk)?(cb=chunk,chunk=null,encoding=null):util.isFunction(encoding)&&(cb=encoding,encoding=null),util.isNullOrUndefined(chunk)||this.write(chunk,encoding),state.corked&&(state.corked=1,this.uncork()),state.ending||state.finished||endWritable(this,state,cb)}}).call(exports,__webpack_require__(4))},function(module,exports){},function(module,exports,__webpack_require__){var http=module.exports,Request=(__webpack_require__(7).EventEmitter,__webpack_require__(20)),url=__webpack_require__(15);http.request=function(params,cb){"string"==typeof params&&(params=url.parse(params)),params||(params={}),params.host||params.port||(params.port=parseInt(window.location.port,10)),!params.host&&params.hostname&&(params.host=params.hostname),params.protocol||(params.scheme?params.protocol=params.scheme+":":params.protocol=window.location.protocol),params.host||(params.host=window.location.hostname||window.location.host),/:/.test(params.host)&&(params.port||(params.port=params.host.split(":")[1]),params.host=params.host.split(":")[0]),params.port||(params.port="https:"==params.protocol?443:80);var req=new Request(new xhrHttp,params);return cb&&req.on("response",cb),req},http.get=function(params,cb){params.method="GET";var req=http.request(params,cb);return req.end(),req},http.Agent=function(){},http.Agent.defaultMaxSockets=4;var xhrHttp=function(){if("undefined"==typeof window)throw new Error("no window object present");if(window.XMLHttpRequest)return window.XMLHttpRequest;if(window.ActiveXObject){for(var axs=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"],i=0;i<axs.length;i++)try{var ax=new window.ActiveXObject(axs[i]);return function(){if(ax){var ax_=ax;return ax=null,ax_}return new window.ActiveXObject(axs[i])}}catch(e){}throw new Error("ajax not supported in this browser")}throw new Error("ajax not supported in this browser")}();http.STATUS_CODES={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},function(module,exports,__webpack_require__){function PassThrough(options){return this instanceof PassThrough?void Transform.call(this,options):new PassThrough(options)}module.exports=PassThrough;var Transform=__webpack_require__(8),util=__webpack_require__(6);util.inherits=__webpack_require__(1),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},function(module,exports,__webpack_require__){(function(process){function ReadableState(options,stream){var Duplex=__webpack_require__(2);options=options||{};var hwm=options.highWaterMark,defaultHwm=options.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.readableObjectMode),this.defaultEncoding=options.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder||(StringDecoder=__webpack_require__(14).StringDecoder),this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){__webpack_require__(2);return this instanceof Readable?(this._readableState=new ReadableState(options,this),this.readable=!0,void Stream.call(this)):new Readable(options)}function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er)stream.emit("error",er);else if(util.isNullOrUndefined(chunk))state.reading=!1,state.ended||onEofChunk(stream,state);else if(state.objectMode||chunk&&chunk.length>0)if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else!state.decoder||addToFront||encoding||(chunk=state.decoder.write(chunk)),addToFront||(state.reading=!1),state.flowing&&0===state.length&&!state.sync?(stream.emit("data",chunk),stream.read(0)):(state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):state.buffer.push(chunk),state.needReadable&&emitReadable(stream)),maybeReadMore(stream,state);else addToFront||(state.reading=!1);return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}function roundUpToNextPowerOf2(n){if(n>=MAX_HWM)n=MAX_HWM;else{n--;for(var p=1;32>p;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){return 0===state.length&&state.ended?0:state.objectMode?0===n?0:1:isNaN(n)||util.isNull(n)?state.flowing&&state.buffer.length?state.buffer[0].length:state.length:0>=n?0:(n>state.highWaterMark&&(state.highWaterMark=roundUpToNextPowerOf2(n)),n>state.length?state.ended?state.length:(state.needReadable=!0,0):n)}function chunkInvalid(state,chunk){var er=null;return util.isBuffer(chunk)||util.isString(chunk)||util.isNullOrUndefined(chunk)||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(debug("emitReadable",state.flowing),state.emittedReadable=!0,state.sync?process.nextTick(function(){emitReadable_(stream)}):emitReadable_(stream))}function emitReadable_(stream){debug("emit readable"),stream.emit("readable"),flow(stream)}function maybeReadMore(stream,state){state.readingMore||(state.readingMore=!0,process.nextTick(function(){maybeReadMore_(stream,state)}))}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(debug("maybeReadMore read 0"),stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain),state.awaitDrain&&state.awaitDrain--,0===state.awaitDrain&&EE.listenerCount(src,"data")&&(state.flowing=!0,flow(src))}}function resume(stream,state){state.resumeScheduled||(state.resumeScheduled=!0,process.nextTick(function(){resume_(stream,state)}))}function resume_(stream,state){state.resumeScheduled=!1,stream.emit("resume"),flow(stream),state.flowing&&!state.reading&&stream.read(0)}function flow(stream){var state=stream._readableState;if(debug("flow",state.flowing),state.flowing)do var chunk=stream.read();while(null!==chunk&&state.flowing)}function fromList(n,state){var ret,list=state.buffer,length=state.length,stringMode=!!state.decoder,objectMode=!!state.objectMode;if(0===list.length)return null;if(0===length)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length)ret=stringMode?list.join(""):Buffer.concat(list,length),list.length=0;else if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n),list[0]=buf.slice(n)}else if(n===list[0].length)ret=list.shift();else{ret=stringMode?"":new Buffer(n);for(var c=0,i=0,l=list.length;l>i&&n>c;i++){var buf=list[0],cpy=Math.min(n-c,buf.length);stringMode?ret+=buf.slice(0,cpy):buf.copy(ret,c,0,cpy),cpy<buf.length?list[0]=buf.slice(cpy):list.shift(),c+=cpy}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");state.endEmitted||(state.ended=!0,process.nextTick(function(){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}))}function forEach(xs,f){for(var i=0,l=xs.length;l>i;i++)f(xs[i],i)}function indexOf(xs,x){for(var i=0,l=xs.length;l>i;i++)if(xs[i]===x)return i;return-1}module.exports=Readable;var isArray=__webpack_require__(28),Buffer=__webpack_require__(3).Buffer;Readable.ReadableState=ReadableState;var EE=__webpack_require__(7).EventEmitter;EE.listenerCount||(EE.listenerCount=function(emitter,type){return emitter.listeners(type).length});var Stream=__webpack_require__(5),util=__webpack_require__(6);util.inherits=__webpack_require__(1);var StringDecoder,debug=__webpack_require__(41);debug=debug&&debug.debuglog?debug.debuglog("stream"):function(){},util.inherits(Readable,Stream),Readable.prototype.push=function(chunk,encoding){var state=this._readableState;return util.isString(chunk)&&!state.objectMode&&(encoding=encoding||state.defaultEncoding,encoding!==state.encoding&&(chunk=new Buffer(chunk,encoding),encoding="")),readableAddChunk(this,state,chunk,encoding,!1)},Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",!0)},Readable.prototype.setEncoding=function(enc){return StringDecoder||(StringDecoder=__webpack_require__(14).StringDecoder),this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc,this};var MAX_HWM=8388608;Readable.prototype.read=function(n){debug("read",n);var state=this._readableState,nOrig=n;if((!util.isNumber(n)||n>0)&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return debug("read: emitReadable",state.length,state.ended),0===state.length&&state.ended?endReadable(this):emitReadable(this),null;if(n=howMuchToRead(n,state),0===n&&state.ended)return 0===state.length&&endReadable(this),null;var doRead=state.needReadable;debug("need readable",doRead),(0===state.length||state.length-n<state.highWaterMark)&&(doRead=!0,debug("length less than watermark",doRead)),(state.ended||state.reading)&&(doRead=!1,debug("reading or ended",doRead)),doRead&&(debug("do read"),state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1),doRead&&!state.reading&&(n=howMuchToRead(nOrig,state));var ret;return ret=n>0?fromList(n,state):null,util.isNull(ret)&&(state.needReadable=!0,n=0),state.length-=n,0!==state.length||state.ended||(state.needReadable=!0),nOrig!==n&&state.ended&&0===state.length&&endReadable(this),util.isNull(ret)||this.emit("data",ret),ret},Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(dest,pipeOpts){function onunpipe(readable){debug("onunpipe"),readable===src&&cleanup()}function onend(){debug("onend"),dest.end()}function cleanup(){debug("cleanup"),dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",cleanup),src.removeListener("data",ondata),!state.awaitDrain||dest._writableState&&!dest._writableState.needDrain||ondrain()}function ondata(chunk){debug("ondata");var ret=dest.write(chunk);!1===ret&&(debug("false write response, pause",src._readableState.awaitDrain),src._readableState.awaitDrain++,src.pause())}function onerror(er){debug("onerror",er),unpipe(),dest.removeListener("error",onerror),0===EE.listenerCount(dest,"error")&&dest.emit("error",er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){debug("onfinish"),dest.removeListener("close",onclose),unpipe()}function unpipe(){debug("unpipe"),src.unpipe(dest)}var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1,debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==!1)&&dest!==process.stdout&&dest!==process.stderr,endFn=doEnd?onend:cleanup;state.endEmitted?process.nextTick(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);var ondrain=pipeOnDrain(src);return dest.on("drain",ondrain),src.on("data",ondata),dest._events&&dest._events.error?isArray(dest._events.error)?dest._events.error.unshift(onerror):dest._events.error=[onerror,dest._events.error]:dest.on("error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(debug("pipe resume"),src.resume()),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState;if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes?this:(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,state.flowing=!1,dest&&dest.emit("unpipe",this),this);if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,state.flowing=!1;for(var i=0;len>i;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);return-1===i?this:(state.pipes.splice(i,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this),this)},Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if("data"===ev&&!1!==this._readableState.flowing&&this.resume(),"readable"===ev&&this.readable){var state=this._readableState;if(!state.readableListening)if(state.readableListening=!0,state.emittedReadable=!1,state.needReadable=!0,state.reading)state.length&&emitReadable(this,state);else{var self=this;process.nextTick(function(){debug("readable nexttick read 0"),self.read(0)})}}return res},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var state=this._readableState;return state.flowing||(debug("resume"),state.flowing=!0,state.reading||(debug("resume read 0"),this.read(0)),resume(this,state)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(stream){var state=this._readableState,paused=!1,self=this;stream.on("end",function(){if(debug("wrapped end"),state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&self.push(chunk)}self.push(null)}),stream.on("data",function(chunk){if(debug("wrapped data"),state.decoder&&(chunk=state.decoder.write(chunk)),chunk&&(state.objectMode||chunk.length)){var ret=self.push(chunk);ret||(paused=!0,stream.pause())}});for(var i in stream)util.isFunction(stream[i])&&util.isUndefined(this[i])&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));var events=["error","close","destroy","pause","resume"];return forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))}),self._read=function(n){debug("wrapped _read",n),paused&&(paused=!1,stream.resume())},self},Readable._fromList=fromList}).call(exports,__webpack_require__(4))},function(module,exports,__webpack_require__){function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding))throw new Error("Unknown encoding: "+encoding)}function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3,this.charLength=this.charReceived?3:0}var Buffer=__webpack_require__(3).Buffer,isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},StringDecoder=exports.StringDecoder=function(encoding){switch(this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,""),assertEncoding(encoding),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0};StringDecoder.prototype.write=function(buffer){for(var charStr="";this.charLength;){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;if(buffer.copy(this.charBuffer,this.charReceived,0,available),this.charReceived+=available,this.charReceived<this.charLength)return"";buffer=buffer.slice(available,buffer.length),charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(!(charCode>=55296&&56319>=charCode)){if(this.charReceived=this.charLength=0,0===buffer.length)return charStr;break}this.charLength+=this.surrogateSize,charStr=""}this.detectIncompleteChar(buffer);var end=buffer.length;this.charLength&&(buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end),end-=this.charReceived),charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1,charCode=charStr.charCodeAt(end);if(charCode>=55296&&56319>=charCode){var size=this.surrogateSize;return this.charLength+=size,this.charReceived+=size,this.charBuffer.copy(this.charBuffer,size,0,size),buffer.copy(this.charBuffer,0,0,size),charStr.substring(0,end)}return charStr},StringDecoder.prototype.detectIncompleteChar=function(buffer){for(var i=buffer.length>=3?3:buffer.length;i>0;i--){var c=buffer[buffer.length-i];if(1==i&&c>>5==6){this.charLength=2;break}if(2>=i&&c>>4==14){this.charLength=3;break}if(3>=i&&c>>3==30){this.charLength=4;break;
}}this.charReceived=i},StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length&&(res=this.write(buffer)),this.charReceived){var cr=this.charReceived,buf=this.charBuffer,enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res}},function(module,exports,__webpack_require__){function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}function urlFormat(obj){return isString(obj)&&(obj=urlParse(obj)),obj instanceof Url?obj.format():Url.prototype.format.call(obj)}function urlResolve(source,relative){return urlParse(source,!1,!0).resolve(relative)}function urlResolveObject(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative}function isString(arg){return"string"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}var punycode=__webpack_require__(34);exports.parse=urlParse,exports.resolve=urlResolve,exports.resolveObject=urlResolveObject,exports.format=urlFormat,exports.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,delims=["<",">",'"',"`"," ","\r","\n","	"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=__webpack_require__(27);Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var rest=url;rest=rest.trim();var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var hostEnd=-1,i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);-1!==hec&&(-1===hostEnd||hostEnd>hec)&&(hostEnd=hec)}var auth,atSign;atSign=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd),-1!==atSign&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);-1!==hec&&(-1===hostEnd||hostEnd>hec)&&(hostEnd=hec)}-1===hostEnd&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),i=0,l=hostparts.length;l>i;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;k>j;j++)newpart+=part.charCodeAt(j)>127?"x":part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}if(this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),!ipv6Hostname){for(var domainArray=this.hostname.split("."),newOut=[],i=0;i<domainArray.length;++i){var s=domainArray[i];newOut.push(s.match(/[^A-Za-z0-9_-]/)?"xn--"+punycode.encode(s):s)}this.hostname=newOut.join(".")}var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(var i=0,l=autoEscape.length;l>i;i++){var ae=autoEscape[i],esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}var hash=rest.indexOf("#");-1!==hash&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(-1!==qm?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var p=this.pathname||"",s=this.search||"";this.path=p+s}return this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=encodeURIComponent(auth),auth=auth.replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&host!==!1?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}),search=search.replace("#","%23"),protocol+host+pathname+search+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if(isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}var result=new Url;if(Object.keys(this).forEach(function(k){result[k]=this[k]},this),result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol)return Object.keys(relative).forEach(function(k){"protocol"!==k&&(result[k]=relative[k])}),slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result;if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol])return Object.keys(relative).forEach(function(k){result[k]=relative[k]}),result.href=result.format(),result;if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):!1;authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return result.search=relative.search,result.query=relative.query,isNull(result.pathname)&&isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;i>=0;i--)last=srcPath[i],"."==last?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):!1;authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return mustEndAbs=mustEndAbs||result.host&&srcPath.length,mustEndAbs&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),isNull(result.pathname)&&isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(port=port[0],":"!==port&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},function(module,exports,__webpack_require__){!function(){function InvalidCharacterError(message){this.message=message}var object=exports,chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";InvalidCharacterError.prototype=new Error,InvalidCharacterError.prototype.name="InvalidCharacterError",object.btoa||(object.btoa=function(input){for(var block,charCode,idx=0,map=chars,output="";input.charAt(0|idx)||(map="=",idx%1);output+=map.charAt(63&block>>8-idx%1*8)){if(charCode=input.charCodeAt(idx+=.75),charCode>255)throw new InvalidCharacterError("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");block=block<<8|charCode}return output}),object.atob||(object.atob=function(input){if(input=input.replace(/=+$/,""),input.length%4==1)throw new InvalidCharacterError("'atob' failed: The string to be decoded is not correctly encoded.");for(var bs,buffer,bc=0,idx=0,output="";buffer=input.charAt(idx++);~buffer&&(bs=bc%4?64*bs+buffer:buffer,bc++%4)?output+=String.fromCharCode(255&bs>>(-2*bc&6)):0)buffer=chars.indexOf(buffer);return output})}()},function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(7);__webpack_require__(19);var fabric=window.fabric,MediaCropper=function(_EventEmitter){function MediaCropper(media){function onChange(options){context.globalCompositeOperation="source-over",context.clearRect(0,0,croppingCanvas.width,croppingCanvas.height),context.fillStyle="rgba(0,0,0,0.5)",context.fillRect(0,0,croppingCanvas.width,croppingCanvas.height),context.globalCompositeOperation="destination-out",context.fillStyle="rgba(255,255,255,1.0)",context.fillRect(options.target.getLeft(),options.target.getTop(),options.target.getWidth(),options.target.getHeight()),confirmElement.style.visibility="visible",confirmElement.style.left=options.target.getLeft()+"px",confirmElement.style.top=options.target.getTop()-parseInt(confirmElement.style.height)+"px"}function removeSelection(){confirmElement.style.visibility="hidden",context.globalCompositeOperation="source-over",context.clearRect(0,0,croppingCanvas.width,croppingCanvas.height),rectDrawn=!1,canvas.remove(finalRect)}function handleConfirmClick(ctx){ctx.cropMedia(media,{left:finalRect.getLeft(),top:finalRect.getTop(),width:finalRect.getWidth(),height:finalRect.getHeight()}),removeSelectionAfterConfirm&&removeSelection()}var _ref=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],_ref$removeSelectionA=_ref.removeSelectionAfterConfirm,removeSelectionAfterConfirm=void 0===_ref$removeSelectionA?!0:_ref$removeSelectionA;_classCallCheck(this,MediaCropper);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(MediaCropper).call(this));if(!media)return _possibleConstructorReturn(_this);var isVideo=void 0,fabricHelperCanvas=document.createElement("canvas");fabricHelperCanvas.style.position="absolute",fabricHelperCanvas.style.height="100%",fabricHelperCanvas.style.width="100%",fabricHelperCanvas.style.top=0,fabricHelperCanvas.style.left=0;var croppingCanvas=document.createElement("canvas");croppingCanvas.height=media.clientHeight,croppingCanvas.width=media.clientWidth,croppingCanvas.style.position="absolute",croppingCanvas.style.top=0,croppingCanvas.style.left=0;var confirmElement=document.createElement("div");confirmElement.id="confirm",confirmElement.style.position="absolute",confirmElement.style.height="20px",confirmElement.style.width="20px",confirmElement.style.backgroundColor="rgba(0,0,0, 0.4)",confirmElement.style.backgroundImage="url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjMycHgiIGhlaWdodD0iMzJweCIgdmlld0JveD0iMCAwIDQ0OC44IDQ0OC44IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NDguOCA0NDguODsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8Zz4KCTxnIGlkPSJjaGVjayI+CgkJPHBvbHlnb24gcG9pbnRzPSIxNDIuOCwzMjMuODUgMzUuNywyMTYuNzUgMCwyNTIuNDUgMTQyLjgsMzk1LjI1IDQ0OC44LDg5LjI1IDQxMy4xLDUzLjU1ICAgIiBmaWxsPSIjOTFEQzVBIi8+Cgk8L2c+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==)",confirmElement.style.backgroundRepeat="no-repeat",confirmElement.style.backgroundSize="15px 15px",confirmElement.style.backgroundPosition="center",confirmElement.style.top=0,confirmElement.style.left=0,confirmElement.style.visibility="hidden";var wrapper=document.createElement("div");wrapper.style.position="relative",wrapper.style.display="inline-block",media.parentNode.insertBefore(wrapper,media),wrapper.appendChild(media),wrapper.appendChild(croppingCanvas),wrapper.appendChild(fabricHelperCanvas),wrapper.appendChild(confirmElement),"video"===media.tagName.toLowerCase()&&(isVideo=!0),isVideo&&(fabricHelperCanvas.style.height=fabricHelperCanvas.clientHeight-30+"px",croppingCanvas.height=media.clientHeight-30);var fabricHelperCanvasHeight=fabricHelperCanvas.clientHeight,fabricHelperCanvasWidth=fabricHelperCanvas.clientWidth,canvas=new fabric.Canvas(fabricHelperCanvas,{selection:!1});canvas.setHeight(fabricHelperCanvasHeight),canvas.setWidth(fabricHelperCanvasWidth),confirmElement.addEventListener("click",function(){handleConfirmClick(_this)});var rect=void 0,finalRect=void 0,isDown=void 0,rectDrawn=void 0,origX=void 0,origY=void 0;canvas.on("mouse:down",function(o){if(isVideo&&media.pause(),!rectDrawn){isDown=!0;var pointer=canvas.getPointer(o.e);origX=pointer.x,origY=pointer.y,pointer=canvas.getPointer(o.e),rect=new fabric.Rect({left:origX,top:origY,width:pointer.x-origX,height:pointer.y-origY,fill:"rgba(255,255,255, 0.0)"}),canvas.add(rect)}}),canvas.on("mouse:move",function(o){if(isDown){var pointer=canvas.getPointer(o.e);origX>pointer.x&&rect.set({left:Math.abs(pointer.x)}),origY>pointer.y&&rect.set({top:Math.abs(pointer.y)}),rect.set({width:Math.abs(origX-pointer.x)}),rect.set({height:Math.abs(origY-pointer.y)}),canvas.renderAll(),onChange({target:rect})}}),canvas.on("mouse:up",function(o){return isDown=!1,rectDrawn&&!o.target?void removeSelection():void(rectDrawn||(finalRect=new fabric.Rect({width:rect.getWidth(),height:rect.getHeight(),left:rect.getLeft(),top:rect.getTop(),fill:"rgba(255,255,255, 0.0)"}),finalRect.lockRotation=!0,finalRect.setControlsVisibility({mtr:!1}),canvas.add(finalRect),canvas.remove(rect),canvas.setActiveObject(finalRect),rectDrawn=!0))});var canvasContainer=document.getElementsByClassName("canvas-container")[0];canvasContainer.style.position="absolute",canvasContainer.style.top=0,canvasContainer.style.left=0,canvas.on({"object:moving":onChange,"object:scaling":onChange});var context=croppingCanvas.getContext("2d");return _this}return _inherits(MediaCropper,_EventEmitter),_createClass(MediaCropper,[{key:"cropMedia",value:function(media){var _ref2=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],_ref2$stretch=_ref2.stretch,stretch=void 0===_ref2$stretch?1:_ref2$stretch,_ref2$left=_ref2.left,left=void 0===_ref2$left?0:_ref2$left,_ref2$top=_ref2.top,top=void 0===_ref2$top?0:_ref2$top,_ref2$width=_ref2.width,width=void 0===_ref2$width?10:_ref2$width,_ref2$height=_ref2.height,height=void 0===_ref2$height?10:_ref2$height,result={},croppedCanvas=document.createElement("canvas");return croppedCanvas.width=width,croppedCanvas.height=height,croppedCanvas.getContext("2d").drawImage(media,left,top,width,height,0,0,width*stretch,height*stretch),result.croppedCanvas=croppedCanvas,result.dimensions={left:left,top:top,width:width,height:height},media.currentTime&&(result.currentTime=media.currentTime),this.emit("cropped",result),result}}]),MediaCropper}(_events.EventEmitter);exports["default"]=MediaCropper},function(module,exports,__webpack_require__){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(exports){"use strict";function decode(elt){var code=elt.charCodeAt(0);return code===PLUS||code===PLUS_URL_SAFE?62:code===SLASH||code===SLASH_URL_SAFE?63:NUMBER>code?-1:NUMBER+10>code?code-NUMBER+26+26:UPPER+26>code?code-UPPER:LOWER+26>code?code-LOWER+26:void 0}function b64ToByteArray(b64){function push(v){arr[L++]=v}var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0,arr=new Arr(3*b64.length/4-placeHolders),l=placeHolders>0?b64.length-4:b64.length;var L=0;for(i=0,j=0;l>i;i+=4,j+=3)tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3)),push((16711680&tmp)>>16),push((65280&tmp)>>8),push(255&tmp);return 2===placeHolders?(tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4,push(255&tmp)):1===placeHolders&&(tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2,push(tmp>>8&255),push(255&tmp)),arr}function uint8ToBase64(uint8){function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(63&num)}var i,temp,length,extraBytes=uint8.length%3,output="";for(i=0,length=uint8.length-extraBytes;length>i;i+=3)temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output+=tripletToBase64(temp);switch(extraBytes){case 1:temp=uint8[uint8.length-1],output+=encode(temp>>2),output+=encode(temp<<4&63),output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1],output+=encode(temp>>10),output+=encode(temp>>4&63),output+=encode(temp<<2&63),output+="="}return output}var Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,PLUS="+".charCodeAt(0),SLASH="/".charCodeAt(0),NUMBER="0".charCodeAt(0),LOWER="a".charCodeAt(0),UPPER="A".charCodeAt(0),PLUS_URL_SAFE="-".charCodeAt(0),SLASH_URL_SAFE="_".charCodeAt(0);exports.toByteArray=b64ToByteArray,exports.fromByteArray=uint8ToBase64}(exports)},function(module,exports,__webpack_require__){(function(Buffer,process){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"1.6.2"};exports.fabric=fabric,"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=__webpack_require__(39).jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.document.createWindow?fabric.window=fabric.document.createWindow():fabric.window=fabric.document.parentWindow),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,function(){function _removeEventListener(eventName,handler){if(this.__eventListeners[eventName]){var eventListener=this.__eventListeners[eventName];handler?eventListener[eventListener.indexOf(handler)]=!1:fabric.util.array.fill(eventListener,!1)}}function observe(eventName,handler){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var prop in eventName)this.on(prop,eventName[prop]);else this.__eventListeners[eventName]||(this.__eventListeners[eventName]=[]),this.__eventListeners[eventName].push(handler);return this}function stopObserving(eventName,handler){if(this.__eventListeners){if(0===arguments.length)for(eventName in this.__eventListeners)_removeEventListener.call(this,eventName);else if(1===arguments.length&&"object"==typeof arguments[0])for(var prop in eventName)_removeEventListener.call(this,prop,eventName[prop]);else _removeEventListener.call(this,eventName,handler);return this}}function fire(eventName,options){if(this.__eventListeners){var listenersForEvent=this.__eventListeners[eventName];if(listenersForEvent){for(var i=0,len=listenersForEvent.length;len>i;i++)listenersForEvent[i]&&listenersForEvent[i].call(this,options||{});return this.__eventListeners[eventName]=listenersForEvent.filter(function(value){return value!==!1}),this}}}fabric.Observable={observe:observe,stopObserving:stopObserving,fire:fire,on:observe,off:stopObserving,trigger:fire}}(),fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var i=0,length=arguments.length;length>i;i++)this._onObjectAdded(arguments[i]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(object,index,nonSplicing){var objects=this.getObjects();return nonSplicing?objects[index]=object:objects.splice(index,0,object),this._onObjectAdded(object),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var index,objects=this.getObjects(),i=0,length=arguments.length;length>i;i++)index=objects.indexOf(arguments[i]),-1!==index&&(objects.splice(index,1),this._onObjectRemoved(arguments[i]));return this.renderOnAddRemove&&this.renderAll(),this},forEachObject:function(callback,context){for(var objects=this.getObjects(),i=objects.length;i--;)callback.call(context,objects[i],i,objects);return this},getObjects:function(type){return"undefined"==typeof type?this._objects:this._objects.filter(function(o){return o.type===type})},item:function(index){return this.getObjects()[index]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(object){return this.getObjects().indexOf(object)>-1},complexity:function(){return this.getObjects().reduce(function(memo,current){return memo+=current.complexity?current.complexity():0},0)}},function(global){var sqrt=Math.sqrt,atan2=Math.atan2,pow=Math.pow,abs=Math.abs,PiBy180=Math.PI/180;fabric.util={removeFromArray:function(array,value){var idx=array.indexOf(value);return-1!==idx&&array.splice(idx,1),array},getRandomInt:function(min,max){return Math.floor(Math.random()*(max-min+1))+min},degreesToRadians:function(degrees){return degrees*PiBy180},radiansToDegrees:function(radians){return radians/PiBy180},rotatePoint:function(point,origin,radians){point.subtractEquals(origin);var v=fabric.util.rotateVector(point,radians);return new fabric.Point(v.x,v.y).addEquals(origin)},rotateVector:function(vector,radians){var sin=Math.sin(radians),cos=Math.cos(radians),rx=vector.x*cos-vector.y*sin,ry=vector.x*sin+vector.y*cos;return{x:rx,y:ry}},transformPoint:function(p,t,ignoreOffset){return ignoreOffset?new fabric.Point(t[0]*p.x+t[2]*p.y,t[1]*p.x+t[3]*p.y):new fabric.Point(t[0]*p.x+t[2]*p.y+t[4],t[1]*p.x+t[3]*p.y+t[5])},makeBoundingBoxFromPoints:function(points){var xPoints=[points[0].x,points[1].x,points[2].x,points[3].x],minX=fabric.util.array.min(xPoints),maxX=fabric.util.array.max(xPoints),width=Math.abs(minX-maxX),yPoints=[points[0].y,points[1].y,points[2].y,points[3].y],minY=fabric.util.array.min(yPoints),maxY=fabric.util.array.max(yPoints),height=Math.abs(minY-maxY);return{left:minX,top:minY,width:width,height:height}},invertTransform:function(t){var a=1/(t[0]*t[3]-t[1]*t[2]),r=[a*t[3],-a*t[1],-a*t[2],a*t[0]],o=fabric.util.transformPoint({x:t[4],y:t[5]},r,!0);return r[4]=-o.x,r[5]=-o.y,r},toFixed:function(number,fractionDigits){return parseFloat(Number(number).toFixed(fractionDigits))},parseUnit:function(value,fontSize){var unit=/\D{0,2}$/.exec(value),number=parseFloat(value);switch(fontSize||(fontSize=fabric.Text.DEFAULT_SVG_FONT_SIZE),unit[0]){case"mm":return number*fabric.DPI/25.4;case"cm":return number*fabric.DPI/2.54;case"in":return number*fabric.DPI;case"pt":return number*fabric.DPI/72;case"pc":return number*fabric.DPI/72*12;case"em":return number*fontSize;default:return number}},falseFunction:function(){return!1},getKlass:function(type,namespace){return type=fabric.util.string.camelize(type.charAt(0).toUpperCase()+type.slice(1)),fabric.util.resolveNamespace(namespace)[type]},resolveNamespace:function(namespace){if(!namespace)return fabric;for(var parts=namespace.split("."),len=parts.length,obj=global||fabric.window,i=0;len>i;++i)obj=obj[parts[i]];return obj},loadImage:function(url,callback,context,crossOrigin){if(!url)return void(callback&&callback.call(context,url));var img=fabric.util.createImage();img.onload=function(){callback&&callback.call(context,img),img=img.onload=img.onerror=null},img.onerror=function(){fabric.log("Error loading "+img.src),callback&&callback.call(context,null,!0),img=img.onload=img.onerror=null},0!==url.indexOf("data")&&crossOrigin&&(img.crossOrigin=crossOrigin),img.src=url},enlivenObjects:function(objects,callback,namespace,reviver){function onLoaded(){++numLoadedObjects===numTotalObjects&&callback&&callback(enlivenedObjects)}objects=objects||[];var enlivenedObjects=[],numLoadedObjects=0,numTotalObjects=objects.length;return numTotalObjects?void objects.forEach(function(o,index){if(!o||!o.type)return void onLoaded();var klass=fabric.util.getKlass(o.type,namespace);klass.async?klass.fromObject(o,function(obj,error){error||(enlivenedObjects[index]=obj,reviver&&reviver(o,enlivenedObjects[index])),onLoaded()}):(enlivenedObjects[index]=klass.fromObject(o),reviver&&reviver(o,enlivenedObjects[index]),onLoaded())}):void(callback&&callback(enlivenedObjects))},groupSVGElements:function(elements,options,path){var object;return object=new fabric.PathGroup(elements,options),"undefined"!=typeof path&&object.setSourcePath(path),object},populateWithProperties:function(source,destination,properties){if(properties&&"[object Array]"===Object.prototype.toString.call(properties))for(var i=0,len=properties.length;len>i;i++)properties[i]in source&&(destination[properties[i]]=source[properties[i]])},drawDashedLine:function(ctx,x,y,x2,y2,da){var dx=x2-x,dy=y2-y,len=sqrt(dx*dx+dy*dy),rot=atan2(dy,dx),dc=da.length,di=0,draw=!0;for(ctx.save(),ctx.translate(x,y),ctx.moveTo(0,0),ctx.rotate(rot),x=0;len>x;)x+=da[di++%dc],x>len&&(x=len),ctx[draw?"lineTo":"moveTo"](x,0),draw=!draw;ctx.restore()},createCanvasElement:function(canvasEl){return canvasEl||(canvasEl=fabric.document.createElement("canvas")),canvasEl.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(canvasEl),canvasEl},createImage:function(){return fabric.isLikelyNode?new(__webpack_require__(10).Image):fabric.document.createElement("img")},createAccessors:function(klass){for(var proto=klass.prototype,i=proto.stateProperties.length;i--;){var propName=proto.stateProperties[i],capitalizedPropName=propName.charAt(0).toUpperCase()+propName.slice(1),setterName="set"+capitalizedPropName,getterName="get"+capitalizedPropName;proto[getterName]||(proto[getterName]=function(property){return new Function('return this.get("'+property+'")')}(propName)),proto[setterName]||(proto[setterName]=function(property){return new Function("value",'return this.set("'+property+'", value)')}(propName))}},clipContext:function(receiver,ctx){ctx.save(),ctx.beginPath(),receiver.clipTo(ctx),ctx.clip()},multiplyTransformMatrices:function(a,b,is2x2){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],is2x2?0:a[0]*b[4]+a[2]*b[5]+a[4],is2x2?0:a[1]*b[4]+a[3]*b[5]+a[5]]},qrDecompose:function(a){var angle=atan2(a[1],a[0]),denom=pow(a[0],2)+pow(a[1],2),scaleX=sqrt(denom),scaleY=(a[0]*a[3]-a[2]*a[1])/scaleX,skewX=atan2(a[0]*a[2]+a[1]*a[3],denom);return{angle:angle/PiBy180,scaleX:scaleX,scaleY:scaleY,skewX:skewX/PiBy180,skewY:0,translateX:a[4],translateY:a[5]}},customTransformMatrix:function(scaleX,scaleY,skewX){var skewMatrixX=[1,0,abs(Math.tan(skewX*PiBy180)),1],scaleMatrix=[abs(scaleX),0,0,abs(scaleY)];return fabric.util.multiplyTransformMatrices(scaleMatrix,skewMatrixX,!0)},resetObjectTransform:function(target){target.scaleX=1,target.scaleY=1,target.skewX=0,target.skewY=0,target.flipX=!1,target.flipY=!1,target.setAngle(0)},getFunctionBody:function(fn){return(String(fn).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(ctx,x,y,tolerance){tolerance>0&&(x>tolerance?x-=tolerance:x=0,y>tolerance?y-=tolerance:y=0);for(var _isTransparent=!0,imageData=ctx.getImageData(x,y,2*tolerance||1,2*tolerance||1),i=3,l=imageData.data.length;l>i;i+=4){var temp=imageData.data[i];if(_isTransparent=0>=temp,_isTransparent===!1)break}return imageData=null,_isTransparent},parsePreserveAspectRatioAttribute:function(attribute){var align,meetOrSlice="meet",alignX="Mid",alignY="Mid",aspectRatioAttrs=attribute.split(" ");return aspectRatioAttrs&&aspectRatioAttrs.length&&(meetOrSlice=aspectRatioAttrs.pop(),"meet"!==meetOrSlice&&"slice"!==meetOrSlice?(align=meetOrSlice,meetOrSlice="meet"):aspectRatioAttrs.length&&(align=aspectRatioAttrs.pop())),alignX="none"!==align?align.slice(1,4):"none",alignY="none"!==align?align.slice(5,8):"none",{meetOrSlice:meetOrSlice,alignX:alignX,alignY:alignY}}}}(exports),function(){function arcToSegments(toX,toY,rx,ry,large,sweep,rotateX){var argsString=_join.call(arguments);if(arcToSegmentsCache[argsString])return arcToSegmentsCache[argsString];var PI=Math.PI,th=rotateX*PI/180,sinTh=Math.sin(th),cosTh=Math.cos(th),fromX=0,fromY=0;rx=Math.abs(rx),ry=Math.abs(ry);var px=-cosTh*toX*.5-sinTh*toY*.5,py=-cosTh*toY*.5+sinTh*toX*.5,rx2=rx*rx,ry2=ry*ry,py2=py*py,px2=px*px,pl=rx2*ry2-rx2*py2-ry2*px2,root=0;if(0>pl){var s=Math.sqrt(1-pl/(rx2*ry2));rx*=s,ry*=s}else root=(large===sweep?-1:1)*Math.sqrt(pl/(rx2*py2+ry2*px2));var cx=root*rx*py/ry,cy=-root*ry*px/rx,cx1=cosTh*cx-sinTh*cy+.5*toX,cy1=sinTh*cx+cosTh*cy+.5*toY,mTheta=calcVectorAngle(1,0,(px-cx)/rx,(py-cy)/ry),dtheta=calcVectorAngle((px-cx)/rx,(py-cy)/ry,(-px-cx)/rx,(-py-cy)/ry);0===sweep&&dtheta>0?dtheta-=2*PI:1===sweep&&0>dtheta&&(dtheta+=2*PI);for(var segments=Math.ceil(Math.abs(dtheta/PI*2)),result=[],mDelta=dtheta/segments,mT=8/3*Math.sin(mDelta/4)*Math.sin(mDelta/4)/Math.sin(mDelta/2),th3=mTheta+mDelta,i=0;segments>i;i++)result[i]=segmentToBezier(mTheta,th3,cosTh,sinTh,rx,ry,cx1,cy1,mT,fromX,fromY),fromX=result[i][4],fromY=result[i][5],mTheta=th3,th3+=mDelta;return arcToSegmentsCache[argsString]=result,result}function segmentToBezier(th2,th3,cosTh,sinTh,rx,ry,cx1,cy1,mT,fromX,fromY){var argsString2=_join.call(arguments);if(segmentToBezierCache[argsString2])return segmentToBezierCache[argsString2];var costh2=Math.cos(th2),sinth2=Math.sin(th2),costh3=Math.cos(th3),sinth3=Math.sin(th3),toX=cosTh*rx*costh3-sinTh*ry*sinth3+cx1,toY=sinTh*rx*costh3+cosTh*ry*sinth3+cy1,cp1X=fromX+mT*(-cosTh*rx*sinth2-sinTh*ry*costh2),cp1Y=fromY+mT*(-sinTh*rx*sinth2+cosTh*ry*costh2),cp2X=toX+mT*(cosTh*rx*sinth3+sinTh*ry*costh3),cp2Y=toY+mT*(sinTh*rx*sinth3-cosTh*ry*costh3);return segmentToBezierCache[argsString2]=[cp1X,cp1Y,cp2X,cp2Y,toX,toY],segmentToBezierCache[argsString2]}function calcVectorAngle(ux,uy,vx,vy){var ta=Math.atan2(uy,ux),tb=Math.atan2(vy,vx);return tb>=ta?tb-ta:2*Math.PI-(ta-tb)}function getBoundsOfCurve(x0,y0,x1,y1,x2,y2,x3,y3){var argsString=_join.call(arguments);if(boundsOfCurveCache[argsString])return boundsOfCurveCache[argsString];var a,b,c,t,t1,t2,b2ac,sqrtb2ac,sqrt=Math.sqrt,min=Math.min,max=Math.max,abs=Math.abs,tvalues=[],bounds=[[],[]];b=6*x0-12*x1+6*x2,a=-3*x0+9*x1-9*x2+3*x3,c=3*x1-3*x0;for(var i=0;2>i;++i)if(i>0&&(b=6*y0-12*y1+6*y2,a=-3*y0+9*y1-9*y2+3*y3,c=3*y1-3*y0),abs(a)<1e-12){if(abs(b)<1e-12)continue;t=-c/b,t>0&&1>t&&tvalues.push(t)}else b2ac=b*b-4*c*a,0>b2ac||(sqrtb2ac=sqrt(b2ac),t1=(-b+sqrtb2ac)/(2*a),t1>0&&1>t1&&tvalues.push(t1),t2=(-b-sqrtb2ac)/(2*a),t2>0&&1>t2&&tvalues.push(t2));for(var x,y,mt,j=tvalues.length,jlen=j;j--;)t=tvalues[j],mt=1-t,x=mt*mt*mt*x0+3*mt*mt*t*x1+3*mt*t*t*x2+t*t*t*x3,bounds[0][j]=x,y=mt*mt*mt*y0+3*mt*mt*t*y1+3*mt*t*t*y2+t*t*t*y3,bounds[1][j]=y;bounds[0][jlen]=x0,bounds[1][jlen]=y0,bounds[0][jlen+1]=x3,bounds[1][jlen+1]=y3;var result=[{x:min.apply(null,bounds[0]),y:min.apply(null,bounds[1])},{x:max.apply(null,bounds[0]),y:max.apply(null,bounds[1])}];return boundsOfCurveCache[argsString]=result,result}var arcToSegmentsCache={},segmentToBezierCache={},boundsOfCurveCache={},_join=Array.prototype.join;fabric.util.drawArc=function(ctx,fx,fy,coords){for(var rx=coords[0],ry=coords[1],rot=coords[2],large=coords[3],sweep=coords[4],tx=coords[5],ty=coords[6],segs=[[],[],[],[]],segsNorm=arcToSegments(tx-fx,ty-fy,rx,ry,large,sweep,rot),i=0,len=segsNorm.length;len>i;i++)segs[i][0]=segsNorm[i][0]+fx,segs[i][1]=segsNorm[i][1]+fy,segs[i][2]=segsNorm[i][2]+fx,segs[i][3]=segsNorm[i][3]+fy,segs[i][4]=segsNorm[i][4]+fx,segs[i][5]=segsNorm[i][5]+fy,ctx.bezierCurveTo.apply(ctx,segs[i])},fabric.util.getBoundsOfArc=function(fx,fy,rx,ry,rot,large,sweep,tx,ty){for(var fromX=0,fromY=0,bound=[],bounds=[],segs=arcToSegments(tx-fx,ty-fy,rx,ry,large,sweep,rot),boundCopy=[[],[]],i=0,len=segs.length;len>i;i++)bound=getBoundsOfCurve(fromX,fromY,segs[i][0],segs[i][1],segs[i][2],segs[i][3],segs[i][4],segs[i][5]),boundCopy[0].x=bound[0].x+fx,boundCopy[0].y=bound[0].y+fy,boundCopy[1].x=bound[1].x+fx,boundCopy[1].y=bound[1].y+fy,bounds.push(boundCopy[0]),bounds.push(boundCopy[1]),fromX=segs[i][4],fromY=segs[i][5];return bounds},fabric.util.getBoundsOfCurve=getBoundsOfCurve}(),function(){function invoke(array,method){for(var args=slice.call(arguments,2),result=[],i=0,len=array.length;len>i;i++)result[i]=args.length?array[i][method].apply(array[i],args):array[i][method].call(array[i]);return result}function max(array,byProperty){return find(array,byProperty,function(value1,value2){return value1>=value2})}function min(array,byProperty){return find(array,byProperty,function(value1,value2){return value2>value1})}function fill(array,value){for(var k=array.length;k--;)array[k]=value;return array}function find(array,byProperty,condition){if(array&&0!==array.length){var i=array.length-1,result=byProperty?array[i][byProperty]:array[i];if(byProperty)for(;i--;)condition(array[i][byProperty],result)&&(result=array[i][byProperty]);else for(;i--;)condition(array[i],result)&&(result=array[i]);return result}}var slice=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement){if(void 0===this||null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if(0===len)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),n!==n?n=0:0!==n&&n!==Number.POSITIVE_INFINITY&&n!==Number.NEGATIVE_INFINITY&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=len)return-1;for(var k=n>=0?n:Math.max(len-Math.abs(n),0);len>k;k++)if(k in t&&t[k]===searchElement)return k;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(fn,context){for(var i=0,len=this.length>>>0;len>i;i++)i in this&&fn.call(context,this[i],i,this)}),Array.prototype.map||(Array.prototype.map=function(fn,context){for(var result=[],i=0,len=this.length>>>0;len>i;i++)i in this&&(result[i]=fn.call(context,this[i],i,this));return result}),Array.prototype.every||(Array.prototype.every=function(fn,context){for(var i=0,len=this.length>>>0;len>i;i++)if(i in this&&!fn.call(context,this[i],i,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(fn,context){for(var i=0,len=this.length>>>0;len>i;i++)if(i in this&&fn.call(context,this[i],i,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(fn,context){for(var val,result=[],i=0,len=this.length>>>0;len>i;i++)i in this&&(val=this[i],fn.call(context,val,i,this)&&result.push(val));return result}),Array.prototype.reduce||(Array.prototype.reduce=function(fn){var rv,len=this.length>>>0,i=0;if(arguments.length>1)rv=arguments[1];else for(;;){if(i in this){rv=this[i++];break}if(++i>=len)throw new TypeError}for(;len>i;i++)i in this&&(rv=fn.call(null,rv,this[i],i,this));return rv}),fabric.util.array={fill:fill,invoke:invoke,min:min,max:max}}(),function(){function extend(destination,source){for(var property in source)destination[property]=source[property];return destination}function clone(object){return extend({},object)}fabric.util.object={extend:extend,clone:clone}}(),function(){function camelize(string){return string.replace(/-+(.)?/g,function(match,character){return character?character.toUpperCase():""})}function capitalize(string,firstLetterOnly){return string.charAt(0).toUpperCase()+(firstLetterOnly?string.slice(1):string.slice(1).toLowerCase())}function escapeXml(string){return string.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:camelize,capitalize:capitalize,escapeXml:escapeXml}}(),function(){var slice=Array.prototype.slice,apply=Function.prototype.apply,Dummy=function(){};Function.prototype.bind||(Function.prototype.bind=function(thisArg){var bound,_this=this,args=slice.call(arguments,1);return bound=args.length?function(){return apply.call(_this,this instanceof Dummy?this:thisArg,args.concat(slice.call(arguments)))}:function(){return apply.call(_this,this instanceof Dummy?this:thisArg,arguments)},Dummy.prototype=this.prototype,bound.prototype=new Dummy,bound})}(),function(){function Subclass(){}function callSuper(methodName){var fn=this.constructor.superclass.prototype[methodName];return arguments.length>1?fn.apply(this,slice.call(arguments,1)):fn.call(this)}function createClass(){function klass(){this.initialize.apply(this,arguments)}var parent=null,properties=slice.call(arguments,0);"function"==typeof properties[0]&&(parent=properties.shift()),klass.superclass=parent,klass.subclasses=[],parent&&(Subclass.prototype=parent.prototype,klass.prototype=new Subclass,parent.subclasses.push(klass));for(var i=0,length=properties.length;length>i;i++)addMethods(klass,properties[i],parent);return klass.prototype.initialize||(klass.prototype.initialize=emptyFunction),klass.prototype.constructor=klass,klass.prototype.callSuper=callSuper,klass}var slice=Array.prototype.slice,emptyFunction=function(){},IS_DONTENUM_BUGGY=function(){for(var p in{toString:1})if("toString"===p)return!1;return!0}(),addMethods=function(klass,source,parent){for(var property in source)property in klass.prototype&&"function"==typeof klass.prototype[property]&&(source[property]+"").indexOf("callSuper")>-1?klass.prototype[property]=function(property){return function(){var superclass=this.constructor.superclass;this.constructor.superclass=parent;var returnValue=source[property].apply(this,arguments);return this.constructor.superclass=superclass,"initialize"!==property?returnValue:void 0}}(property):klass.prototype[property]=source[property],IS_DONTENUM_BUGGY&&(source.toString!==Object.prototype.toString&&(klass.prototype.toString=source.toString),source.valueOf!==Object.prototype.valueOf&&(klass.prototype.valueOf=source.valueOf))};fabric.util.createClass=createClass}(),function(){function areHostMethods(object){var t,i,methodNames=Array.prototype.slice.call(arguments,1),len=methodNames.length;for(i=0;len>i;i++)if(t=typeof object[methodNames[i]],!/^(?:function|object|unknown)$/.test(t))return!1;return!0}function createListener(uid,handler){return{handler:handler,wrappedHandler:createWrappedHandler(uid,handler)}}function createWrappedHandler(uid,handler){return function(e){handler.call(getElement(uid),e||fabric.window.event)}}function createDispatcher(uid,eventName){return function(e){if(handlers[uid]&&handlers[uid][eventName])for(var handlersForEvent=handlers[uid][eventName],i=0,len=handlersForEvent.length;len>i;i++)handlersForEvent[i].call(this,e||fabric.window.event)}}function getPointer(event){event||(event=fabric.window.event);var element=event.target||(typeof event.srcElement!==unknown?event.srcElement:null),scroll=fabric.util.getScrollLeftTop(element);return{x:pointerX(event)+scroll.left,y:pointerY(event)+scroll.top}}function _getPointer(event,pageProp,clientProp){var touchProp="touchend"===event.type?"changedTouches":"touches";return event[touchProp]&&event[touchProp][0]?event[touchProp][0][pageProp]-(event[touchProp][0][pageProp]-event[touchProp][0][clientProp])||event[clientProp]:event[clientProp]}var getElement,setElement,unknown="unknown",getUniqueId=function(){var uid=0;return function(element){return element.__uniqueID||(element.__uniqueID="uniqueID__"+uid++)}}();!function(){var elements={};getElement=function(uid){return elements[uid]},setElement=function(uid,element){elements[uid]=element}}();var addListener,removeListener,shouldUseAddListenerRemoveListener=areHostMethods(fabric.document.documentElement,"addEventListener","removeEventListener")&&areHostMethods(fabric.window,"addEventListener","removeEventListener"),shouldUseAttachEventDetachEvent=areHostMethods(fabric.document.documentElement,"attachEvent","detachEvent")&&areHostMethods(fabric.window,"attachEvent","detachEvent"),listeners={},handlers={};shouldUseAddListenerRemoveListener?(addListener=function(element,eventName,handler){element.addEventListener(eventName,handler,!1)},removeListener=function(element,eventName,handler){element.removeEventListener(eventName,handler,!1)}):shouldUseAttachEventDetachEvent?(addListener=function(element,eventName,handler){var uid=getUniqueId(element);setElement(uid,element),listeners[uid]||(listeners[uid]={}),listeners[uid][eventName]||(listeners[uid][eventName]=[]);var listener=createListener(uid,handler);listeners[uid][eventName].push(listener),element.attachEvent("on"+eventName,listener.wrappedHandler)},removeListener=function(element,eventName,handler){var listener,uid=getUniqueId(element);if(listeners[uid]&&listeners[uid][eventName])for(var i=0,len=listeners[uid][eventName].length;len>i;i++)listener=listeners[uid][eventName][i],listener&&listener.handler===handler&&(element.detachEvent("on"+eventName,listener.wrappedHandler),listeners[uid][eventName][i]=null)}):(addListener=function(element,eventName,handler){var uid=getUniqueId(element);if(handlers[uid]||(handlers[uid]={}),!handlers[uid][eventName]){handlers[uid][eventName]=[];var existingHandler=element["on"+eventName];existingHandler&&handlers[uid][eventName].push(existingHandler),element["on"+eventName]=createDispatcher(uid,eventName)}handlers[uid][eventName].push(handler)},removeListener=function(element,eventName,handler){var uid=getUniqueId(element);if(handlers[uid]&&handlers[uid][eventName])for(var handlersForEvent=handlers[uid][eventName],i=0,len=handlersForEvent.length;len>i;i++)handlersForEvent[i]===handler&&handlersForEvent.splice(i,1)}),fabric.util.addListener=addListener,fabric.util.removeListener=removeListener;var pointerX=function(event){return typeof event.clientX!==unknown?event.clientX:0},pointerY=function(event){return typeof event.clientY!==unknown?event.clientY:0};fabric.isTouchSupported&&(pointerX=function(event){return _getPointer(event,"pageX","clientX")},pointerY=function(event){return _getPointer(event,"pageY","clientY")}),fabric.util.getPointer=getPointer,fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function setStyle(element,styles){var elementStyle=element.style;if(!elementStyle)return element;if("string"==typeof styles)return element.style.cssText+=";"+styles,styles.indexOf("opacity")>-1?setOpacity(element,styles.match(/opacity:\s*(\d?\.?\d*)/)[1]):element;for(var property in styles)if("opacity"===property)setOpacity(element,styles[property]);else{var normalizedProperty="float"===property||"cssFloat"===property?"undefined"==typeof elementStyle.styleFloat?"cssFloat":"styleFloat":property;elementStyle[normalizedProperty]=styles[property]}return element}var parseEl=fabric.document.createElement("div"),supportsOpacity="string"==typeof parseEl.style.opacity,supportsFilters="string"==typeof parseEl.style.filter,reOpacity=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,setOpacity=function(element){return element};supportsOpacity?setOpacity=function(element,value){return element.style.opacity=value,element}:supportsFilters&&(setOpacity=function(element,value){var es=element.style;return element.currentStyle&&!element.currentStyle.hasLayout&&(es.zoom=1),reOpacity.test(es.filter)?(value=value>=.9999?"":"alpha(opacity="+100*value+")",es.filter=es.filter.replace(reOpacity,value)):es.filter+=" alpha(opacity="+100*value+")",element}),fabric.util.setStyle=setStyle}(),function(){function getById(id){return"string"==typeof id?fabric.document.getElementById(id):id}function makeElement(tagName,attributes){var el=fabric.document.createElement(tagName);for(var prop in attributes)"class"===prop?el.className=attributes[prop]:"for"===prop?el.htmlFor=attributes[prop]:el.setAttribute(prop,attributes[prop]);return el}function addClass(element,className){element&&-1===(" "+element.className+" ").indexOf(" "+className+" ")&&(element.className+=(element.className?" ":"")+className)}function wrapElement(element,wrapper,attributes){return"string"==typeof wrapper&&(wrapper=makeElement(wrapper,attributes)),element.parentNode&&element.parentNode.replaceChild(wrapper,element),wrapper.appendChild(element),wrapper}function getScrollLeftTop(element){for(var left=0,top=0,docElement=fabric.document.documentElement,body=fabric.document.body||{scrollLeft:0,scrollTop:0};element&&(element.parentNode||element.host)&&(element=element.parentNode||element.host,element===fabric.document?(left=body.scrollLeft||docElement.scrollLeft||0,top=body.scrollTop||docElement.scrollTop||0):(left+=element.scrollLeft||0,top+=element.scrollTop||0),1!==element.nodeType||"fixed"!==fabric.util.getElementStyle(element,"position")););return{left:left,top:top}}function getElementOffset(element){var docElem,scrollLeftTop,doc=element&&element.ownerDocument,box={left:0,top:0},offset={left:0,top:0},offsetAttributes={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!doc)return offset;for(var attr in offsetAttributes)offset[offsetAttributes[attr]]+=parseInt(getElementStyle(element,attr),10)||0;return docElem=doc.documentElement,"undefined"!=typeof element.getBoundingClientRect&&(box=element.getBoundingClientRect()),scrollLeftTop=getScrollLeftTop(element),{left:box.left+scrollLeftTop.left-(docElem.clientLeft||0)+offset.left,top:box.top+scrollLeftTop.top-(docElem.clientTop||0)+offset.top}}var sliceCanConvertNodelists,_slice=Array.prototype.slice,toArray=function(arrayLike){return _slice.call(arrayLike,0)};try{sliceCanConvertNodelists=toArray(fabric.document.childNodes)instanceof Array}catch(err){}sliceCanConvertNodelists||(toArray=function(arrayLike){for(var arr=new Array(arrayLike.length),i=arrayLike.length;i--;)arr[i]=arrayLike[i];return arr});var getElementStyle;getElementStyle=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(element,attr){var style=fabric.document.defaultView.getComputedStyle(element,null);return style?style[attr]:void 0}:function(element,attr){var value=element.style[attr];return!value&&element.currentStyle&&(value=element.currentStyle[attr]),value},function(){function makeElementUnselectable(element){return"undefined"!=typeof element.onselectstart&&(element.onselectstart=fabric.util.falseFunction),selectProp?element.style[selectProp]="none":"string"==typeof element.unselectable&&(element.unselectable="on"),element}function makeElementSelectable(element){return"undefined"!=typeof element.onselectstart&&(element.onselectstart=null),selectProp?element.style[selectProp]="":"string"==typeof element.unselectable&&(element.unselectable=""),element}var style=fabric.document.documentElement.style,selectProp="userSelect"in style?"userSelect":"MozUserSelect"in style?"MozUserSelect":"WebkitUserSelect"in style?"WebkitUserSelect":"KhtmlUserSelect"in style?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=makeElementUnselectable,fabric.util.makeElementSelectable=makeElementSelectable}(),function(){function getScript(url,callback){var headEl=fabric.document.getElementsByTagName("head")[0],scriptEl=fabric.document.createElement("script"),loading=!0;scriptEl.onload=scriptEl.onreadystatechange=function(e){if(loading){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;loading=!1,callback(e||fabric.window.event),scriptEl=scriptEl.onload=scriptEl.onreadystatechange=null}},scriptEl.src=url,headEl.appendChild(scriptEl)}fabric.util.getScript=getScript}(),fabric.util.getById=getById,fabric.util.toArray=toArray,fabric.util.makeElement=makeElement,fabric.util.addClass=addClass,fabric.util.wrapElement=wrapElement,fabric.util.getScrollLeftTop=getScrollLeftTop,fabric.util.getElementOffset=getElementOffset,fabric.util.getElementStyle=getElementStyle}(),function(){function addParamToUrl(url,param){return url+(/\?/.test(url)?"&":"?")+param}function emptyFn(){}function request(url,options){options||(options={});var body,method=options.method?options.method.toUpperCase():"GET",onComplete=options.onComplete||function(){},xhr=makeXHR();return xhr.onreadystatechange=function(){4===xhr.readyState&&(onComplete(xhr),xhr.onreadystatechange=emptyFn)},"GET"===method&&(body=null,"string"==typeof options.parameters&&(url=addParamToUrl(url,options.parameters))),xhr.open(method,url,!0),"POST"!==method&&"PUT"!==method||xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(body),xhr}var makeXHR=function(){for(var factories=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],i=factories.length;i--;)try{var req=factories[i]();if(req)return factories[i]}catch(err){}}();fabric.util.request=request}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(methodName){"undefined"!=typeof console[methodName]&&"function"==typeof console[methodName].apply&&(fabric[methodName]=function(){return console[methodName].apply(console,arguments)})}),function(){function animate(options){requestAnimFrame(function(timestamp){options||(options={});var time,start=timestamp||+new Date,duration=options.duration||500,finish=start+duration,onChange=options.onChange||function(){},abort=options.abort||function(){
return!1},easing=options.easing||function(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b},startValue="startValue"in options?options.startValue:0,endValue="endValue"in options?options.endValue:100,byValue=options.byValue||endValue-startValue;options.onStart&&options.onStart(),function tick(ticktime){time=ticktime||+new Date;var currentTime=time>finish?duration:time-start;return abort()?void(options.onComplete&&options.onComplete()):(onChange(easing(currentTime,startValue,byValue,duration)),time>finish?void(options.onComplete&&options.onComplete()):void requestAnimFrame(tick))}(start)})}function requestAnimFrame(){return _requestAnimFrame.apply(fabric.window,arguments)}var _requestAnimFrame=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(callback){fabric.window.setTimeout(callback,1e3/60)};fabric.util.animate=animate,fabric.util.requestAnimFrame=requestAnimFrame}(),function(){function normalize(a,c,p,s){return a<Math.abs(c)?(a=c,s=p/4):s=0===c&&0===a?p/(2*Math.PI)*Math.asin(1):p/(2*Math.PI)*Math.asin(c/a),{a:a,c:c,p:p,s:s}}function elastic(opts,t,d){return opts.a*Math.pow(2,10*(t-=1))*Math.sin((t*d-opts.s)*(2*Math.PI)/opts.p)}function easeOutCubic(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b}function easeInOutCubic(t,b,c,d){return t/=d/2,1>t?c/2*t*t*t+b:c/2*((t-=2)*t*t+2)+b}function easeInQuart(t,b,c,d){return c*(t/=d)*t*t*t+b}function easeOutQuart(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b}function easeInOutQuart(t,b,c,d){return t/=d/2,1>t?c/2*t*t*t*t+b:-c/2*((t-=2)*t*t*t-2)+b}function easeInQuint(t,b,c,d){return c*(t/=d)*t*t*t*t+b}function easeOutQuint(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b}function easeInOutQuint(t,b,c,d){return t/=d/2,1>t?c/2*t*t*t*t*t+b:c/2*((t-=2)*t*t*t*t+2)+b}function easeInSine(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b}function easeOutSine(t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b}function easeInOutSine(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b}function easeInExpo(t,b,c,d){return 0===t?b:c*Math.pow(2,10*(t/d-1))+b}function easeOutExpo(t,b,c,d){return t===d?b+c:c*(-Math.pow(2,-10*t/d)+1)+b}function easeInOutExpo(t,b,c,d){return 0===t?b:t===d?b+c:(t/=d/2,1>t?c/2*Math.pow(2,10*(t-1))+b:c/2*(-Math.pow(2,-10*--t)+2)+b)}function easeInCirc(t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b}function easeOutCirc(t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b}function easeInOutCirc(t,b,c,d){return t/=d/2,1>t?-c/2*(Math.sqrt(1-t*t)-1)+b:c/2*(Math.sqrt(1-(t-=2)*t)+1)+b}function easeInElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(0===t)return b;if(t/=d,1===t)return b+c;p||(p=.3*d);var opts=normalize(a,c,p,s);return-elastic(opts,t,d)+b}function easeOutElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(0===t)return b;if(t/=d,1===t)return b+c;p||(p=.3*d);var opts=normalize(a,c,p,s);return opts.a*Math.pow(2,-10*t)*Math.sin((t*d-opts.s)*(2*Math.PI)/opts.p)+opts.c+b}function easeInOutElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(0===t)return b;if(t/=d/2,2===t)return b+c;p||(p=d*(.3*1.5));var opts=normalize(a,c,p,s);return 1>t?-.5*elastic(opts,t,d)+b:opts.a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-opts.s)*(2*Math.PI)/opts.p)*.5+opts.c+b}function easeInBack(t,b,c,d,s){return void 0===s&&(s=1.70158),c*(t/=d)*t*((s+1)*t-s)+b}function easeOutBack(t,b,c,d,s){return void 0===s&&(s=1.70158),c*((t=t/d-1)*t*((s+1)*t+s)+1)+b}function easeInOutBack(t,b,c,d,s){return void 0===s&&(s=1.70158),t/=d/2,1>t?c/2*(t*t*(((s*=1.525)+1)*t-s))+b:c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b}function easeInBounce(t,b,c,d){return c-easeOutBounce(d-t,0,c,d)+b}function easeOutBounce(t,b,c,d){return(t/=d)<1/2.75?c*(7.5625*t*t)+b:2/2.75>t?c*(7.5625*(t-=1.5/2.75)*t+.75)+b:2.5/2.75>t?c*(7.5625*(t-=2.25/2.75)*t+.9375)+b:c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}function easeInOutBounce(t,b,c,d){return d/2>t?.5*easeInBounce(2*t,0,c,d)+b:.5*easeOutBounce(2*t-d,0,c,d)+.5*c+b}fabric.util.ease={easeInQuad:function(t,b,c,d){return c*(t/=d)*t+b},easeOutQuad:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},easeInOutQuad:function(t,b,c,d){return t/=d/2,1>t?c/2*t*t+b:-c/2*(--t*(t-2)-1)+b},easeInCubic:function(t,b,c,d){return c*(t/=d)*t*t+b},easeOutCubic:easeOutCubic,easeInOutCubic:easeInOutCubic,easeInQuart:easeInQuart,easeOutQuart:easeOutQuart,easeInOutQuart:easeInOutQuart,easeInQuint:easeInQuint,easeOutQuint:easeOutQuint,easeInOutQuint:easeInOutQuint,easeInSine:easeInSine,easeOutSine:easeOutSine,easeInOutSine:easeInOutSine,easeInExpo:easeInExpo,easeOutExpo:easeOutExpo,easeInOutExpo:easeInOutExpo,easeInCirc:easeInCirc,easeOutCirc:easeOutCirc,easeInOutCirc:easeInOutCirc,easeInElastic:easeInElastic,easeOutElastic:easeOutElastic,easeInOutElastic:easeInOutElastic,easeInBack:easeInBack,easeOutBack:easeOutBack,easeInOutBack:easeInOutBack,easeInBounce:easeInBounce,easeOutBounce:easeOutBounce,easeInOutBounce:easeInOutBounce}}(),function(global){"use strict";function normalizeAttr(attr){return attr in attributesMap?attributesMap[attr]:attr}function normalizeValue(attr,value,parentAttributes,fontSize){var parsed,isArray="[object Array]"===Object.prototype.toString.call(value);return"fill"!==attr&&"stroke"!==attr||"none"!==value?"strokeDashArray"===attr?value=value.replace(/,/g," ").split(/\s+/).map(function(n){return parseFloat(n)}):"transformMatrix"===attr?value=parentAttributes&&parentAttributes.transformMatrix?multiplyTransformMatrices(parentAttributes.transformMatrix,fabric.parseTransformAttribute(value)):fabric.parseTransformAttribute(value):"visible"===attr?(value="none"!==value&&"hidden"!==value,parentAttributes&&parentAttributes.visible===!1&&(value=!1)):"originX"===attr?value="start"===value?"left":"end"===value?"right":"center":parsed=isArray?value.map(parseUnit):parseUnit(value,fontSize):value="",!isArray&&isNaN(parsed)?value:parsed}function _setStrokeFillOpacity(attributes){for(var attr in colorAttributes)if("undefined"!=typeof attributes[colorAttributes[attr]]&&""!==attributes[attr]){if("undefined"==typeof attributes[attr]){if(!fabric.Object.prototype[attr])continue;attributes[attr]=fabric.Object.prototype[attr]}if(0!==attributes[attr].indexOf("url(")){var color=new fabric.Color(attributes[attr]);attributes[attr]=color.setAlpha(toFixed(color.getAlpha()*attributes[colorAttributes[attr]],2)).toRgba()}}return attributes}function parseStyleString(style,oStyle){var attr,value;style.replace(/;\s*$/,"").split(";").forEach(function(chunk){var pair=chunk.split(":");attr=normalizeAttr(pair[0].trim().toLowerCase()),value=normalizeValue(attr,pair[1].trim()),oStyle[attr]=value})}function parseStyleObject(style,oStyle){var attr,value;for(var prop in style)"undefined"!=typeof style[prop]&&(attr=normalizeAttr(prop.toLowerCase()),value=normalizeValue(attr,style[prop]),oStyle[attr]=value)}function getGlobalStylesForElement(element,svgUid){var styles={};for(var rule in fabric.cssRules[svgUid])if(elementMatchesRule(element,rule.split(" ")))for(var property in fabric.cssRules[svgUid][rule])styles[property]=fabric.cssRules[svgUid][rule][property];return styles}function elementMatchesRule(element,selectors){var firstMatching,parentMatching=!0;return firstMatching=selectorMatches(element,selectors.pop()),firstMatching&&selectors.length&&(parentMatching=doesSomeParentMatch(element,selectors)),firstMatching&&parentMatching&&0===selectors.length}function doesSomeParentMatch(element,selectors){for(var selector,parentMatching=!0;element.parentNode&&1===element.parentNode.nodeType&&selectors.length;)parentMatching&&(selector=selectors.pop()),element=element.parentNode,parentMatching=selectorMatches(element,selector);return 0===selectors.length}function selectorMatches(element,selector){var matcher,nodeName=element.nodeName,classNames=element.getAttribute("class"),id=element.getAttribute("id");if(matcher=new RegExp("^"+nodeName,"i"),selector=selector.replace(matcher,""),id&&selector.length&&(matcher=new RegExp("#"+id+"(?![a-zA-Z\\-]+)","i"),selector=selector.replace(matcher,"")),classNames&&selector.length){classNames=classNames.split(" ");for(var i=classNames.length;i--;)matcher=new RegExp("\\."+classNames[i]+"(?![a-zA-Z\\-]+)","i"),selector=selector.replace(matcher,"")}return 0===selector.length}function elementById(doc,id){var el;if(doc.getElementById&&(el=doc.getElementById(id)),el)return el;var node,i,nodelist=doc.getElementsByTagName("*");for(i=0;i<nodelist.length;i++)if(node=nodelist[i],id===node.getAttribute("id"))return node}function parseUseDirectives(doc){for(var nodelist=doc.getElementsByTagName("use"),i=0;nodelist.length&&i<nodelist.length;){var parentNode,attr,j,attrs,l,el=nodelist[i],xlink=el.getAttribute("xlink:href").substr(1),x=el.getAttribute("x")||0,y=el.getAttribute("y")||0,el2=elementById(doc,xlink).cloneNode(!0),currentTrans=(el2.getAttribute("transform")||"")+" translate("+x+", "+y+")",oldLength=nodelist.length;if(applyViewboxTransform(el2),/^svg$/i.test(el2.nodeName)){var el3=el2.ownerDocument.createElement("g");for(j=0,attrs=el2.attributes,l=attrs.length;l>j;j++)attr=attrs.item(j),el3.setAttribute(attr.nodeName,attr.nodeValue);for(;null!=el2.firstChild;)el3.appendChild(el2.firstChild);el2=el3}for(j=0,attrs=el.attributes,l=attrs.length;l>j;j++)attr=attrs.item(j),"x"!==attr.nodeName&&"y"!==attr.nodeName&&"xlink:href"!==attr.nodeName&&("transform"===attr.nodeName?currentTrans=attr.nodeValue+" "+currentTrans:el2.setAttribute(attr.nodeName,attr.nodeValue));el2.setAttribute("transform",currentTrans),el2.setAttribute("instantiated_by_use","1"),el2.removeAttribute("id"),parentNode=el.parentNode,parentNode.replaceChild(el2,el),nodelist.length===oldLength&&i++}}function applyViewboxTransform(element){var viewBoxWidth,viewBoxHeight,matrix,el,viewBoxAttr=element.getAttribute("viewBox"),scaleX=1,scaleY=1,minX=0,minY=0,widthAttr=element.getAttribute("width"),heightAttr=element.getAttribute("height"),x=element.getAttribute("x")||0,y=element.getAttribute("y")||0,preserveAspectRatio=element.getAttribute("preserveAspectRatio")||"",missingViewBox=!viewBoxAttr||!reViewBoxTagNames.test(element.tagName)||!(viewBoxAttr=viewBoxAttr.match(reViewBoxAttrValue)),missingDimAttr=!widthAttr||!heightAttr||"100%"===widthAttr||"100%"===heightAttr,toBeParsed=missingViewBox&&missingDimAttr,parsedDim={},translateMatrix="";if(parsedDim.width=0,parsedDim.height=0,parsedDim.toBeParsed=toBeParsed,toBeParsed)return parsedDim;if(missingViewBox)return parsedDim.width=parseUnit(widthAttr),parsedDim.height=parseUnit(heightAttr),parsedDim;if(minX=-parseFloat(viewBoxAttr[1]),minY=-parseFloat(viewBoxAttr[2]),viewBoxWidth=parseFloat(viewBoxAttr[3]),viewBoxHeight=parseFloat(viewBoxAttr[4]),missingDimAttr?(parsedDim.width=viewBoxWidth,parsedDim.height=viewBoxHeight):(parsedDim.width=parseUnit(widthAttr),parsedDim.height=parseUnit(heightAttr),scaleX=parsedDim.width/viewBoxWidth,scaleY=parsedDim.height/viewBoxHeight),preserveAspectRatio=fabric.util.parsePreserveAspectRatioAttribute(preserveAspectRatio),"none"!==preserveAspectRatio.alignX&&(scaleY=scaleX=scaleX>scaleY?scaleY:scaleX),1===scaleX&&1===scaleY&&0===minX&&0===minY&&0===x&&0===y)return parsedDim;if((x||y)&&(translateMatrix=" translate("+parseUnit(x)+" "+parseUnit(y)+") "),matrix=translateMatrix+" matrix("+scaleX+" 0 0 "+scaleY+" "+minX*scaleX+" "+minY*scaleY+") ","svg"===element.tagName){for(el=element.ownerDocument.createElement("g");null!=element.firstChild;)el.appendChild(element.firstChild);element.appendChild(el)}else el=element,matrix=el.getAttribute("transform")+matrix;return el.setAttribute("transform",matrix),parsedDim}function _enlivenCachedObject(cachedObject){var objects=cachedObject.objects,options=cachedObject.options;return objects=objects.map(function(o){return fabric[capitalize(o.type)].fromObject(o)}),{objects:objects,options:options}}function _createSVGPattern(markup,canvas,property){canvas[property]&&canvas[property].toSVG&&markup.push('	<pattern x="0" y="0" id="',property,'Pattern" ','width="',canvas[property].source.width,'" height="',canvas[property].source.height,'" patternUnits="userSpaceOnUse">\n','		<image x="0" y="0" ','width="',canvas[property].source.width,'" height="',canvas[property].source.height,'" xlink:href="',canvas[property].source.src,'"></image>\n	</pattern>\n')}var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,capitalize=fabric.util.string.capitalize,clone=fabric.util.object.clone,toFixed=fabric.util.toFixed,parseUnit=fabric.util.parseUnit,multiplyTransformMatrices=fabric.util.multiplyTransformMatrices,reAllowedSVGTagNames=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,reViewBoxTagNames=/^(symbol|image|marker|pattern|view|svg)$/i,reNotAllowedAncestors=/^(?:pattern|defs|symbol|metadata)$/i,reAllowedParents=/^(symbol|g|a|svg)$/i,attributesMap={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},colorAttributes={stroke:"strokeOpacity",fill:"fillOpacity"};fabric.cssRules={},fabric.gradientDefs={},fabric.parseTransformAttribute=function(){function rotateMatrix(matrix,args){var angle=args[0],x=3===args.length?args[1]:0,y=3===args.length?args[2]:0;matrix[0]=Math.cos(angle),matrix[1]=Math.sin(angle),matrix[2]=-Math.sin(angle),matrix[3]=Math.cos(angle),matrix[4]=x-(matrix[0]*x+matrix[2]*y),matrix[5]=y-(matrix[1]*x+matrix[3]*y)}function scaleMatrix(matrix,args){var multiplierX=args[0],multiplierY=2===args.length?args[1]:args[0];matrix[0]=multiplierX,matrix[3]=multiplierY}function skewXMatrix(matrix,args){matrix[2]=Math.tan(fabric.util.degreesToRadians(args[0]))}function skewYMatrix(matrix,args){matrix[1]=Math.tan(fabric.util.degreesToRadians(args[0]))}function translateMatrix(matrix,args){matrix[4]=args[0],2===args.length&&(matrix[5]=args[1])}var iMatrix=[1,0,0,1,0,0],number=fabric.reNum,commaWsp="(?:\\s+,?\\s*|,\\s*)",skewX="(?:(skewX)\\s*\\(\\s*("+number+")\\s*\\))",skewY="(?:(skewY)\\s*\\(\\s*("+number+")\\s*\\))",rotate="(?:(rotate)\\s*\\(\\s*("+number+")(?:"+commaWsp+"("+number+")"+commaWsp+"("+number+"))?\\s*\\))",scale="(?:(scale)\\s*\\(\\s*("+number+")(?:"+commaWsp+"("+number+"))?\\s*\\))",translate="(?:(translate)\\s*\\(\\s*("+number+")(?:"+commaWsp+"("+number+"))?\\s*\\))",matrix="(?:(matrix)\\s*\\(\\s*("+number+")"+commaWsp+"("+number+")"+commaWsp+"("+number+")"+commaWsp+"("+number+")"+commaWsp+"("+number+")"+commaWsp+"("+number+")\\s*\\))",transform="(?:"+matrix+"|"+translate+"|"+scale+"|"+rotate+"|"+skewX+"|"+skewY+")",transforms="(?:"+transform+"(?:"+commaWsp+"*"+transform+")*)",transformList="^\\s*(?:"+transforms+"?)\\s*$",reTransformList=new RegExp(transformList),reTransform=new RegExp(transform,"g");return function(attributeValue){var matrix=iMatrix.concat(),matrices=[];if(!attributeValue||attributeValue&&!reTransformList.test(attributeValue))return matrix;attributeValue.replace(reTransform,function(match){var m=new RegExp(transform).exec(match).filter(function(match){return""!==match&&null!=match}),operation=m[1],args=m.slice(2).map(parseFloat);switch(operation){case"translate":translateMatrix(matrix,args);break;case"rotate":args[0]=fabric.util.degreesToRadians(args[0]),rotateMatrix(matrix,args);break;case"scale":scaleMatrix(matrix,args);break;case"skewX":skewXMatrix(matrix,args);break;case"skewY":skewYMatrix(matrix,args);break;case"matrix":matrix=args}matrices.push(matrix.concat()),matrix=iMatrix.concat()});for(var combinedMatrix=matrices[0];matrices.length>1;)matrices.shift(),combinedMatrix=fabric.util.multiplyTransformMatrices(combinedMatrix,matrices[0]);return combinedMatrix}}();var reViewBoxAttrValue=new RegExp("^\\s*("+fabric.reNum+"+)\\s*,?\\s*("+fabric.reNum+"+)\\s*,?\\s*("+fabric.reNum+"+)\\s*,?\\s*("+fabric.reNum+"+)\\s*$");fabric.parseSVGDocument=function(){function hasAncestorWithNodeName(element,nodeName){for(;element&&(element=element.parentNode);)if(nodeName.test(element.nodeName)&&!element.getAttribute("instantiated_by_use"))return!0;return!1}return function(doc,callback,reviver){if(doc){parseUseDirectives(doc);var startTime=new Date,svgUid=fabric.Object.__uid++,options=applyViewboxTransform(doc),descendants=fabric.util.toArray(doc.getElementsByTagName("*"));if(options.svgUid=svgUid,0===descendants.length&&fabric.isLikelyNode){descendants=doc.selectNodes('//*[name(.)!="svg"]');for(var arr=[],i=0,len=descendants.length;len>i;i++)arr[i]=descendants[i];descendants=arr}var elements=descendants.filter(function(el){return applyViewboxTransform(el),reAllowedSVGTagNames.test(el.tagName)&&!hasAncestorWithNodeName(el,reNotAllowedAncestors)});if(!elements||elements&&!elements.length)return void(callback&&callback([],{}));fabric.gradientDefs[svgUid]=fabric.getGradientDefs(doc),fabric.cssRules[svgUid]=fabric.getCSSRules(doc),fabric.parseElements(elements,function(instances){fabric.documentParsingTime=new Date-startTime,callback&&callback(instances,options)},clone(options),reviver)}}}();var svgCache={has:function(name,callback){callback(!1)},get:function(){},set:function(){}},reFontDeclaration=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+fabric.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+fabric.reNum+"))?\\s+(.*)");extend(fabric,{parseFontDeclaration:function(value,oStyle){var match=value.match(reFontDeclaration);if(match){var fontStyle=match[1],fontWeight=match[3],fontSize=match[4],lineHeight=match[5],fontFamily=match[6];fontStyle&&(oStyle.fontStyle=fontStyle),fontWeight&&(oStyle.fontWeight=isNaN(parseFloat(fontWeight))?fontWeight:parseFloat(fontWeight)),fontSize&&(oStyle.fontSize=parseUnit(fontSize)),fontFamily&&(oStyle.fontFamily=fontFamily),lineHeight&&(oStyle.lineHeight="normal"===lineHeight?1:lineHeight)}},getGradientDefs:function(doc){var el,i,id,xlink,linearGradientEls=doc.getElementsByTagName("linearGradient"),radialGradientEls=doc.getElementsByTagName("radialGradient"),j=0,elList=[],gradientDefs={},idsToXlinkMap={};for(elList.length=linearGradientEls.length+radialGradientEls.length,i=linearGradientEls.length;i--;)elList[j++]=linearGradientEls[i];for(i=radialGradientEls.length;i--;)elList[j++]=radialGradientEls[i];for(;j--;)el=elList[j],xlink=el.getAttribute("xlink:href"),id=el.getAttribute("id"),xlink&&(idsToXlinkMap[id]=xlink.substr(1)),gradientDefs[id]=el;for(id in idsToXlinkMap){var el2=gradientDefs[idsToXlinkMap[id]].cloneNode(!0);for(el=gradientDefs[id];el2.firstChild;)el.appendChild(el2.firstChild)}return gradientDefs},parseAttributes:function(element,attributes,svgUid){if(element){var value,fontSize,parentAttributes={};"undefined"==typeof svgUid&&(svgUid=element.getAttribute("svgUid")),element.parentNode&&reAllowedParents.test(element.parentNode.nodeName)&&(parentAttributes=fabric.parseAttributes(element.parentNode,attributes,svgUid)),fontSize=parentAttributes&&parentAttributes.fontSize||element.getAttribute("font-size")||fabric.Text.DEFAULT_SVG_FONT_SIZE;var ownAttributes=attributes.reduce(function(memo,attr){return value=element.getAttribute(attr),value&&(attr=normalizeAttr(attr),value=normalizeValue(attr,value,parentAttributes,fontSize),memo[attr]=value),memo},{});return ownAttributes=extend(ownAttributes,extend(getGlobalStylesForElement(element,svgUid),fabric.parseStyleAttribute(element))),ownAttributes.font&&fabric.parseFontDeclaration(ownAttributes.font,ownAttributes),_setStrokeFillOpacity(extend(parentAttributes,ownAttributes))}},parseElements:function(elements,callback,options,reviver){new fabric.ElementsParser(elements,callback,options,reviver).parse()},parseStyleAttribute:function(element){var oStyle={},style=element.getAttribute("style");return style?("string"==typeof style?parseStyleString(style,oStyle):parseStyleObject(style,oStyle),oStyle):oStyle},parsePointsAttribute:function(points){if(!points)return null;points=points.replace(/,/g," ").trim(),points=points.split(/\s+/);var i,len,parsedPoints=[];for(i=0,len=points.length;len>i;i+=2)parsedPoints.push({x:parseFloat(points[i]),y:parseFloat(points[i+1])});return parsedPoints},getCSSRules:function(doc){for(var rules,styles=doc.getElementsByTagName("style"),allRules={},i=0,len=styles.length;len>i;i++){var styleContents=styles[i].textContent||styles[i].text;styleContents=styleContents.replace(/\/\*[\s\S]*?\*\//g,""),""!==styleContents.trim()&&(rules=styleContents.match(/[^{]*\{[\s\S]*?\}/g),rules=rules.map(function(rule){return rule.trim()}),rules.forEach(function(rule){for(var match=rule.match(/([\s\S]*?)\s*\{([^}]*)\}/),ruleObj={},declaration=match[2].trim(),propertyValuePairs=declaration.replace(/;$/,"").split(/\s*;\s*/),i=0,len=propertyValuePairs.length;len>i;i++){var pair=propertyValuePairs[i].split(/\s*:\s*/),property=normalizeAttr(pair[0]),value=normalizeValue(property,pair[1],pair[0]);ruleObj[property]=value}rule=match[1],rule.split(",").forEach(function(_rule){_rule=_rule.replace(/^svg/i,"").trim(),""!==_rule&&(allRules[_rule]=fabric.util.object.clone(ruleObj))})}))}return allRules},loadSVGFromURL:function(url,callback,reviver){function onComplete(r){var xml=r.responseXML;xml&&!xml.documentElement&&fabric.window.ActiveXObject&&r.responseText&&(xml=new ActiveXObject("Microsoft.XMLDOM"),xml.async="false",xml.loadXML(r.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),xml&&xml.documentElement&&fabric.parseSVGDocument(xml.documentElement,function(results,options){svgCache.set(url,{objects:fabric.util.array.invoke(results,"toObject"),options:options}),callback(results,options)},reviver)}url=url.replace(/^\n\s*/,"").trim(),svgCache.has(url,function(hasUrl){hasUrl?svgCache.get(url,function(value){var enlivedRecord=_enlivenCachedObject(value);callback(enlivedRecord.objects,enlivedRecord.options)}):new fabric.util.request(url,{method:"get",onComplete:onComplete})})},loadSVGFromString:function(string,callback,reviver){string=string.trim();var doc;if("undefined"!=typeof DOMParser){var parser=new DOMParser;parser&&parser.parseFromString&&(doc=parser.parseFromString(string,"text/xml"))}else fabric.window.ActiveXObject&&(doc=new ActiveXObject("Microsoft.XMLDOM"),doc.async="false",doc.loadXML(string.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));fabric.parseSVGDocument(doc.documentElement,function(results,options){callback(results,options)},reviver)},createSVGFontFacesMarkup:function(objects){for(var obj,fontFamily,style,row,rowIndex,_char,charIndex,markup="",fontList={},fontPaths=fabric.fontPaths,i=0,len=objects.length;len>i;i++)if(obj=objects[i],fontFamily=obj.fontFamily,-1!==obj.type.indexOf("text")&&!fontList[fontFamily]&&fontPaths[fontFamily]&&(fontList[fontFamily]=!0,obj.styles)){style=obj.styles;for(rowIndex in style){row=style[rowIndex];for(charIndex in row)_char=row[charIndex],fontFamily=_char.fontFamily,!fontList[fontFamily]&&fontPaths[fontFamily]&&(fontList[fontFamily]=!0)}}for(var j in fontList)markup+=["		@font-face {\n","			font-family: '",j,"';\n","			src: url('",fontPaths[j],"');\n","		}\n"].join("");return markup&&(markup=['	<style type="text/css">',"<![CDATA[\n",markup,"]]>","</style>\n"].join("")),markup},createSVGRefElementsMarkup:function(canvas){var markup=[];return _createSVGPattern(markup,canvas,"backgroundColor"),_createSVGPattern(markup,canvas,"overlayColor"),markup.join("")}})}(exports),fabric.ElementsParser=function(elements,callback,options,reviver){this.elements=elements,this.callback=callback,this.options=options,this.reviver=reviver,this.svgUid=options&&options.svgUid||0},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var i=0,len=this.elements.length;len>i;i++)this.elements[i].setAttribute("svgUid",this.svgUid),function(_this,i){setTimeout(function(){_this.createObject(_this.elements[i],i)},0)}(this,i)},fabric.ElementsParser.prototype.createObject=function(el,index){var klass=fabric[fabric.util.string.capitalize(el.tagName)];if(klass&&klass.fromElement)try{this._createObject(klass,el,index)}catch(err){fabric.log(err)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(klass,el,index){if(klass.async)klass.fromElement(el,this.createCallback(index,el),this.options);else{var obj=klass.fromElement(el,this.options);this.resolveGradient(obj,"fill"),this.resolveGradient(obj,"stroke"),this.reviver&&this.reviver(el,obj),this.instances[index]=obj,this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(index,el){var _this=this;return function(obj){_this.resolveGradient(obj,"fill"),_this.resolveGradient(obj,"stroke"),_this.reviver&&_this.reviver(el,obj),_this.instances[index]=obj,_this.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(obj,property){var instanceFillValue=obj.get(property);if(/^url\(/.test(instanceFillValue)){var gradientId=instanceFillValue.slice(5,instanceFillValue.length-1);fabric.gradientDefs[this.svgUid][gradientId]&&obj.set(property,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][gradientId],obj))}},fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(el){return null!=el}),this.callback(this.instances))},function(global){"use strict";function Point(x,y){this.x=x,this.y=y}var fabric=global.fabric||(global.fabric={});return fabric.Point?void fabric.warn("fabric.Point is already defined"):(fabric.Point=Point,void(Point.prototype={constructor:Point,add:function(that){return new Point(this.x+that.x,this.y+that.y)},addEquals:function(that){return this.x+=that.x,this.y+=that.y,this},scalarAdd:function(scalar){return new Point(this.x+scalar,this.y+scalar)},scalarAddEquals:function(scalar){return this.x+=scalar,this.y+=scalar,this},subtract:function(that){return new Point(this.x-that.x,this.y-that.y)},subtractEquals:function(that){return this.x-=that.x,this.y-=that.y,this},scalarSubtract:function(scalar){return new Point(this.x-scalar,this.y-scalar)},scalarSubtractEquals:function(scalar){return this.x-=scalar,this.y-=scalar,this},multiply:function(scalar){return new Point(this.x*scalar,this.y*scalar)},multiplyEquals:function(scalar){return this.x*=scalar,this.y*=scalar,this},divide:function(scalar){return new Point(this.x/scalar,this.y/scalar)},divideEquals:function(scalar){return this.x/=scalar,this.y/=scalar,this},eq:function(that){return this.x===that.x&&this.y===that.y},lt:function(that){return this.x<that.x&&this.y<that.y},lte:function(that){return this.x<=that.x&&this.y<=that.y},gt:function(that){return this.x>that.x&&this.y>that.y},gte:function(that){return this.x>=that.x&&this.y>=that.y},lerp:function(that,t){return new Point(this.x+(that.x-this.x)*t,this.y+(that.y-this.y)*t)},distanceFrom:function(that){var dx=this.x-that.x,dy=this.y-that.y;return Math.sqrt(dx*dx+dy*dy)},midPointFrom:function(that){return new Point(this.x+(that.x-this.x)/2,this.y+(that.y-this.y)/2)},min:function(that){return new Point(Math.min(this.x,that.x),Math.min(this.y,that.y))},max:function(that){return new Point(Math.max(this.x,that.x),Math.max(this.y,that.y))},toString:function(){return this.x+","+this.y},setXY:function(x,y){this.x=x,this.y=y},setFromPoint:function(that){this.x=that.x,this.y=that.y},swap:function(that){var x=this.x,y=this.y;this.x=that.x,this.y=that.y,that.x=x,that.y=y}}))}(exports),function(global){"use strict";function Intersection(status){this.status=status,this.points=[]}var fabric=global.fabric||(global.fabric={});return fabric.Intersection?void fabric.warn("fabric.Intersection is already defined"):(fabric.Intersection=Intersection,fabric.Intersection.prototype={appendPoint:function(point){this.points.push(point)},appendPoints:function(points){this.points=this.points.concat(points)}},fabric.Intersection.intersectLineLine=function(a1,a2,b1,b2){var result,uaT=(b2.x-b1.x)*(a1.y-b1.y)-(b2.y-b1.y)*(a1.x-b1.x),ubT=(a2.x-a1.x)*(a1.y-b1.y)-(a2.y-a1.y)*(a1.x-b1.x),uB=(b2.y-b1.y)*(a2.x-a1.x)-(b2.x-b1.x)*(a2.y-a1.y);if(0!==uB){var ua=uaT/uB,ub=ubT/uB;ua>=0&&1>=ua&&ub>=0&&1>=ub?(result=new Intersection("Intersection"),result.points.push(new fabric.Point(a1.x+ua*(a2.x-a1.x),a1.y+ua*(a2.y-a1.y)))):result=new Intersection}else result=new Intersection(0===uaT||0===ubT?"Coincident":"Parallel");return result},fabric.Intersection.intersectLinePolygon=function(a1,a2,points){for(var result=new Intersection,length=points.length,i=0;length>i;i++){var b1=points[i],b2=points[(i+1)%length],inter=Intersection.intersectLineLine(a1,a2,b1,b2);result.appendPoints(inter.points)}return result.points.length>0&&(result.status="Intersection"),result},fabric.Intersection.intersectPolygonPolygon=function(points1,points2){for(var result=new Intersection,length=points1.length,i=0;length>i;i++){var a1=points1[i],a2=points1[(i+1)%length],inter=Intersection.intersectLinePolygon(a1,a2,points2);result.appendPoints(inter.points)}return result.points.length>0&&(result.status="Intersection"),result},void(fabric.Intersection.intersectPolygonRectangle=function(points,r1,r2){var min=r1.min(r2),max=r1.max(r2),topRight=new fabric.Point(max.x,min.y),bottomLeft=new fabric.Point(min.x,max.y),inter1=Intersection.intersectLinePolygon(min,topRight,points),inter2=Intersection.intersectLinePolygon(topRight,max,points),inter3=Intersection.intersectLinePolygon(max,bottomLeft,points),inter4=Intersection.intersectLinePolygon(bottomLeft,min,points),result=new Intersection;return result.appendPoints(inter1.points),result.appendPoints(inter2.points),result.appendPoints(inter3.points),result.appendPoints(inter4.points),result.points.length>0&&(result.status="Intersection"),result}))}(exports),function(global){"use strict";function Color(color){color?this._tryParsingColor(color):this.setSource([0,0,0,1])}function hue2rgb(p,q,t){return 0>t&&(t+=1),t>1&&(t-=1),1/6>t?p+6*(q-p)*t:.5>t?q:2/3>t?p+(q-p)*(2/3-t)*6:p}var fabric=global.fabric||(global.fabric={});return fabric.Color?void fabric.warn("fabric.Color is already defined."):(fabric.Color=Color,fabric.Color.prototype={_tryParsingColor:function(color){var source;color in Color.colorNameMap&&(color=Color.colorNameMap[color]),"transparent"===color&&(source=[255,255,255,0]),source||(source=Color.sourceFromHex(color)),source||(source=Color.sourceFromRgb(color)),source||(source=Color.sourceFromHsl(color)),source||(source=[0,0,0,1]),source&&this.setSource(source)},_rgbToHsl:function(r,g,b){r/=255,g/=255,b/=255;var h,s,l,max=fabric.util.array.max([r,g,b]),min=fabric.util.array.min([r,g,b]);if(l=(max+min)/2,max===min)h=s=0;else{var d=max-min;switch(s=l>.5?d/(2-max-min):d/(max+min),max){case r:h=(g-b)/d+(b>g?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return[Math.round(360*h),Math.round(100*s),Math.round(100*l)]},getSource:function(){return this._source},setSource:function(source){this._source=source},toRgb:function(){var source=this.getSource();return"rgb("+source[0]+","+source[1]+","+source[2]+")"},toRgba:function(){var source=this.getSource();return"rgba("+source[0]+","+source[1]+","+source[2]+","+source[3]+")"},toHsl:function(){var source=this.getSource(),hsl=this._rgbToHsl(source[0],source[1],source[2]);return"hsl("+hsl[0]+","+hsl[1]+"%,"+hsl[2]+"%)"},toHsla:function(){var source=this.getSource(),hsl=this._rgbToHsl(source[0],source[1],source[2]);return"hsla("+hsl[0]+","+hsl[1]+"%,"+hsl[2]+"%,"+source[3]+")"},toHex:function(){var r,g,b,source=this.getSource();return r=source[0].toString(16),r=1===r.length?"0"+r:r,g=source[1].toString(16),g=1===g.length?"0"+g:g,b=source[2].toString(16),b=1===b.length?"0"+b:b,r.toUpperCase()+g.toUpperCase()+b.toUpperCase()},getAlpha:function(){return this.getSource()[3];
},setAlpha:function(alpha){var source=this.getSource();return source[3]=alpha,this.setSource(source),this},toGrayscale:function(){var source=this.getSource(),average=parseInt((.3*source[0]+.59*source[1]+.11*source[2]).toFixed(0),10),currentAlpha=source[3];return this.setSource([average,average,average,currentAlpha]),this},toBlackWhite:function(threshold){var source=this.getSource(),average=(.3*source[0]+.59*source[1]+.11*source[2]).toFixed(0),currentAlpha=source[3];return threshold=threshold||127,average=Number(average)<Number(threshold)?0:255,this.setSource([average,average,average,currentAlpha]),this},overlayWith:function(otherColor){otherColor instanceof Color||(otherColor=new Color(otherColor));for(var result=[],alpha=this.getAlpha(),otherAlpha=.5,source=this.getSource(),otherSource=otherColor.getSource(),i=0;3>i;i++)result.push(Math.round(source[i]*(1-otherAlpha)+otherSource[i]*otherAlpha));return result[3]=alpha,this.setSource(result),this}},fabric.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,fabric.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,fabric.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,fabric.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",grey:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},fabric.Color.fromRgb=function(color){return Color.fromSource(Color.sourceFromRgb(color))},fabric.Color.sourceFromRgb=function(color){var match=color.match(Color.reRGBa);if(match){var r=parseInt(match[1],10)/(/%$/.test(match[1])?100:1)*(/%$/.test(match[1])?255:1),g=parseInt(match[2],10)/(/%$/.test(match[2])?100:1)*(/%$/.test(match[2])?255:1),b=parseInt(match[3],10)/(/%$/.test(match[3])?100:1)*(/%$/.test(match[3])?255:1);return[parseInt(r,10),parseInt(g,10),parseInt(b,10),match[4]?parseFloat(match[4]):1]}},fabric.Color.fromRgba=Color.fromRgb,fabric.Color.fromHsl=function(color){return Color.fromSource(Color.sourceFromHsl(color))},fabric.Color.sourceFromHsl=function(color){var match=color.match(Color.reHSLa);if(match){var r,g,b,h=(parseFloat(match[1])%360+360)%360/360,s=parseFloat(match[2])/(/%$/.test(match[2])?100:1),l=parseFloat(match[3])/(/%$/.test(match[3])?100:1);if(0===s)r=g=b=l;else{var q=.5>=l?l*(s+1):l+s-l*s,p=2*l-q;r=hue2rgb(p,q,h+1/3),g=hue2rgb(p,q,h),b=hue2rgb(p,q,h-1/3)}return[Math.round(255*r),Math.round(255*g),Math.round(255*b),match[4]?parseFloat(match[4]):1]}},fabric.Color.fromHsla=Color.fromHsl,fabric.Color.fromHex=function(color){return Color.fromSource(Color.sourceFromHex(color))},fabric.Color.sourceFromHex=function(color){if(color.match(Color.reHex)){var value=color.slice(color.indexOf("#")+1),isShortNotation=3===value.length,r=isShortNotation?value.charAt(0)+value.charAt(0):value.substring(0,2),g=isShortNotation?value.charAt(1)+value.charAt(1):value.substring(2,4),b=isShortNotation?value.charAt(2)+value.charAt(2):value.substring(4,6);return[parseInt(r,16),parseInt(g,16),parseInt(b,16),1]}},void(fabric.Color.fromSource=function(source){var oColor=new Color;return oColor.setSource(source),oColor}))}(exports),function(){function getColorStop(el){var color,colorAlpha,opacity,style=el.getAttribute("style"),offset=el.getAttribute("offset")||0;if(offset=parseFloat(offset)/(/%$/.test(offset)?100:1),offset=0>offset?0:offset>1?1:offset,style){var keyValuePairs=style.split(/\s*;\s*/);""===keyValuePairs[keyValuePairs.length-1]&&keyValuePairs.pop();for(var i=keyValuePairs.length;i--;){var split=keyValuePairs[i].split(/\s*:\s*/),key=split[0].trim(),value=split[1].trim();"stop-color"===key?color=value:"stop-opacity"===key&&(opacity=value)}}return color||(color=el.getAttribute("stop-color")||"rgb(0,0,0)"),opacity||(opacity=el.getAttribute("stop-opacity")),color=new fabric.Color(color),colorAlpha=color.getAlpha(),opacity=isNaN(parseFloat(opacity))?1:parseFloat(opacity),opacity*=colorAlpha,{offset:offset,color:color.toRgb(),opacity:opacity}}function getLinearCoords(el){return{x1:el.getAttribute("x1")||0,y1:el.getAttribute("y1")||0,x2:el.getAttribute("x2")||"100%",y2:el.getAttribute("y2")||0}}function getRadialCoords(el){return{x1:el.getAttribute("fx")||el.getAttribute("cx")||"50%",y1:el.getAttribute("fy")||el.getAttribute("cy")||"50%",r1:0,x2:el.getAttribute("cx")||"50%",y2:el.getAttribute("cy")||"50%",r2:el.getAttribute("r")||"50%"}}function _convertPercentUnitsToValues(object,options,gradientUnits){var propValue,addFactor=0,multFactor=1,ellipseMatrix="";for(var prop in options)propValue=parseFloat(options[prop],10),multFactor="string"==typeof options[prop]&&/^\d+%$/.test(options[prop])?.01:1,"x1"===prop||"x2"===prop||"r2"===prop?(multFactor*="objectBoundingBox"===gradientUnits?object.width:1,addFactor="objectBoundingBox"===gradientUnits?object.left||0:0):"y1"!==prop&&"y2"!==prop||(multFactor*="objectBoundingBox"===gradientUnits?object.height:1,addFactor="objectBoundingBox"===gradientUnits?object.top||0:0),options[prop]=propValue*multFactor+addFactor;if("ellipse"===object.type&&null!==options.r2&&"objectBoundingBox"===gradientUnits&&object.rx!==object.ry){var scaleFactor=object.ry/object.rx;ellipseMatrix=" scale(1, "+scaleFactor+")",options.y1&&(options.y1/=scaleFactor),options.y2&&(options.y2/=scaleFactor)}return ellipseMatrix}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(options){options||(options={});var coords={};this.id=fabric.Object.__uid++,this.type=options.type||"linear",coords={x1:options.coords.x1||0,y1:options.coords.y1||0,x2:options.coords.x2||0,y2:options.coords.y2||0},"radial"===this.type&&(coords.r1=options.coords.r1||0,coords.r2=options.coords.r2||0),this.coords=coords,this.colorStops=options.colorStops.slice(),options.gradientTransform&&(this.gradientTransform=options.gradientTransform),this.offsetX=options.offsetX||this.offsetX,this.offsetY=options.offsetY||this.offsetY},addColorStop:function(colorStop){for(var position in colorStop){var color=new fabric.Color(colorStop[position]);this.colorStops.push({offset:position,color:color.toRgb(),opacity:color.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform}},toSVG:function(object){var markup,commonAttributes,coords=fabric.util.object.clone(this.coords);if(this.colorStops.sort(function(a,b){return a.offset-b.offset}),!object.group||"path-group"!==object.group.type)for(var prop in coords)"x1"===prop||"x2"===prop||"r2"===prop?coords[prop]+=this.offsetX-object.width/2:"y1"!==prop&&"y2"!==prop||(coords[prop]+=this.offsetY-object.height/2);commonAttributes='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(commonAttributes+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?markup=["<linearGradient ",commonAttributes,' x1="',coords.x1,'" y1="',coords.y1,'" x2="',coords.x2,'" y2="',coords.y2,'">\n']:"radial"===this.type&&(markup=["<radialGradient ",commonAttributes,' cx="',coords.x2,'" cy="',coords.y2,'" r="',coords.r2,'" fx="',coords.x1,'" fy="',coords.y1,'">\n']);for(var i=0;i<this.colorStops.length;i++)markup.push("<stop ",'offset="',100*this.colorStops[i].offset+"%",'" style="stop-color:',this.colorStops[i].color,null!=this.colorStops[i].opacity?";stop-opacity: "+this.colorStops[i].opacity:";",'"/>\n');return markup.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),markup.join("")},toLive:function(ctx,object){var gradient,prop,coords=fabric.util.object.clone(this.coords);if(this.type){if(object.group&&"path-group"===object.group.type)for(prop in coords)"x1"===prop||"x2"===prop?coords[prop]+=-this.offsetX+object.width/2:"y1"!==prop&&"y2"!==prop||(coords[prop]+=-this.offsetY+object.height/2);"linear"===this.type?gradient=ctx.createLinearGradient(coords.x1,coords.y1,coords.x2,coords.y2):"radial"===this.type&&(gradient=ctx.createRadialGradient(coords.x1,coords.y1,coords.r1,coords.x2,coords.y2,coords.r2));for(var i=0,len=this.colorStops.length;len>i;i++){var color=this.colorStops[i].color,opacity=this.colorStops[i].opacity,offset=this.colorStops[i].offset;"undefined"!=typeof opacity&&(color=new fabric.Color(color).setAlpha(opacity).toRgba()),gradient.addColorStop(parseFloat(offset),color)}return gradient}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(el,instance){var ellipseMatrix,colorStopEls=el.getElementsByTagName("stop"),type="linearGradient"===el.nodeName?"linear":"radial",gradientUnits=el.getAttribute("gradientUnits")||"objectBoundingBox",gradientTransform=el.getAttribute("gradientTransform"),colorStops=[],coords={};"linear"===type?coords=getLinearCoords(el):"radial"===type&&(coords=getRadialCoords(el));for(var i=colorStopEls.length;i--;)colorStops.push(getColorStop(colorStopEls[i]));ellipseMatrix=_convertPercentUnitsToValues(instance,coords,gradientUnits);var gradient=new fabric.Gradient({type:type,coords:coords,colorStops:colorStops,offsetX:-instance.left,offsetY:-instance.top});return(gradientTransform||""!==ellipseMatrix)&&(gradient.gradientTransform=fabric.parseTransformAttribute((gradientTransform||"")+ellipseMatrix)),gradient},forObject:function(obj,options){return options||(options={}),_convertPercentUnitsToValues(obj,options.coords,"userSpaceOnUse"),new fabric.Gradient(options)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(options){if(options||(options={}),this.id=fabric.Object.__uid++,options.source)if("string"==typeof options.source)if("undefined"!=typeof fabric.util.getFunctionBody(options.source))this.source=new Function(fabric.util.getFunctionBody(options.source));else{var _this=this;this.source=fabric.util.createImage(),fabric.util.loadImage(options.source,function(img){_this.source=img})}else this.source=options.source;options.repeat&&(this.repeat=options.repeat),options.offsetX&&(this.offsetX=options.offsetX),options.offsetY&&(this.offsetY=options.offsetY)},toObject:function(){var source;return"function"==typeof this.source?source=String(this.source):"string"==typeof this.source.src?source=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(source=this.source.toDataURL()),{source:source,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(object){var patternSource="function"==typeof this.source?this.source():this.source,patternWidth=patternSource.width/object.getWidth(),patternHeight=patternSource.height/object.getHeight(),patternOffsetX=this.offsetX/object.getWidth(),patternOffsetY=this.offsetY/object.getHeight(),patternImgSrc="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(patternHeight=1),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(patternWidth=1),patternSource.src?patternImgSrc=patternSource.src:patternSource.toDataURL&&(patternImgSrc=patternSource.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+patternOffsetX+'" y="'+patternOffsetY+'" width="'+patternWidth+'" height="'+patternHeight+'">\n<image x="0" y="0" width="'+patternSource.width+'" height="'+patternSource.height+'" xlink:href="'+patternImgSrc+'"></image>\n</pattern>\n'},toLive:function(ctx){var source="function"==typeof this.source?this.source():this.source;if(!source)return"";if("undefined"!=typeof source.src){if(!source.complete)return"";if(0===source.naturalWidth||0===source.naturalHeight)return""}return ctx.createPattern(source,this.repeat)}}),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),toFixed=fabric.util.toFixed;return fabric.Shadow?void fabric.warn("fabric.Shadow is already defined."):(fabric.Shadow=fabric.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(options){"string"==typeof options&&(options=this._parseShadow(options));for(var prop in options)this[prop]=options[prop];this.id=fabric.Object.__uid++},_parseShadow:function(shadow){var shadowStr=shadow.trim(),offsetsAndBlur=fabric.Shadow.reOffsetsAndBlur.exec(shadowStr)||[],color=shadowStr.replace(fabric.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:color.trim(),offsetX:parseInt(offsetsAndBlur[1],10)||0,offsetY:parseInt(offsetsAndBlur[2],10)||0,blur:parseInt(offsetsAndBlur[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(object){var fBoxX=40,fBoxY=40,NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,offset=fabric.util.rotateVector({x:this.offsetX,y:this.offsetY},fabric.util.degreesToRadians(-object.angle)),BLUR_BOX=20;return object.width&&object.height&&(fBoxX=100*toFixed((Math.abs(offset.x)+this.blur)/object.width,NUM_FRACTION_DIGITS)+BLUR_BOX,fBoxY=100*toFixed((Math.abs(offset.y)+this.blur)/object.height,NUM_FRACTION_DIGITS)+BLUR_BOX),object.flipX&&(offset.x*=-1),object.flipY&&(offset.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+fBoxY+'%" height="'+(100+2*fBoxY)+'%" x="-'+fBoxX+'%" width="'+(100+2*fBoxX)+'%" >\n	<feGaussianBlur in="SourceAlpha" stdDeviation="'+toFixed(this.blur?this.blur/2:0,NUM_FRACTION_DIGITS)+'"></feGaussianBlur>\n	<feOffset dx="'+toFixed(offset.x,NUM_FRACTION_DIGITS)+'" dy="'+toFixed(offset.y,NUM_FRACTION_DIGITS)+'" result="oBlur" ></feOffset>\n	<feFlood flood-color="'+this.color+'"/>\n	<feComposite in2="oBlur" operator="in" />\n	<feMerge>\n		<feMergeNode></feMergeNode>\n		<feMergeNode in="SourceGraphic"></feMergeNode>\n	</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var obj={},proto=fabric.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach(function(prop){this[prop]!==proto[prop]&&(obj[prop]=this[prop])},this),obj}}),void(fabric.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))}(exports),function(){"use strict";if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var extend=fabric.util.object.extend,getElementOffset=fabric.util.getElementOffset,removeFromArray=fabric.util.removeFromArray,toFixed=fabric.util.toFixed,CANVAS_INIT_ERROR=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(el,options){options||(options={}),this._initStatic(el,options)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},enableRetinaScaling:!0,_initStatic:function(el,options){this._objects=[],this._createLowerCanvas(el),this._initOptions(options),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),options.overlayImage&&this.setOverlayImage(options.overlayImage,this.renderAll.bind(this)),options.backgroundImage&&this.setBackgroundImage(options.backgroundImage,this.renderAll.bind(this)),options.backgroundColor&&this.setBackgroundColor(options.backgroundColor,this.renderAll.bind(this)),options.overlayColor&&this.setOverlayColor(options.overlayColor,this.renderAll.bind(this)),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=getElementOffset(this.lowerCanvasEl),this},setOverlayImage:function(image,callback,options){return this.__setBgOverlayImage("overlayImage",image,callback,options)},setBackgroundImage:function(image,callback,options){return this.__setBgOverlayImage("backgroundImage",image,callback,options)},setOverlayColor:function(overlayColor,callback){return this.__setBgOverlayColor("overlayColor",overlayColor,callback)},setBackgroundColor:function(backgroundColor,callback){return this.__setBgOverlayColor("backgroundColor",backgroundColor,callback)},_setImageSmoothing:function(){var ctx=this.getContext();ctx.imageSmoothingEnabled=ctx.imageSmoothingEnabled||ctx.webkitImageSmoothingEnabled||ctx.mozImageSmoothingEnabled||ctx.msImageSmoothingEnabled||ctx.oImageSmoothingEnabled,ctx.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(property,image,callback,options){return"string"==typeof image?fabric.util.loadImage(image,function(img){this[property]=new fabric.Image(img,options),callback&&callback(img)},this,options&&options.crossOrigin):(options&&image.setOptions(options),this[property]=image,callback&&callback(image)),this},__setBgOverlayColor:function(property,color,callback){if(color&&color.source){var _this=this;fabric.util.loadImage(color.source,function(img){_this[property]=new fabric.Pattern({source:img,repeat:color.repeat,offsetX:color.offsetX,offsetY:color.offsetY}),callback&&callback()})}else this[property]=color,callback&&callback();return this},_createCanvasElement:function(){var element=fabric.document.createElement("canvas");if(element.style||(element.style={}),!element)throw CANVAS_INIT_ERROR;return this._initCanvasElement(element),element},_initCanvasElement:function(element){if(fabric.util.createCanvasElement(element),"undefined"==typeof element.getContext)throw CANVAS_INIT_ERROR},_initOptions:function(options){for(var prop in options)this[prop]=options[prop];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(canvasEl){this.lowerCanvasEl=fabric.util.getById(canvasEl)||this._createCanvasElement(),this._initCanvasElement(this.lowerCanvasEl),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(value,options){return this.setDimensions({width:value},options)},setHeight:function(value,options){return this.setDimensions({height:value},options)},setDimensions:function(dimensions,options){var cssValue;options=options||{};for(var prop in dimensions)cssValue=dimensions[prop],options.cssOnly||(this._setBackstoreDimension(prop,dimensions[prop]),cssValue+="px"),options.backstoreOnly||this._setCssDimension(prop,cssValue);return this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),options.cssOnly||this.renderAll(),this},_setBackstoreDimension:function(prop,value){return this.lowerCanvasEl[prop]=value,this.upperCanvasEl&&(this.upperCanvasEl[prop]=value),this.cacheCanvasEl&&(this.cacheCanvasEl[prop]=value),this[prop]=value,this},_setCssDimension:function(prop,value){return this.lowerCanvasEl.style[prop]=value,this.upperCanvasEl&&(this.upperCanvasEl.style[prop]=value),this.wrapperEl&&(this.wrapperEl.style[prop]=value),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(vpt){var activeGroup=this.getActiveGroup();this.viewportTransform=vpt,this.renderAll();for(var i=0,len=this._objects.length;len>i;i++)this._objects[i].setCoords();return activeGroup&&activeGroup.setCoords(),this},zoomToPoint:function(point,value){var before=point;point=fabric.util.transformPoint(point,fabric.util.invertTransform(this.viewportTransform)),this.viewportTransform[0]=value,this.viewportTransform[3]=value;var after=fabric.util.transformPoint(point,this.viewportTransform);this.viewportTransform[4]+=before.x-after.x,this.viewportTransform[5]+=before.y-after.y,this.renderAll();for(var i=0,len=this._objects.length;len>i;i++)this._objects[i].setCoords();return this},setZoom:function(value){return this.zoomToPoint(new fabric.Point(0,0),value),this},absolutePan:function(point){this.viewportTransform[4]=-point.x,this.viewportTransform[5]=-point.y,this.renderAll();for(var i=0,len=this._objects.length;len>i;i++)this._objects[i].setCoords();return this},relativePan:function(point){return this.absolutePan(new fabric.Point(-point.x-this.viewportTransform[4],-point.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_onObjectAdded:function(obj){this.stateful&&obj.setupState(),obj._set("canvas",this),obj.setCoords(),this.fire("object:added",{target:obj}),obj.fire("added")},_onObjectRemoved:function(obj){this.getActiveObject()===obj&&(this.fire("before:selection:cleared",{target:obj}),this._discardActiveObject(),this.fire("selection:cleared")),this.fire("object:removed",{target:obj}),obj.fire("removed")},clearContext:function(ctx){return ctx.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},_chooseObjectsToRender:function(){var object,activeGroup=this.getActiveGroup(),objsToRender=[],activeGroupObjects=[];if(activeGroup&&!this.preserveObjectStacking){for(var i=0,length=this._objects.length;length>i;i++)object=this._objects[i],activeGroup.contains(object)?activeGroupObjects.push(object):objsToRender.push(object);activeGroup._set("_objects",activeGroupObjects)}else objsToRender=this._objects;return objsToRender},renderAll:function(){var objsToRender,canvasToDrawOn=this.contextContainer;return this.contextTop&&this.selection&&!this._groupSelector&&!this.isDrawingMode&&this.clearContext(this.contextTop),this.clearContext(canvasToDrawOn),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,canvasToDrawOn),this._renderBackground(canvasToDrawOn),canvasToDrawOn.save(),objsToRender=this._chooseObjectsToRender(),canvasToDrawOn.transform.apply(canvasToDrawOn,this.viewportTransform),this._renderObjects(canvasToDrawOn,objsToRender),this.preserveObjectStacking||this._renderObjects(canvasToDrawOn,[this.getActiveGroup()]),canvasToDrawOn.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(canvasToDrawOn),this.clipTo&&canvasToDrawOn.restore(),this._renderOverlay(canvasToDrawOn),this.controlsAboveOverlay&&this.interactive&&this.drawControls(canvasToDrawOn),this.fire("after:render"),this},_renderObjects:function(ctx,objects){for(var i=0,length=objects.length;length>i;++i)objects[i]&&objects[i].render(ctx)},_renderBackgroundOrOverlay:function(ctx,property){var object=this[property+"Color"];object&&(ctx.fillStyle=object.toLive?object.toLive(ctx):object,ctx.fillRect(object.offsetX||0,object.offsetY||0,this.width,this.height)),object=this[property+"Image"],object&&object.render(ctx)},_renderBackground:function(ctx){this._renderBackgroundOrOverlay(ctx,"background")},_renderOverlay:function(ctx){this._renderBackgroundOrOverlay(ctx,"overlay")},renderTop:function(){var ctx=this.contextTop||this.contextContainer;return this.clearContext(ctx),this.selection&&this._groupSelector&&this._drawSelection(),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(object){return this._centerObject(object,new fabric.Point(this.getCenter().left,object.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(object){return this._centerObject(object,new fabric.Point(object.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(object){var center=this.getCenter();return this._centerObject(object,new fabric.Point(center.left,center.top)),this.renderAll(),this},_centerObject:function(object,center){return object.setPositionByOrigin(center,"center","center"),this},toDatalessJSON:function(propertiesToInclude){return this.toDatalessObject(propertiesToInclude)},toObject:function(propertiesToInclude){return this._toObjectMethod("toObject",propertiesToInclude)},toDatalessObject:function(propertiesToInclude){return this._toObjectMethod("toDatalessObject",propertiesToInclude)},_toObjectMethod:function(methodName,propertiesToInclude){var data={objects:this._toObjects(methodName,propertiesToInclude)};return extend(data,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,data,propertiesToInclude),data},_toObjects:function(methodName,propertiesToInclude){return this.getObjects().map(function(instance){return this._toObject(instance,methodName,propertiesToInclude)},this)},_toObject:function(instance,methodName,propertiesToInclude){var originalValue;this.includeDefaultValues||(originalValue=instance.includeDefaultValues,instance.includeDefaultValues=!1);var originalProperties=this._realizeGroupTransformOnObject(instance),object=instance[methodName](propertiesToInclude);return this.includeDefaultValues||(instance.includeDefaultValues=originalValue),this._unwindGroupTransformOnObject(instance,originalProperties),object},_realizeGroupTransformOnObject:function(instance){var layoutProps=["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"];if(instance.group&&instance.group===this.getActiveGroup()){var originalValues={};return layoutProps.forEach(function(prop){originalValues[prop]=instance[prop]}),this.getActiveGroup().realizeTransform(instance),originalValues}return null},_unwindGroupTransformOnObject:function(instance,originalValues){originalValues&&instance.set(originalValues)},__serializeBgOverlay:function(){var data={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(data.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(data.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(data.overlayImage=this.overlayImage.toObject()),data},svgViewportTransformation:!0,toSVG:function(options,reviver){options||(options={});var markup=[];return this._setSVGPreamble(markup,options),this._setSVGHeader(markup,options),this._setSVGBgOverlayColor(markup,"backgroundColor"),this._setSVGBgOverlayImage(markup,"backgroundImage"),this._setSVGObjects(markup,reviver),this._setSVGBgOverlayColor(markup,"overlayColor"),this._setSVGBgOverlayImage(markup,"overlayImage"),markup.push("</svg>"),markup.join("")},_setSVGPreamble:function(markup,options){options.suppressPreamble||markup.push('<?xml version="1.0" encoding="',options.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(markup,options){var vpt,width=options.width||this.width,height=options.height||this.height,viewBox='viewBox="0 0 '+this.width+" "+this.height+'" ',NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;options.viewBox?viewBox='viewBox="'+options.viewBox.x+" "+options.viewBox.y+" "+options.viewBox.width+" "+options.viewBox.height+'" ':this.svgViewportTransformation&&(vpt=this.viewportTransform,viewBox='viewBox="'+toFixed(-vpt[4]/vpt[0],NUM_FRACTION_DIGITS)+" "+toFixed(-vpt[5]/vpt[3],NUM_FRACTION_DIGITS)+" "+toFixed(this.width/vpt[0],NUM_FRACTION_DIGITS)+" "+toFixed(this.height/vpt[3],NUM_FRACTION_DIGITS)+'" '),markup.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',width,'" ','height="',height,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,viewBox,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>\n")},_setSVGObjects:function(markup,reviver){for(var i=0,objects=this.getObjects(),len=objects.length;len>i;i++){var instance=objects[i],originalProperties=this._realizeGroupTransformOnObject(instance);markup.push(instance.toSVG(reviver)),this._unwindGroupTransformOnObject(instance,originalProperties)}},_setSVGBgOverlayImage:function(markup,property){this[property]&&this[property].toSVG&&markup.push(this[property].toSVG())},_setSVGBgOverlayColor:function(markup,property){this[property]&&this[property].source?markup.push('<rect x="',this[property].offsetX,'" y="',this[property].offsetY,'" ','width="',"repeat-y"===this[property].repeat||"no-repeat"===this[property].repeat?this[property].source.width:this.width,'" height="',"repeat-x"===this[property].repeat||"no-repeat"===this[property].repeat?this[property].source.height:this.height,'" fill="url(#'+property+'Pattern)"',"></rect>\n"):this[property]&&"overlayColor"===property&&markup.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[property],'"',"></rect>\n")},sendToBack:function(object){if(!object)return this;var i,obj,objs,activeGroup=this.getActiveGroup?this.getActiveGroup():null;if(object===activeGroup)for(objs=activeGroup._objects,i=objs.length;i--;)obj=objs[i],removeFromArray(this._objects,obj),this._objects.unshift(obj);else removeFromArray(this._objects,object),this._objects.unshift(object);return this.renderAll&&this.renderAll()},bringToFront:function(object){if(!object)return this;var i,obj,objs,activeGroup=this.getActiveGroup?this.getActiveGroup():null;if(object===activeGroup)for(objs=activeGroup._objects,i=0;i<objs.length;i++)obj=objs[i],removeFromArray(this._objects,obj),this._objects.push(obj);else removeFromArray(this._objects,object),this._objects.push(object);return this.renderAll&&this.renderAll()},sendBackwards:function(object,intersecting){if(!object)return this;var i,obj,idx,newIdx,objs,activeGroup=this.getActiveGroup?this.getActiveGroup():null;if(object===activeGroup)for(objs=activeGroup._objects,i=0;i<objs.length;i++)obj=objs[i],idx=this._objects.indexOf(obj),0!==idx&&(newIdx=idx-1,removeFromArray(this._objects,obj),this._objects.splice(newIdx,0,obj));else idx=this._objects.indexOf(object),0!==idx&&(newIdx=this._findNewLowerIndex(object,idx,intersecting),removeFromArray(this._objects,object),this._objects.splice(newIdx,0,object));return this.renderAll&&this.renderAll(),this},_findNewLowerIndex:function(object,idx,intersecting){var newIdx;if(intersecting){newIdx=idx;for(var i=idx-1;i>=0;--i){var isIntersecting=object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object);if(isIntersecting){newIdx=i;break}}}else newIdx=idx-1;return newIdx},bringForward:function(object,intersecting){if(!object)return this;var i,obj,idx,newIdx,objs,activeGroup=this.getActiveGroup?this.getActiveGroup():null;if(object===activeGroup)for(objs=activeGroup._objects,i=objs.length;i--;)obj=objs[i],idx=this._objects.indexOf(obj),idx!==this._objects.length-1&&(newIdx=idx+1,removeFromArray(this._objects,obj),this._objects.splice(newIdx,0,obj));else idx=this._objects.indexOf(object),idx!==this._objects.length-1&&(newIdx=this._findNewUpperIndex(object,idx,intersecting),removeFromArray(this._objects,object),this._objects.splice(newIdx,0,object));return this.renderAll&&this.renderAll(),this},_findNewUpperIndex:function(object,idx,intersecting){
var newIdx;if(intersecting){newIdx=idx;for(var i=idx+1;i<this._objects.length;++i){var isIntersecting=object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object);if(isIntersecting){newIdx=i;break}}}else newIdx=idx+1;return newIdx},moveTo:function(object,index){return removeFromArray(this._objects,object),this._objects.splice(index,0,object),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),extend(fabric.StaticCanvas.prototype,fabric.Observable),extend(fabric.StaticCanvas.prototype,fabric.Collection),extend(fabric.StaticCanvas.prototype,fabric.DataURLExporter),extend(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(methodName){var el=fabric.util.createCanvasElement();if(!el||!el.getContext)return null;var ctx=el.getContext("2d");if(!ctx)return null;switch(methodName){case"getImageData":return"undefined"!=typeof ctx.getImageData;case"setLineDash":return"undefined"!=typeof ctx.setLineDash;case"toDataURL":return"undefined"!=typeof el.toDataURL;case"toDataURLWithQuality":try{return el.toDataURL("image/jpeg",0),!0}catch(e){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(options){return this.shadow=new fabric.Shadow(options),this},_setBrushStyles:function(){var ctx=this.canvas.contextTop;ctx.strokeStyle=this.color,ctx.lineWidth=this.width,ctx.lineCap=this.strokeLineCap,ctx.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&ctx.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var ctx=this.canvas.contextTop;ctx.shadowColor=this.shadow.color,ctx.shadowBlur=this.shadow.blur,ctx.shadowOffsetX=this.shadow.offsetX,ctx.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var ctx=this.canvas.contextTop;ctx.shadowColor="",ctx.shadowBlur=ctx.shadowOffsetX=ctx.shadowOffsetY=0}}),function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(canvas){this.canvas=canvas,this._points=[]},onMouseDown:function(pointer){this._prepareForDrawing(pointer),this._captureDrawingPath(pointer),this._render()},onMouseMove:function(pointer){this._captureDrawingPath(pointer),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(pointer){var p=new fabric.Point(pointer.x,pointer.y);this._reset(),this._addPoint(p),this.canvas.contextTop.moveTo(p.x,p.y)},_addPoint:function(point){this._points.push(point)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(pointer){var pointerPoint=new fabric.Point(pointer.x,pointer.y);this._addPoint(pointerPoint)},_render:function(){var ctx=this.canvas.contextTop,v=this.canvas.viewportTransform,p1=this._points[0],p2=this._points[1];ctx.save(),ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]),ctx.beginPath(),2===this._points.length&&p1.x===p2.x&&p1.y===p2.y&&(p1.x-=.5,p2.x+=.5),ctx.moveTo(p1.x,p1.y);for(var i=1,len=this._points.length;len>i;i++){var midPoint=p1.midPointFrom(p2);ctx.quadraticCurveTo(p1.x,p1.y,midPoint.x,midPoint.y),p1=this._points[i],p2=this._points[i+1]}ctx.lineTo(p1.x,p1.y),ctx.stroke(),ctx.restore()},convertPointsToSVGPath:function(points){var path=[],p1=new fabric.Point(points[0].x,points[0].y),p2=new fabric.Point(points[1].x,points[1].y);path.push("M ",points[0].x," ",points[0].y," ");for(var i=1,len=points.length;len>i;i++){var midPoint=p1.midPointFrom(p2);path.push("Q ",p1.x," ",p1.y," ",midPoint.x," ",midPoint.y," "),p1=new fabric.Point(points[i].x,points[i].y),i+1<points.length&&(p2=new fabric.Point(points[i+1].x,points[i+1].y))}return path.push("L ",p1.x," ",p1.y," "),path},createPath:function(pathData){var path=new fabric.Path(pathData,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,path.setShadow(this.shadow)),path},_finalizeAndAddPath:function(){var ctx=this.canvas.contextTop;ctx.closePath();var pathData=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===pathData)return void this.canvas.renderAll();var path=this.createPath(pathData);this.canvas.add(path),path.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:path})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(canvas){this.canvas=canvas,this.points=[]},drawDot:function(pointer){var point=this.addPoint(pointer),ctx=this.canvas.contextTop,v=this.canvas.viewportTransform;ctx.save(),ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]),ctx.fillStyle=point.fill,ctx.beginPath(),ctx.arc(point.x,point.y,point.radius,0,2*Math.PI,!1),ctx.closePath(),ctx.fill(),ctx.restore()},onMouseDown:function(pointer){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(pointer)},onMouseMove:function(pointer){this.drawDot(pointer)},onMouseUp:function(){var originalRenderOnAddRemove=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var circles=[],i=0,len=this.points.length;len>i;i++){var point=this.points[i],circle=new fabric.Circle({radius:point.radius,left:point.x,top:point.y,originX:"center",originY:"center",fill:point.fill});this.shadow&&circle.setShadow(this.shadow),circles.push(circle)}var group=new fabric.Group(circles,{originX:"center",originY:"center"});group.canvas=this.canvas,this.canvas.add(group),this.canvas.fire("path:created",{path:group}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=originalRenderOnAddRemove,this.canvas.renderAll()},addPoint:function(pointer){var pointerPoint=new fabric.Point(pointer.x,pointer.y),circleRadius=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,circleColor=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return pointerPoint.radius=circleRadius,pointerPoint.fill=circleColor,this.points.push(pointerPoint),pointerPoint}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(canvas){this.canvas=canvas,this.sprayChunks=[]},onMouseDown:function(pointer){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(pointer),this.render()},onMouseMove:function(pointer){this.addSprayChunk(pointer),this.render()},onMouseUp:function(){var originalRenderOnAddRemove=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var rects=[],i=0,ilen=this.sprayChunks.length;ilen>i;i++)for(var sprayChunk=this.sprayChunks[i],j=0,jlen=sprayChunk.length;jlen>j;j++){var rect=new fabric.Rect({width:sprayChunk[j].width,height:sprayChunk[j].width,left:sprayChunk[j].x+1,top:sprayChunk[j].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&rect.setShadow(this.shadow),rects.push(rect)}this.optimizeOverlapping&&(rects=this._getOptimizedRects(rects));var group=new fabric.Group(rects,{originX:"center",originY:"center"});group.canvas=this.canvas,this.canvas.add(group),this.canvas.fire("path:created",{path:group}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=originalRenderOnAddRemove,this.canvas.renderAll()},_getOptimizedRects:function(rects){for(var key,uniqueRects={},i=0,len=rects.length;len>i;i++)key=rects[i].left+""+rects[i].top,uniqueRects[key]||(uniqueRects[key]=rects[i]);var uniqueRectsArray=[];for(key in uniqueRects)uniqueRectsArray.push(uniqueRects[key]);return uniqueRectsArray},render:function(){var ctx=this.canvas.contextTop;ctx.fillStyle=this.color;var v=this.canvas.viewportTransform;ctx.save(),ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);for(var i=0,len=this.sprayChunkPoints.length;len>i;i++){var point=this.sprayChunkPoints[i];"undefined"!=typeof point.opacity&&(ctx.globalAlpha=point.opacity),ctx.fillRect(point.x,point.y,point.width,point.width)}ctx.restore()},addSprayChunk:function(pointer){this.sprayChunkPoints=[];for(var x,y,width,radius=this.width/2,i=0;i<this.density;i++){x=fabric.util.getRandomInt(pointer.x-radius,pointer.x+radius),y=fabric.util.getRandomInt(pointer.y-radius,pointer.y+radius),width=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var point=new fabric.Point(x,y);point.width=width,this.randomOpacity&&(point.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(point)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var dotWidth=20,dotDistance=5,patternCanvas=fabric.document.createElement("canvas"),patternCtx=patternCanvas.getContext("2d");return patternCanvas.width=patternCanvas.height=dotWidth+dotDistance,patternCtx.fillStyle=this.color,patternCtx.beginPath(),patternCtx.arc(dotWidth/2,dotWidth/2,dotWidth/2,0,2*Math.PI,!1),patternCtx.closePath(),patternCtx.fill(),patternCanvas},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(pathData){var path=this.callSuper("createPath",pathData);return path.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),path}}),function(){var getPointer=fabric.util.getPointer,degreesToRadians=fabric.util.degreesToRadians,radiansToDegrees=fabric.util.radiansToDegrees,atan2=Math.atan2,abs=Math.abs,STROKE_OFFSET=.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(el,options){options||(options={}),this._initStatic(el,options),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_resetCurrentTransform:function(){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,skewX:t.original.skewX,skewY:t.original.skewY,left:t.original.left,top:t.original.top}),this._shouldCenterTransform(t.target)?"rotate"===t.action?this._setOriginToCenter(t.target):("center"!==t.originX&&("right"===t.originX?t.mouseXSign=-1:t.mouseXSign=1),"center"!==t.originY&&("bottom"===t.originY?t.mouseYSign=-1:t.mouseYSign=1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(e,target){var pointer=this.getPointer(e,!0),xy=this._normalizePointer(target,pointer);return target.containsPoint(xy)||target._findTargetCorner(pointer)},_normalizePointer:function(object,pointer){var lt,m,activeGroup=this.getActiveGroup(),isObjectInGroup=activeGroup&&"group"!==object.type&&activeGroup.contains(object);return isObjectInGroup&&(m=fabric.util.multiplyTransformMatrices(this.viewportTransform,activeGroup.calcTransformMatrix()),m=fabric.util.invertTransform(m),pointer=fabric.util.transformPoint(pointer,m,!1),lt=fabric.util.transformPoint(activeGroup.getCenterPoint(),m,!1),pointer.x-=lt.x,pointer.y-=lt.y),{x:pointer.x,y:pointer.y}},isTargetTransparent:function(target,x,y){var hasBorders=target.hasBorders,transparentCorners=target.transparentCorners,ctx=this.contextCache,shouldTransform=target.group&&target.group===this.getActiveGroup();target.hasBorders=target.transparentCorners=!1,shouldTransform&&(ctx.save(),ctx.transform.apply(ctx,target.group.calcTransformMatrix())),target.render(ctx),target.active&&target._renderControls(ctx),target.hasBorders=hasBorders,target.transparentCorners=transparentCorners;var isTransparent=fabric.util.isTransparent(ctx,x,y,this.targetFindTolerance);return shouldTransform&&ctx.restore(),this.clearContext(ctx),isTransparent},_shouldClearSelection:function(e,target){var activeGroup=this.getActiveGroup(),activeObject=this.getActiveObject();return!target||target&&activeGroup&&!activeGroup.contains(target)&&activeGroup!==target&&!e[this.selectionKey]||target&&!target.evented||target&&!target.selectable&&activeObject&&activeObject!==target},_shouldCenterTransform:function(target){if(target){var centerTransform,t=this._currentTransform;return"scale"===t.action||"scaleX"===t.action||"scaleY"===t.action?centerTransform=this.centeredScaling||target.centeredScaling:"rotate"===t.action&&(centerTransform=this.centeredRotation||target.centeredRotation),centerTransform?!t.altKey:t.altKey}},_getOriginFromCorner:function(target,corner){var origin={x:target.originX,y:target.originY};return"ml"===corner||"tl"===corner||"bl"===corner?origin.x="right":"mr"!==corner&&"tr"!==corner&&"br"!==corner||(origin.x="left"),"tl"===corner||"mt"===corner||"tr"===corner?origin.y="bottom":"bl"!==corner&&"mb"!==corner&&"br"!==corner||(origin.y="top"),origin},_getActionFromCorner:function(target,corner,e){if(!corner)return"drag";switch(corner){case"mtr":return"rotate";case"ml":case"mr":return e[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return e[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(e,target){if(target){var pointer=this.getPointer(e),corner=target._findTargetCorner(this.getPointer(e,!0)),action=this._getActionFromCorner(target,corner,e),origin=this._getOriginFromCorner(target,corner);this._currentTransform={target:target,action:action,corner:corner,scaleX:target.scaleX,scaleY:target.scaleY,skewX:target.skewX,skewY:target.skewY,offsetX:pointer.x-target.left,offsetY:pointer.y-target.top,originX:origin.x,originY:origin.y,ex:pointer.x,ey:pointer.y,lastX:pointer.x,lastY:pointer.y,left:target.left,top:target.top,theta:degreesToRadians(target.angle),width:target.width*target.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:e.shiftKey,altKey:e[this.centeredKey]},this._currentTransform.original={left:target.left,top:target.top,scaleX:target.scaleX,scaleY:target.scaleY,skewX:target.skewX,skewY:target.skewY,originX:origin.x,originY:origin.y},this._resetCurrentTransform()}},_translateObject:function(x,y){var transform=this._currentTransform,target=transform.target,newLeft=x-transform.offsetX,newTop=y-transform.offsetY,moveX=!target.get("lockMovementX")&&target.left!==newLeft,moveY=!target.get("lockMovementY")&&target.top!==newTop;return moveX&&target.set("left",newLeft),moveY&&target.set("top",newTop),moveX||moveY},_changeSkewTransformOrigin:function(mouseMove,t,by){var property="originX",origins={0:"center"},skew=t.target.skewX,originA="left",originB="right",corner="mt"===t.corner||"ml"===t.corner?1:-1,flipSign=1;mouseMove=mouseMove>0?1:-1,"y"===by&&(skew=t.target.skewY,originA="top",originB="bottom",property="originY"),origins[-1]=originA,origins[1]=originB,t.target.flipX&&(flipSign*=-1),t.target.flipY&&(flipSign*=-1),0===skew?(t.skewSign=-corner*mouseMove*flipSign,t[property]=origins[-mouseMove]):(skew=skew>0?1:-1,t.skewSign=skew,t[property]=origins[skew*corner*flipSign])},_skewObject:function(x,y,by){var t=this._currentTransform,target=t.target,skewed=!1,lockSkewingX=target.get("lockSkewingX"),lockSkewingY=target.get("lockSkewingY");if(lockSkewingX&&"x"===by||lockSkewingY&&"y"===by)return!1;var actualMouseByOrigin,constraintPosition,center=target.getCenterPoint(),actualMouseByCenter=target.toLocalPoint(new fabric.Point(x,y),"center","center")[by],lastMouseByCenter=target.toLocalPoint(new fabric.Point(t.lastX,t.lastY),"center","center")[by],dim=target._getTransformedDimensions();return this._changeSkewTransformOrigin(actualMouseByCenter-lastMouseByCenter,t,by),actualMouseByOrigin=target.toLocalPoint(new fabric.Point(x,y),t.originX,t.originY)[by],constraintPosition=target.translateToOriginPoint(center,t.originX,t.originY),skewed=this._setObjectSkew(actualMouseByOrigin,t,by,dim),t.lastX=x,t.lastY=y,target.setPositionByOrigin(constraintPosition,t.originX,t.originY),skewed},_setObjectSkew:function(localMouse,transform,by,_dim){var newValue,newDim,dimNoSkew,otherBy,_otherBy,_by,newDimMouse,skewX,skewY,target=transform.target,skewed=!1,skewSign=transform.skewSign;return"x"===by?(otherBy="y",_otherBy="Y",_by="X",skewX=0,skewY=target.skewY):(otherBy="x",_otherBy="X",_by="Y",skewX=target.skewX,skewY=0),dimNoSkew=target._getTransformedDimensions(skewX,skewY),newDimMouse=2*Math.abs(localMouse)-dimNoSkew[by],2>=newDimMouse?newValue=0:(newValue=skewSign*Math.atan(newDimMouse/target["scale"+_by]/(dimNoSkew[otherBy]/target["scale"+_otherBy])),newValue=fabric.util.radiansToDegrees(newValue)),skewed=target["skew"+_by]!==newValue,target.set("skew"+_by,newValue),0!==target["skew"+_otherBy]&&(newDim=target._getTransformedDimensions(),newValue=_dim[otherBy]/newDim[otherBy]*target["scale"+_otherBy],target.set("scale"+_otherBy,newValue)),skewed},_scaleObject:function(x,y,by){var t=this._currentTransform,target=t.target,lockScalingX=target.get("lockScalingX"),lockScalingY=target.get("lockScalingY"),lockScalingFlip=target.get("lockScalingFlip");if(lockScalingX&&lockScalingY)return!1;var constraintPosition=target.translateToOriginPoint(target.getCenterPoint(),t.originX,t.originY),localMouse=target.toLocalPoint(new fabric.Point(x,y),t.originX,t.originY),dim=target._getTransformedDimensions(),scaled=!1;return this._setLocalMouse(localMouse,t),scaled=this._setObjectScale(localMouse,t,lockScalingX,lockScalingY,by,lockScalingFlip,dim),target.setPositionByOrigin(constraintPosition,t.originX,t.originY),scaled},_setObjectScale:function(localMouse,transform,lockScalingX,lockScalingY,by,lockScalingFlip,_dim){var changeX,changeY,scaleX,scaleY,target=transform.target,forbidScalingX=!1,forbidScalingY=!1,scaled=!1;return scaleX=localMouse.x*target.scaleX/_dim.x,scaleY=localMouse.y*target.scaleY/_dim.y,changeX=target.scaleX!==scaleX,changeY=target.scaleY!==scaleY,lockScalingFlip&&0>=scaleX&&scaleX<target.scaleX&&(forbidScalingX=!0),lockScalingFlip&&0>=scaleY&&scaleY<target.scaleY&&(forbidScalingY=!0),"equally"!==by||lockScalingX||lockScalingY?by?"x"!==by||target.get("lockUniScaling")?"y"!==by||target.get("lockUniScaling")||forbidScalingY||lockScalingY||target.set("scaleY",scaleY)&&(scaled=scaled||changeY):forbidScalingX||lockScalingX||target.set("scaleX",scaleX)&&(scaled=scaled||changeX):(forbidScalingX||lockScalingX||target.set("scaleX",scaleX)&&(scaled=scaled||changeX),forbidScalingY||lockScalingY||target.set("scaleY",scaleY)&&(scaled=scaled||changeY)):forbidScalingX||forbidScalingY||(scaled=this._scaleObjectEqually(localMouse,target,transform,_dim)),transform.newScaleX=scaleX,transform.newScaleY=scaleY,forbidScalingX||forbidScalingY||this._flipObject(transform,by),scaled},_scaleObjectEqually:function(localMouse,target,transform,_dim){var scaled,dist=localMouse.y+localMouse.x,lastDist=_dim.y*transform.original.scaleY/target.scaleY+_dim.x*transform.original.scaleX/target.scaleX;return transform.newScaleX=transform.original.scaleX*dist/lastDist,transform.newScaleY=transform.original.scaleY*dist/lastDist,scaled=transform.newScaleX!==target.scaleX||transform.newScaleY!==target.scaleY,target.set("scaleX",transform.newScaleX),target.set("scaleY",transform.newScaleY),scaled},_flipObject:function(transform,by){transform.newScaleX<0&&"y"!==by&&("left"===transform.originX?transform.originX="right":"right"===transform.originX&&(transform.originX="left")),transform.newScaleY<0&&"x"!==by&&("top"===transform.originY?transform.originY="bottom":"bottom"===transform.originY&&(transform.originY="top"))},_setLocalMouse:function(localMouse,t){var target=t.target;"right"===t.originX?localMouse.x*=-1:"center"===t.originX&&(localMouse.x*=2*t.mouseXSign,localMouse.x<0&&(t.mouseXSign=-t.mouseXSign)),"bottom"===t.originY?localMouse.y*=-1:"center"===t.originY&&(localMouse.y*=2*t.mouseYSign,localMouse.y<0&&(t.mouseYSign=-t.mouseYSign)),abs(localMouse.x)>target.padding?localMouse.x<0?localMouse.x+=target.padding:localMouse.x-=target.padding:localMouse.x=0,abs(localMouse.y)>target.padding?localMouse.y<0?localMouse.y+=target.padding:localMouse.y-=target.padding:localMouse.y=0},_rotateObject:function(x,y){var t=this._currentTransform;if(t.target.get("lockRotation"))return!1;var lastAngle=atan2(t.ey-t.top,t.ex-t.left),curAngle=atan2(y-t.top,x-t.left),angle=radiansToDegrees(curAngle-lastAngle+t.theta);return 0>angle&&(angle=360+angle),t.target.angle=angle%360,!0},setCursor:function(value){this.upperCanvasEl.style.cursor=value},_resetObjectTransform:function(target){target.scaleX=1,target.scaleY=1,target.skewX=0,target.skewY=0,target.setAngle(0)},_drawSelection:function(){var ctx=this.contextTop,groupSelector=this._groupSelector,left=groupSelector.left,top=groupSelector.top,aleft=abs(left),atop=abs(top);if(ctx.fillStyle=this.selectionColor,ctx.fillRect(groupSelector.ex-(left>0?0:-left),groupSelector.ey-(top>0?0:-top),aleft,atop),ctx.lineWidth=this.selectionLineWidth,ctx.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1){var px=groupSelector.ex+STROKE_OFFSET-(left>0?0:aleft),py=groupSelector.ey+STROKE_OFFSET-(top>0?0:atop);ctx.beginPath(),fabric.util.drawDashedLine(ctx,px,py,px+aleft,py,this.selectionDashArray),fabric.util.drawDashedLine(ctx,px,py+atop-1,px+aleft,py+atop-1,this.selectionDashArray),fabric.util.drawDashedLine(ctx,px,py,px,py+atop,this.selectionDashArray),fabric.util.drawDashedLine(ctx,px+aleft-1,py,px+aleft-1,py+atop,this.selectionDashArray),ctx.closePath(),ctx.stroke()}else ctx.strokeRect(groupSelector.ex+STROKE_OFFSET-(left>0?0:aleft),groupSelector.ey+STROKE_OFFSET-(top>0?0:atop),aleft,atop)},_isLastRenderedObject:function(e){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(e,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(e,!0))},findTarget:function(e,skipGroup){if(!this.skipTargetFind){if(this._isLastRenderedObject(e))return this.lastRenderedObjectWithControlsAboveOverlay;var activeGroup=this.getActiveGroup();if(!skipGroup&&this._checkTarget(e,activeGroup,this.getPointer(e,!0)))return activeGroup;var target=this._searchPossibleTargets(e,skipGroup);return this._fireOverOutEvents(target,e),target}},_fireOverOutEvents:function(target,e){target?this._hoveredTarget!==target&&(this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:e}),this._hoveredTarget.fire("mouseout")),this.fire("mouse:over",{target:target,e:e}),target.fire("mouseover"),this._hoveredTarget=target):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:e}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(e,obj,pointer){if(obj&&obj.visible&&obj.evented&&this.containsPoint(e,obj)){if(!this.perPixelTargetFind&&!obj.perPixelTargetFind||obj.isEditing)return!0;var isTransparent=this.isTargetTransparent(obj,pointer.x,pointer.y);if(!isTransparent)return!0}},_searchPossibleTargets:function(e,skipGroup){for(var target,pointer=this.getPointer(e,!0),i=this._objects.length;i--;)if((!this._objects[i].group||skipGroup)&&this._checkTarget(e,this._objects[i],pointer)){this.relatedTarget=this._objects[i],target=this._objects[i];break}return target},getPointer:function(e,ignoreZoom,upperCanvasEl){upperCanvasEl||(upperCanvasEl=this.upperCanvasEl);var cssScale,pointer=getPointer(e),bounds=upperCanvasEl.getBoundingClientRect(),boundsWidth=bounds.width||0,boundsHeight=bounds.height||0;return boundsWidth&&boundsHeight||("top"in bounds&&"bottom"in bounds&&(boundsHeight=Math.abs(bounds.top-bounds.bottom)),"right"in bounds&&"left"in bounds&&(boundsWidth=Math.abs(bounds.right-bounds.left))),this.calcOffset(),pointer.x=pointer.x-this._offset.left,pointer.y=pointer.y-this._offset.top,ignoreZoom||(pointer=fabric.util.transformPoint(pointer,fabric.util.invertTransform(this.viewportTransform))),cssScale=0===boundsWidth||0===boundsHeight?{width:1,height:1}:{width:upperCanvasEl.width/boundsWidth,height:upperCanvasEl.height/boundsHeight},{x:pointer.x*cssScale.width,y:pointer.y*cssScale.height}},_createUpperCanvas:function(){var lowerCanvasClass=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+lowerCanvasClass),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(element){var width=this.getWidth()||element.width,height=this.getHeight()||element.height;fabric.util.setStyle(element,{position:"absolute",width:width+"px",height:height+"px",left:0,top:0}),element.width=width,element.height=height,fabric.util.makeElementUnselectable(element)},_copyCanvasStyle:function(fromEl,toEl){toEl.style.cssText=fromEl.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(object){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=object,object.set("active",!0)},setActiveObject:function(object,e){return this._setActiveObject(object),this.renderAll(),this.fire("object:selected",{target:object,e:e}),object.fire("selected",{e:e}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(e){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:e}),this},_setActiveGroup:function(group){this._activeGroup=group,group&&group.set("active",!0)},setActiveGroup:function(group,e){return this._setActiveGroup(group),group&&(this.fire("object:selected",{target:group,e:e}),group.fire("selected",{e:e})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var g=this.getActiveGroup();g&&g.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(e){return this._discardActiveGroup(),this.fire("selection:cleared",{e:e}),this},deactivateAll:function(){for(var allObjects=this.getObjects(),i=0,len=allObjects.length;len>i;i++)allObjects[i].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(e){var activeObject=this.getActiveGroup()||this.getActiveObject();return activeObject&&this.fire("before:selection:cleared",{target:activeObject,e:e}),this.deactivateAll(),activeObject&&this.fire("selection:cleared",{e:e}),this},dispose:function(){this.callSuper("dispose");var wrapper=this.wrapperEl;return this.removeListeners(),wrapper.removeChild(this.upperCanvasEl),wrapper.removeChild(this.lowerCanvasEl),delete this.upperCanvasEl,wrapper.parentNode&&wrapper.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,this},drawControls:function(ctx){var activeGroup=this.getActiveGroup();activeGroup?activeGroup._renderControls(ctx):this._drawObjectsControls(ctx)},_drawObjectsControls:function(ctx){for(var i=0,len=this._objects.length;len>i;++i)this._objects[i]&&this._objects[i].active&&(this._objects[i]._renderControls(ctx),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[i])}});for(var prop in fabric.StaticCanvas)"prototype"!==prop&&(fabric.Canvas[prop]=fabric.StaticCanvas[prop]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var cursorOffset={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},addListener=fabric.util.addListener,removeListener=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),addListener(fabric.window,"resize",this._onResize),addListener(this.upperCanvasEl,"mousedown",this._onMouseDown),addListener(this.upperCanvasEl,"mousemove",this._onMouseMove),addListener(this.upperCanvasEl,"mousewheel",this._onMouseWheel),addListener(this.upperCanvasEl,"mouseout",this._onMouseOut),addListener(this.upperCanvasEl,"touchstart",this._onMouseDown),addListener(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this)},removeListeners:function(){removeListener(fabric.window,"resize",this._onResize),removeListener(this.upperCanvasEl,"mousedown",this._onMouseDown),removeListener(this.upperCanvasEl,"mousemove",this._onMouseMove),removeListener(this.upperCanvasEl,"mousewheel",this._onMouseWheel),removeListener(this.upperCanvasEl,"mouseout",this._onMouseOut),removeListener(this.upperCanvasEl,"touchstart",this._onMouseDown),removeListener(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(e,self){this.__onTransformGesture&&this.__onTransformGesture(e,self)},_onDrag:function(e,self){this.__onDrag&&this.__onDrag(e,self);
},_onMouseWheel:function(e,self){this.__onMouseWheel&&this.__onMouseWheel(e,self)},_onMouseOut:function(e){var target=this._hoveredTarget;this.fire("mouse:out",{target:target,e:e}),this._hoveredTarget=null,target&&target.fire("mouseout",{e:e})},_onOrientationChange:function(e,self){this.__onOrientationChange&&this.__onOrientationChange(e,self)},_onShake:function(e,self){this.__onShake&&this.__onShake(e,self)},_onLongPress:function(e,self){this.__onLongPress&&this.__onLongPress(e,self)},_onMouseDown:function(e){this.__onMouseDown(e),addListener(fabric.document,"touchend",this._onMouseUp),addListener(fabric.document,"touchmove",this._onMouseMove),removeListener(this.upperCanvasEl,"mousemove",this._onMouseMove),removeListener(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===e.type?removeListener(this.upperCanvasEl,"mousedown",this._onMouseDown):(addListener(fabric.document,"mouseup",this._onMouseUp),addListener(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(e){if(this.__onMouseUp(e),removeListener(fabric.document,"mouseup",this._onMouseUp),removeListener(fabric.document,"touchend",this._onMouseUp),removeListener(fabric.document,"mousemove",this._onMouseMove),removeListener(fabric.document,"touchmove",this._onMouseMove),addListener(this.upperCanvasEl,"mousemove",this._onMouseMove),addListener(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===e.type){var _this=this;setTimeout(function(){addListener(_this.upperCanvasEl,"mousedown",_this._onMouseDown)},400)}},_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)},_onResize:function(){this.calcOffset()},_shouldRender:function(target,pointer){var activeObject=this.getActiveGroup()||this.getActiveObject();return!!(target&&(target.isMoving||target!==activeObject)||!target&&activeObject||!target&&!activeObject&&!this._groupSelector||pointer&&this._previousPointer&&this.selection&&(pointer.x!==this._previousPointer.x||pointer.y!==this._previousPointer.y))},__onMouseUp:function(e){var target,searchTarget=!0,transform=this._currentTransform;if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(e);transform&&(this._finalizeCurrentTransform(),searchTarget=!transform.actionPerformed),target=searchTarget?this.findTarget(e,!0):transform.target;var shouldRender=this._shouldRender(target,this.getPointer(e));this._maybeGroupObjects(e),target&&(target.isMoving=!1),shouldRender&&this.renderAll(),this._handleCursorAndEvent(e,target)},_handleCursorAndEvent:function(e,target){this._setCursorFromEvent(e,target),this.fire("mouse:up",{target:target,e:e}),target&&target.fire("mouseup",{e:e})},_finalizeCurrentTransform:function(){var transform=this._currentTransform,target=transform.target;target._scaling&&(target._scaling=!1),target.setCoords(),this._restoreOriginXY(target),(transform.actionPerformed||this.stateful&&target.hasStateChanged())&&(this.fire("object:modified",{target:target}),target.fire("modified"))},_restoreOriginXY:function(target){if(this._previousOriginX&&this._previousOriginY){var originPoint=target.translateToOriginPoint(target.getCenterPoint(),this._previousOriginX,this._previousOriginY);target.originX=this._previousOriginX,target.originY=this._previousOriginY,target.left=originPoint.x,target.top=originPoint.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=!0,this.discardActiveObject(e).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var ivt=fabric.util.invertTransform(this.viewportTransform),pointer=fabric.util.transformPoint(this.getPointer(e,!0),ivt);this.freeDrawingBrush.onMouseDown(pointer),this.fire("mouse:down",{e:e});var target=this.findTarget(e);"undefined"!=typeof target&&target.fire("mousedown",{e:e,target:target})},_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var ivt=fabric.util.invertTransform(this.viewportTransform),pointer=fabric.util.transformPoint(this.getPointer(e,!0),ivt);this.freeDrawingBrush.onMouseMove(pointer)}this.setCursor(this.freeDrawingCursor),this.fire("mouse:move",{e:e});var target=this.findTarget(e);"undefined"!=typeof target&&target.fire("mousemove",{e:e,target:target})},_onMouseUpInDrawingMode:function(e){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this.fire("mouse:up",{e:e});var target=this.findTarget(e);"undefined"!=typeof target&&target.fire("mouseup",{e:e,target:target})},__onMouseDown:function(e){var isLeftClick="which"in e?1===e.which:0===e.button;if(isLeftClick||fabric.isTouchSupported){if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(e);if(!this._currentTransform){var target=this.findTarget(e),pointer=this.getPointer(e,!0);this._previousPointer=pointer;var shouldRender=this._shouldRender(target,pointer),shouldGroup=this._shouldGroup(e,target);this._shouldClearSelection(e,target)?this._clearSelection(e,target,pointer):shouldGroup&&(this._handleGrouping(e,target),target=this.getActiveGroup()),target&&(!target.selectable||!target.__corner&&shouldGroup||(this._beforeTransform(e,target),this._setupCurrentTransform(e,target)),target!==this.getActiveGroup()&&target!==this.getActiveObject()&&(this.deactivateAll(),target.selectable&&this.setActiveObject(target,e))),shouldRender&&this.renderAll(),this.fire("mouse:down",{target:target,e:e}),target&&target.fire("mousedown",{e:e})}}},_beforeTransform:function(e,target){this.stateful&&target.saveState(),target._findTargetCorner(this.getPointer(e))&&this.onBeforeScaleRotate(target)},_clearSelection:function(e,target,pointer){this.deactivateAllWithDispatch(e),target&&target.selectable?this.setActiveObject(target,e):this.selection&&(this._groupSelector={ex:pointer.x,ey:pointer.y,top:0,left:0})},_setOriginToCenter:function(target){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var center=target.getCenterPoint();target.originX="center",target.originY="center",target.left=center.x,target.top=center.y,this._currentTransform.left=target.left,this._currentTransform.top=target.top},_setCenterToOrigin:function(target){var originPoint=target.translateToOriginPoint(target.getCenterPoint(),this._previousOriginX,this._previousOriginY);target.originX=this._previousOriginX,target.originY=this._previousOriginY,target.left=originPoint.x,target.top=originPoint.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(e){var target,pointer;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(e);if(!("undefined"!=typeof e.touches&&e.touches.length>1)){var groupSelector=this._groupSelector;groupSelector?(pointer=this.getPointer(e,!0),groupSelector.left=pointer.x-groupSelector.ex,groupSelector.top=pointer.y-groupSelector.ey,this.renderTop()):this._currentTransform?this._transformObject(e):(target=this.findTarget(e),this._setCursorFromEvent(e,target)),this.fire("mouse:move",{target:target,e:e}),target&&target.fire("mousemove",{e:e})}},_transformObject:function(e){var pointer=this.getPointer(e),transform=this._currentTransform;transform.reset=!1,transform.target.isMoving=!0,this._beforeScaleTransform(e,transform),this._performTransformAction(e,transform,pointer),this.renderAll()},_performTransformAction:function(e,transform,pointer){var x=pointer.x,y=pointer.y,target=transform.target,action=transform.action,actionPerformed=!1;"rotate"===action?(actionPerformed=this._rotateObject(x,y))&&this._fire("rotating",target,e):"scale"===action?(actionPerformed=this._onScale(e,transform,x,y))&&this._fire("scaling",target,e):"scaleX"===action?(actionPerformed=this._scaleObject(x,y,"x"))&&this._fire("scaling",target,e):"scaleY"===action?(actionPerformed=this._scaleObject(x,y,"y"))&&this._fire("scaling",target,e):"skewX"===action?(actionPerformed=this._skewObject(x,y,"x"))&&this._fire("skewing",target,e):"skewY"===action?(actionPerformed=this._skewObject(x,y,"y"))&&this._fire("skewing",target,e):(actionPerformed=this._translateObject(x,y),actionPerformed&&(this._fire("moving",target,e),this.setCursor(target.moveCursor||this.moveCursor))),transform.actionPerformed=actionPerformed},_fire:function(eventName,target,e){this.fire("object:"+eventName,{target:target,e:e}),target.fire(eventName,{e:e})},_beforeScaleTransform:function(e,transform){if("scale"===transform.action||"scaleX"===transform.action||"scaleY"===transform.action){var centerTransform=this._shouldCenterTransform(transform.target);(centerTransform&&("center"!==transform.originX||"center"!==transform.originY)||!centerTransform&&"center"===transform.originX&&"center"===transform.originY)&&(this._resetCurrentTransform(),transform.reset=!0)}},_onScale:function(e,transform,x,y){return!e[this.uniScaleKey]&&!this.uniScaleTransform||transform.target.get("lockUniScaling")?(transform.reset||"scale"!==transform.currentAction||this._resetCurrentTransform(),transform.currentAction="scaleEqually",this._scaleObject(x,y,"equally")):(transform.currentAction="scale",this._scaleObject(x,y))},_setCursorFromEvent:function(e,target){if(!target)return this.setCursor(this.defaultCursor),!1;var hoverCursor=target.hoverCursor||this.hoverCursor;if(target.selectable){var activeGroup=this.getActiveGroup(),corner=target._findTargetCorner&&(!activeGroup||!activeGroup.contains(target))&&target._findTargetCorner(this.getPointer(e,!0));corner?this._setCornerCursor(corner,target,e):this.setCursor(hoverCursor)}else this.setCursor(hoverCursor);return!0},_setCornerCursor:function(corner,target,e){if(corner in cursorOffset)this.setCursor(this._getRotatedCornerCursor(corner,target,e));else{if("mtr"!==corner||!target.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(corner,target,e){var n=Math.round(target.getAngle()%360/45);return 0>n&&(n+=8),n+=cursorOffset[corner],e[this.altActionKey]&&cursorOffset[corner]%2===0&&(n+=2),n%=8,this.cursorMap[n]}})}(),function(){var min=Math.min,max=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(e,target){var activeObject=this.getActiveObject();return e[this.selectionKey]&&target&&target.selectable&&(this.getActiveGroup()||activeObject&&activeObject!==target)&&this.selection},_handleGrouping:function(e,target){target===this.getActiveGroup()&&(target=this.findTarget(e,!0),!target||target.isType("group"))||(this.getActiveGroup()?this._updateActiveGroup(target,e):this._createActiveGroup(target,e),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(target,e){var activeGroup=this.getActiveGroup();if(activeGroup.contains(target)){if(activeGroup.removeWithUpdate(target),target.set("active",!1),1===activeGroup.size())return this.discardActiveGroup(e),void this.setActiveObject(activeGroup.item(0))}else activeGroup.addWithUpdate(target);this.fire("selection:created",{target:activeGroup,e:e}),activeGroup.set("active",!0)},_createActiveGroup:function(target,e){if(this._activeObject&&target!==this._activeObject){var group=this._createGroup(target);group.addWithUpdate(),this.setActiveGroup(group),this._activeObject=null,this.fire("selection:created",{target:group,e:e})}target.set("active",!0)},_createGroup:function(target){var objects=this.getObjects(),isActiveLower=objects.indexOf(this._activeObject)<objects.indexOf(target),groupObjects=isActiveLower?[this._activeObject,target]:[target,this._activeObject];return new fabric.Group(groupObjects,{canvas:this})},_groupSelectedObjects:function(e){var group=this._collectObjects();1===group.length?this.setActiveObject(group[0],e):group.length>1&&(group=new fabric.Group(group.reverse(),{canvas:this}),group.addWithUpdate(),this.setActiveGroup(group,e),group.saveCoords(),this.fire("selection:created",{target:group}),this.renderAll())},_collectObjects:function(){for(var currentObject,group=[],x1=this._groupSelector.ex,y1=this._groupSelector.ey,x2=x1+this._groupSelector.left,y2=y1+this._groupSelector.top,selectionX1Y1=new fabric.Point(min(x1,x2),min(y1,y2)),selectionX2Y2=new fabric.Point(max(x1,x2),max(y1,y2)),isClick=x1===x2&&y1===y2,i=this._objects.length;i--&&(currentObject=this._objects[i],!(currentObject&&currentObject.selectable&&currentObject.visible&&(currentObject.intersectsWithRect(selectionX1Y1,selectionX2Y2)||currentObject.isContainedWithinRect(selectionX1Y1,selectionX2Y2)||currentObject.containsPoint(selectionX1Y1)||currentObject.containsPoint(selectionX2Y2))&&(currentObject.set("active",!0),group.push(currentObject),isClick))););return group},_maybeGroupObjects:function(e){this.selection&&this._groupSelector&&this._groupSelectedObjects(e);var activeGroup=this.getActiveGroup();activeGroup&&(activeGroup.setObjectsCoords().setCoords(),activeGroup.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(options){options||(options={});var format=options.format||"png",quality=options.quality||1,multiplier=options.multiplier||1,cropping={left:options.left,top:options.top,width:options.width,height:options.height};return this._isRetinaScaling()&&(multiplier*=fabric.devicePixelRatio),1!==multiplier?this.__toDataURLWithMultiplier(format,quality,cropping,multiplier):this.__toDataURL(format,quality,cropping)},__toDataURL:function(format,quality,cropping){this.renderAll();var canvasEl=this.contextContainer.canvas,croppedCanvasEl=this.__getCroppedCanvas(canvasEl,cropping);"jpg"===format&&(format="jpeg");var data=fabric.StaticCanvas.supports("toDataURLWithQuality")?(croppedCanvasEl||canvasEl).toDataURL("image/"+format,quality):(croppedCanvasEl||canvasEl).toDataURL("image/"+format);return croppedCanvasEl&&(croppedCanvasEl=null),data},__getCroppedCanvas:function(canvasEl,cropping){var croppedCanvasEl,croppedCtx,shouldCrop="left"in cropping||"top"in cropping||"width"in cropping||"height"in cropping;return shouldCrop&&(croppedCanvasEl=fabric.util.createCanvasElement(),croppedCtx=croppedCanvasEl.getContext("2d"),croppedCanvasEl.width=cropping.width||this.width,croppedCanvasEl.height=cropping.height||this.height,croppedCtx.drawImage(canvasEl,-cropping.left||0,-cropping.top||0)),croppedCanvasEl},__toDataURLWithMultiplier:function(format,quality,cropping,multiplier){var origWidth=this.getWidth(),origHeight=this.getHeight(),scaledWidth=origWidth*multiplier,scaledHeight=origHeight*multiplier,activeObject=this.getActiveObject(),activeGroup=this.getActiveGroup(),zoom=this.getZoom(),newZoom=zoom*multiplier/fabric.devicePixelRatio;multiplier>1&&this.setDimensions({width:scaledWidth,height:scaledHeight}),this.setZoom(newZoom),cropping.left&&(cropping.left*=multiplier),cropping.top&&(cropping.top*=multiplier),cropping.width?cropping.width*=multiplier:1>multiplier&&(cropping.width=scaledWidth),cropping.height?cropping.height*=multiplier:1>multiplier&&(cropping.height=scaledHeight),activeGroup?this._tempRemoveBordersControlsFromGroup(activeGroup):activeObject&&this.deactivateAll&&this.deactivateAll();var data=this.__toDataURL(format,quality,cropping);return activeGroup?this._restoreBordersControlsOnGroup(activeGroup):activeObject&&this.setActiveObject&&this.setActiveObject(activeObject),this.setZoom(zoom),this.setDimensions({width:origWidth,height:origHeight}),data},toDataURLWithMultiplier:function(format,multiplier,quality){return this.toDataURL({format:format,multiplier:multiplier,quality:quality})},_tempRemoveBordersControlsFromGroup:function(group){group.origHasControls=group.hasControls,group.origBorderColor=group.borderColor,group.hasControls=!0,group.borderColor="rgba(0,0,0,0)",group.forEachObject(function(o){o.origBorderColor=o.borderColor,o.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(group){group.hideControls=group.origHideControls,group.borderColor=group.origBorderColor,group.forEachObject(function(o){o.borderColor=o.origBorderColor,delete o.origBorderColor})}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(json,callback,reviver){return this.loadFromJSON(json,callback,reviver)},loadFromJSON:function(json,callback,reviver){if(json){var serialized="string"==typeof json?JSON.parse(json):fabric.util.object.clone(json);this.clear();var _this=this;this._enlivenObjects(serialized.objects,function(){_this._setBgOverlay(serialized,callback)},reviver),delete serialized.objects,delete serialized.backgroundImage,delete serialized.overlayImage,delete serialized.background,delete serialized.overlay;for(var prop in serialized)this[prop]=serialized[prop];return this}},_setBgOverlay:function(serialized,callback){var _this=this,loaded={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!(serialized.backgroundImage||serialized.overlayImage||serialized.background||serialized.overlay))return void(callback&&callback());var cbIfLoaded=function(){loaded.backgroundImage&&loaded.overlayImage&&loaded.backgroundColor&&loaded.overlayColor&&(_this.renderAll(),callback&&callback())};this.__setBgOverlay("backgroundImage",serialized.backgroundImage,loaded,cbIfLoaded),this.__setBgOverlay("overlayImage",serialized.overlayImage,loaded,cbIfLoaded),this.__setBgOverlay("backgroundColor",serialized.background,loaded,cbIfLoaded),this.__setBgOverlay("overlayColor",serialized.overlay,loaded,cbIfLoaded),cbIfLoaded()},__setBgOverlay:function(property,value,loaded,callback){var _this=this;return value?void("backgroundImage"===property||"overlayImage"===property?fabric.Image.fromObject(value,function(img){_this[property]=img,loaded[property]=!0,callback&&callback()}):this["set"+fabric.util.string.capitalize(property,!0)](value,function(){loaded[property]=!0,callback&&callback()})):void(loaded[property]=!0)},_enlivenObjects:function(objects,callback,reviver){var _this=this;if(!objects||0===objects.length)return void(callback&&callback());var renderOnAddRemove=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(objects,function(enlivenedObjects){enlivenedObjects.forEach(function(obj,index){_this.insertAt(obj,index,!0)}),_this.renderOnAddRemove=renderOnAddRemove,callback&&callback()},null,reviver)},_toDataURL:function(format,callback){this.clone(function(clone){callback(clone.toDataURL(format))})},_toDataURLWithMultiplier:function(format,multiplier,callback){this.clone(function(clone){callback(clone.toDataURLWithMultiplier(format,multiplier))})},clone:function(callback,properties){var data=JSON.stringify(this.toJSON(properties));this.cloneWithoutData(function(clone){clone.loadFromJSON(data,function(){callback&&callback(clone)})})},cloneWithoutData:function(callback){var el=fabric.document.createElement("canvas");el.width=this.getWidth(),el.height=this.getHeight();var clone=new fabric.Canvas(el);clone.clipTo=this.clipTo,this.backgroundImage?(clone.setBackgroundImage(this.backgroundImage.src,function(){clone.renderAll(),callback&&callback(clone)}),clone.backgroundImageOpacity=this.backgroundImageOpacity,clone.backgroundImageStretch=this.backgroundImageStretch):callback&&callback(clone)}}),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,toFixed=fabric.util.toFixed,capitalize=fabric.util.string.capitalize,degreesToRadians=fabric.util.degreesToRadians,supportsLineDash=fabric.StaticCanvas.supports("setLineDash");fabric.Object||(fabric.Object=fabric.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor alignX alignY meetOrSlice skewX skewY".split(" "),initialize:function(options){options&&this.setOptions(options)},_initGradient:function(options){!options.fill||!options.fill.colorStops||options.fill instanceof fabric.Gradient||this.set("fill",new fabric.Gradient(options.fill)),!options.stroke||!options.stroke.colorStops||options.stroke instanceof fabric.Gradient||this.set("stroke",new fabric.Gradient(options.stroke))},_initPattern:function(options){!options.fill||!options.fill.source||options.fill instanceof fabric.Pattern||this.set("fill",new fabric.Pattern(options.fill)),!options.stroke||!options.stroke.source||options.stroke instanceof fabric.Pattern||this.set("stroke",new fabric.Pattern(options.stroke))},_initClipping:function(options){if(options.clipTo&&"string"==typeof options.clipTo){var functionBody=fabric.util.getFunctionBody(options.clipTo);"undefined"!=typeof functionBody&&(this.clipTo=new Function("ctx",functionBody))}},setOptions:function(options){for(var prop in options)this.set(prop,options[prop]);this._initGradient(options),this._initPattern(options),this._initClipping(options)},transform:function(ctx,fromLeft){this.group&&this.canvas.preserveObjectStacking&&this.group===this.canvas._activeGroup&&this.group.transform(ctx);var center=fromLeft?this._getLeftTopCoords():this.getCenterPoint();ctx.translate(center.x,center.y),ctx.rotate(degreesToRadians(this.angle)),ctx.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1)),ctx.transform(1,0,Math.tan(degreesToRadians(this.skewX)),1,0,0),ctx.transform(1,Math.tan(degreesToRadians(this.skewY)),0,1,0,0)},toObject:function(propertiesToInclude){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,object={type:this.type,originX:this.originX,originY:this.originY,left:toFixed(this.left,NUM_FRACTION_DIGITS),top:toFixed(this.top,NUM_FRACTION_DIGITS),width:toFixed(this.width,NUM_FRACTION_DIGITS),height:toFixed(this.height,NUM_FRACTION_DIGITS),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:toFixed(this.strokeWidth,NUM_FRACTION_DIGITS),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:toFixed(this.strokeMiterLimit,NUM_FRACTION_DIGITS),scaleX:toFixed(this.scaleX,NUM_FRACTION_DIGITS),scaleY:toFixed(this.scaleY,NUM_FRACTION_DIGITS),angle:toFixed(this.getAngle(),NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:toFixed(this.opacity,NUM_FRACTION_DIGITS),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:toFixed(this.skewX,NUM_FRACTION_DIGITS),skewY:toFixed(this.skewY,NUM_FRACTION_DIGITS)};return this.includeDefaultValues||(object=this._removeDefaultValues(object)),fabric.util.populateWithProperties(this,object,propertiesToInclude),object},toDatalessObject:function(propertiesToInclude){return this.toObject(propertiesToInclude)},_removeDefaultValues:function(object){var prototype=fabric.util.getKlass(object.type).prototype,stateProperties=prototype.stateProperties;return stateProperties.forEach(function(prop){object[prop]===prototype[prop]&&delete object[prop];var isArray="[object Array]"===Object.prototype.toString.call(object[prop])&&"[object Array]"===Object.prototype.toString.call(prototype[prop]);isArray&&0===object[prop].length&&0===prototype[prop].length&&delete object[prop]}),object},toString:function(){return"#<fabric."+capitalize(this.type)+">"},get:function(property){return this[property]},_setObject:function(obj){for(var prop in obj)this._set(prop,obj[prop])},set:function(key,value){return"object"==typeof key?this._setObject(key):"function"==typeof value&&"clipTo"!==key?this._set(key,value(this.get(key))):this._set(key,value),this},_set:function(key,value){var shouldConstrainValue="scaleX"===key||"scaleY"===key;return shouldConstrainValue&&(value=this._constrainScale(value)),"scaleX"===key&&0>value?(this.flipX=!this.flipX,value*=-1):"scaleY"===key&&0>value?(this.flipY=!this.flipY,value*=-1):"shadow"!==key||!value||value instanceof fabric.Shadow||(value=new fabric.Shadow(value)),this[key]=value,"width"!==key&&"height"!==key||(this.minScaleLimit=Math.min(.1,1/Math.max(this.width,this.height))),this},setOnGroup:function(){},toggle:function(property){var value=this.get(property);return"boolean"==typeof value&&this.set(property,!value),this},setSourcePath:function(value){return this.sourcePath=value,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(ctx,noTransform){0===this.width&&0===this.height||!this.visible||(ctx.save(),this._setupCompositeOperation(ctx),this.drawSelectionBackground(ctx),noTransform||this.transform(ctx),this._setStrokeStyles(ctx),this._setFillStyles(ctx),this.transformMatrix&&ctx.transform.apply(ctx,this.transformMatrix),this._setOpacity(ctx),this._setShadow(ctx),this.clipTo&&fabric.util.clipContext(this,ctx),this._render(ctx,noTransform),this.clipTo&&ctx.restore(),ctx.restore())},_setOpacity:function(ctx){this.group&&this.group._setOpacity(ctx),ctx.globalAlpha*=this.opacity},_setStrokeStyles:function(ctx){this.stroke&&(ctx.lineWidth=this.strokeWidth,ctx.lineCap=this.strokeLineCap,ctx.lineJoin=this.strokeLineJoin,ctx.miterLimit=this.strokeMiterLimit,ctx.strokeStyle=this.stroke.toLive?this.stroke.toLive(ctx,this):this.stroke)},_setFillStyles:function(ctx){this.fill&&(ctx.fillStyle=this.fill.toLive?this.fill.toLive(ctx,this):this.fill)},_setLineDash:function(ctx,dashArray,alternative){dashArray&&(1&dashArray.length&&dashArray.push.apply(dashArray,dashArray),supportsLineDash?ctx.setLineDash(dashArray):alternative&&alternative(ctx))},_renderControls:function(ctx,noTransform){if(!(!this.active||noTransform||this.group&&this.group!==this.canvas.getActiveGroup())){var options,vpt=this.getViewportTransform(),matrix=this.calcTransformMatrix();matrix=fabric.util.multiplyTransformMatrices(vpt,matrix),options=fabric.util.qrDecompose(matrix),ctx.save(),ctx.translate(options.translateX,options.translateY),ctx.lineWidth=1/this.borderScaleFactor,ctx.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.group&&this.group===this.canvas.getActiveGroup()?(ctx.rotate(degreesToRadians(options.angle)),this.drawBordersInGroup(ctx,options)):(ctx.rotate(degreesToRadians(this.angle)),this.drawBorders(ctx)),this.drawControls(ctx),ctx.restore()}},_setShadow:function(ctx){if(this.shadow){var multX=this.canvas&&this.canvas.viewportTransform[0]||1,multY=this.canvas&&this.canvas.viewportTransform[3]||1;this.canvas&&this.canvas._isRetinaScaling()&&(multX*=fabric.devicePixelRatio,multY*=fabric.devicePixelRatio),ctx.shadowColor=this.shadow.color,ctx.shadowBlur=this.shadow.blur*(multX+multY)*(this.scaleX+this.scaleY)/4,ctx.shadowOffsetX=this.shadow.offsetX*multX*this.scaleX,ctx.shadowOffsetY=this.shadow.offsetY*multY*this.scaleY}},_removeShadow:function(ctx){this.shadow&&(ctx.shadowColor="",ctx.shadowBlur=ctx.shadowOffsetX=ctx.shadowOffsetY=0)},_renderFill:function(ctx){if(this.fill){if(ctx.save(),this.fill.gradientTransform){var g=this.fill.gradientTransform;ctx.transform.apply(ctx,g)}this.fill.toLive&&ctx.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?ctx.fill("evenodd"):ctx.fill(),ctx.restore()}},_renderStroke:function(ctx){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(ctx),ctx.save(),this._setLineDash(ctx,this.strokeDashArray,this._renderDashedStroke),this.stroke.gradientTransform){var g=this.stroke.gradientTransform;ctx.transform.apply(ctx,g)}this.stroke.toLive&&ctx.translate(-this.width/2+this.stroke.offsetX||0,-this.height/2+this.stroke.offsetY||0),ctx.stroke(),ctx.restore()}},clone:function(callback,propertiesToInclude){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(propertiesToInclude),callback):new fabric.Object(this.toObject(propertiesToInclude))},cloneAsImage:function(callback){var dataUrl=this.toDataURL();return fabric.util.loadImage(dataUrl,function(img){callback&&callback(new fabric.Image(img))}),this},toDataURL:function(options){options||(options={});var el=fabric.util.createCanvasElement(),boundingRect=this.getBoundingRect();el.width=boundingRect.width,el.height=boundingRect.height,fabric.util.wrapElement(el,"div");var canvas=new fabric.StaticCanvas(el);"jpg"===options.format&&(options.format="jpeg"),"jpeg"===options.format&&(canvas.backgroundColor="#fff");var origParams={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new fabric.Point(canvas.getWidth()/2,canvas.getHeight()/2),"center","center");var originalCanvas=this.canvas;canvas.add(this);var data=canvas.toDataURL(options);return this.set(origParams).setCoords(),this.canvas=originalCanvas,canvas.dispose(),canvas=null,data},isType:function(type){return this.type===type},complexity:function(){return 0},toJSON:function(propertiesToInclude){return this.toObject(propertiesToInclude)},setGradient:function(property,options){options||(options={});var gradient={colorStops:[]};gradient.type=options.type||(options.r1||options.r2?"radial":"linear"),gradient.coords={x1:options.x1,y1:options.y1,x2:options.x2,y2:options.y2},(options.r1||options.r2)&&(gradient.coords.r1=options.r1,gradient.coords.r2=options.r2),options.gradientTransform&&(gradient.gradientTransform=options.gradientTransform);for(var position in options.colorStops){var color=new fabric.Color(options.colorStops[position]);gradient.colorStops.push({offset:position,color:color.toRgb(),opacity:color.getAlpha()})}return this.set(property,fabric.Gradient.forObject(this,gradient))},setPatternFill:function(options){return this.set("fill",new fabric.Pattern(options))},setShadow:function(options){return this.set("shadow",options?new fabric.Shadow(options):null)},setColor:function(color){return this.set("fill",color),this},setAngle:function(angle){var shouldCenterOrigin=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return shouldCenterOrigin&&this._setOriginToCenter(),this.set("angle",angle),shouldCenterOrigin&&this._resetOrigin(),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this),this},getLocalPointer:function(e,pointer){pointer=pointer||this.canvas.getPointer(e);var pClicked=new fabric.Point(pointer.x,pointer.y),objectLeftTop=this._getLeftTopCoords();return this.angle&&(pClicked=fabric.util.rotatePoint(pClicked,objectLeftTop,fabric.util.degreesToRadians(-this.angle))),{x:pClicked.x-objectLeftTop.x,y:pClicked.y-objectLeftTop.y}},_setupCompositeOperation:function(ctx){
this.globalCompositeOperation&&(ctx.globalCompositeOperation=this.globalCompositeOperation)}}),fabric.util.createAccessors(fabric.Object),fabric.Object.prototype.rotate=fabric.Object.prototype.setAngle,extend(fabric.Object.prototype,fabric.Observable),fabric.Object.NUM_FRACTION_DIGITS=2,fabric.Object.__uid=0)}(exports),function(){var degreesToRadians=fabric.util.degreesToRadians,originXOffset={left:-.5,center:0,right:.5},originYOffset={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(point,fromOriginX,fromOriginY,toOriginX,toOriginY){var dim,x=point.x,y=point.y,offsetX=originXOffset[toOriginX]-originXOffset[fromOriginX],offsetY=originYOffset[toOriginY]-originYOffset[fromOriginY];return(offsetX||offsetY)&&(dim=this._getTransformedDimensions(),x=point.x+offsetX*dim.x,y=point.y+offsetY*dim.y),new fabric.Point(x,y)},translateToCenterPoint:function(point,originX,originY){var p=this.translateToGivenOrigin(point,originX,originY,"center","center");return this.angle?fabric.util.rotatePoint(p,point,degreesToRadians(this.angle)):p},translateToOriginPoint:function(center,originX,originY){var p=this.translateToGivenOrigin(center,"center","center",originX,originY);return this.angle?fabric.util.rotatePoint(p,center,degreesToRadians(this.angle)):p},getCenterPoint:function(){var leftTop=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(leftTop,this.originX,this.originY)},getPointByOrigin:function(originX,originY){var center=this.getCenterPoint();return this.translateToOriginPoint(center,originX,originY)},toLocalPoint:function(point,originX,originY){var p,p2,center=this.getCenterPoint();return p=originX&&originY?this.translateToGivenOrigin(center,"center","center",originX,originY):new fabric.Point(this.left,this.top),p2=new fabric.Point(point.x,point.y),this.angle&&(p2=fabric.util.rotatePoint(p2,center,-degreesToRadians(this.angle))),p2.subtractEquals(p)},setPositionByOrigin:function(pos,originX,originY){var center=this.translateToCenterPoint(pos,originX,originY),position=this.translateToOriginPoint(center,this.originX,this.originY);this.set("left",position.x),this.set("top",position.y)},adjustPosition:function(to){var angle=degreesToRadians(this.angle),hypotFull=this.getWidth(),xFull=Math.cos(angle)*hypotFull,yFull=Math.sin(angle)*hypotFull;this.left+=xFull*(originXOffset[to]-originXOffset[this.originX]),this.top+=yFull*(originXOffset[to]-originXOffset[this.originX]),this.setCoords(),this.originX=to},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var center=this.getCenterPoint();this.originX="center",this.originY="center",this.left=center.x,this.top=center.y},_resetOrigin:function(){var originPoint=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=originPoint.x,this.top=originPoint.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function getCoords(oCoords){return[new fabric.Point(oCoords.tl.x,oCoords.tl.y),new fabric.Point(oCoords.tr.x,oCoords.tr.y),new fabric.Point(oCoords.br.x,oCoords.br.y),new fabric.Point(oCoords.bl.x,oCoords.bl.y)]}var degreesToRadians=fabric.util.degreesToRadians,multiplyMatrices=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(pointTL,pointBR){var oCoords=getCoords(this.oCoords),intersection=fabric.Intersection.intersectPolygonRectangle(oCoords,pointTL,pointBR);return"Intersection"===intersection.status},intersectsWithObject:function(other){var intersection=fabric.Intersection.intersectPolygonPolygon(getCoords(this.oCoords),getCoords(other.oCoords));return"Intersection"===intersection.status},isContainedWithinObject:function(other){var boundingRect=other.getBoundingRect(),point1=new fabric.Point(boundingRect.left,boundingRect.top),point2=new fabric.Point(boundingRect.left+boundingRect.width,boundingRect.top+boundingRect.height);return this.isContainedWithinRect(point1,point2)},isContainedWithinRect:function(pointTL,pointBR){var boundingRect=this.getBoundingRect();return boundingRect.left>=pointTL.x&&boundingRect.left+boundingRect.width<=pointBR.x&&boundingRect.top>=pointTL.y&&boundingRect.top+boundingRect.height<=pointBR.y},containsPoint:function(point){var lines=this._getImageLines(this.oCoords),xPoints=this._findCrossPoints(point,lines);return 0!==xPoints&&xPoints%2===1},_getImageLines:function(oCoords){return{topline:{o:oCoords.tl,d:oCoords.tr},rightline:{o:oCoords.tr,d:oCoords.br},bottomline:{o:oCoords.br,d:oCoords.bl},leftline:{o:oCoords.bl,d:oCoords.tl}}},_findCrossPoints:function(point,oCoords){var b1,b2,a1,a2,xi,yi,iLine,xcount=0;for(var lineKey in oCoords)if(iLine=oCoords[lineKey],!(iLine.o.y<point.y&&iLine.d.y<point.y||iLine.o.y>=point.y&&iLine.d.y>=point.y||(iLine.o.x===iLine.d.x&&iLine.o.x>=point.x?(xi=iLine.o.x,yi=point.y):(b1=0,b2=(iLine.d.y-iLine.o.y)/(iLine.d.x-iLine.o.x),a1=point.y-b1*point.x,a2=iLine.o.y-b2*iLine.o.x,xi=-(a1-a2)/(b1-b2),yi=a1+b1*xi),xi>=point.x&&(xcount+=1),2!==xcount)))break;return xcount},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){return this.oCoords||this.setCoords(),fabric.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(value){return Math.abs(value)<this.minScaleLimit?0>value?-this.minScaleLimit:this.minScaleLimit:value},scale:function(value){return value=this._constrainScale(value),0>value&&(this.flipX=!this.flipX,this.flipY=!this.flipY,value*=-1),this.scaleX=value,this.scaleY=value,this.setCoords(),this},scaleToWidth:function(value){var boundingRectFactor=this.getBoundingRect().width/this.getWidth();return this.scale(value/this.width/boundingRectFactor)},scaleToHeight:function(value){var boundingRectFactor=this.getBoundingRect().height/this.getHeight();return this.scale(value/this.height/boundingRectFactor)},setCoords:function(){var theta=degreesToRadians(this.angle),vpt=this.getViewportTransform(),dim=this._calculateCurrentDimensions(),currentWidth=dim.x,currentHeight=dim.y;0>currentWidth&&(currentWidth=Math.abs(currentWidth));var sinTh=Math.sin(theta),cosTh=Math.cos(theta),_angle=currentWidth>0?Math.atan(currentHeight/currentWidth):0,_hypotenuse=currentWidth/Math.cos(_angle)/2,offsetX=Math.cos(_angle+theta)*_hypotenuse,offsetY=Math.sin(_angle+theta)*_hypotenuse,coords=fabric.util.transformPoint(this.getCenterPoint(),vpt),tl=new fabric.Point(coords.x-offsetX,coords.y-offsetY),tr=new fabric.Point(tl.x+currentWidth*cosTh,tl.y+currentWidth*sinTh),bl=new fabric.Point(tl.x-currentHeight*sinTh,tl.y+currentHeight*cosTh),br=new fabric.Point(coords.x+offsetX,coords.y+offsetY),ml=new fabric.Point((tl.x+bl.x)/2,(tl.y+bl.y)/2),mt=new fabric.Point((tr.x+tl.x)/2,(tr.y+tl.y)/2),mr=new fabric.Point((br.x+tr.x)/2,(br.y+tr.y)/2),mb=new fabric.Point((br.x+bl.x)/2,(br.y+bl.y)/2),mtr=new fabric.Point(mt.x+sinTh*this.rotatingPointOffset,mt.y-cosTh*this.rotatingPointOffset);return this.oCoords={tl:tl,tr:tr,br:br,bl:bl,ml:ml,mt:mt,mr:mr,mb:mb,mtr:mtr},this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var theta=degreesToRadians(this.angle),cos=Math.cos(theta),sin=Math.sin(theta);return[cos,sin,-sin,cos,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var center=this.getCenterPoint(),translateMatrix=[1,0,0,1,center.x,center.y],rotateMatrix=this._calcRotateMatrix(),dimensionMatrix=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0),matrix=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0];return matrix=multiplyMatrices(matrix,translateMatrix),matrix=multiplyMatrices(matrix,rotateMatrix),matrix=multiplyMatrices(matrix,dimensionMatrix)},_calcDimensionsTransformMatrix:function(skewX,skewY,flipping){var skewMatrixX=[1,0,Math.tan(degreesToRadians(skewX)),1],skewMatrixY=[1,Math.tan(degreesToRadians(skewY)),0,1],scaleX=this.scaleX*(flipping&&this.flipX?-1:1),scaleY=this.scaleY*(flipping&&this.flipY?-1:1),scaleMatrix=[scaleX,0,0,scaleY],m=multiplyMatrices(scaleMatrix,skewMatrixX,!0);return multiplyMatrices(m,skewMatrixY,!0)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(intersecting){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,intersecting):this.canvas.sendBackwards(this,intersecting),this},bringForward:function(intersecting){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,intersecting):this.canvas.bringForward(this,intersecting),this},moveTo:function(index){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,index):this.canvas.moveTo(this,index),this}}),function(){function getSvgColorString(prop,value){if(value){if(value.toLive)return prop+": url(#SVGID_"+value.id+"); ";var color=new fabric.Color(value),str=prop+": "+value+"; ",opacity=color.getAlpha();return 1!==opacity&&(str=prop+": "+color.toRgb()+"; ",str+=prop+"-opacity: "+opacity.toString()+"; "),str}return prop+": none; "}fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(skipShadow){var fillRule=this.fillRule,strokeWidth=this.strokeWidth?this.strokeWidth:"0",strokeDashArray=this.strokeDashArray?this.strokeDashArray.join(" "):"none",strokeLineCap=this.strokeLineCap?this.strokeLineCap:"butt",strokeLineJoin=this.strokeLineJoin?this.strokeLineJoin:"miter",strokeMiterLimit=this.strokeMiterLimit?this.strokeMiterLimit:"4",opacity="undefined"!=typeof this.opacity?this.opacity:"1",visibility=this.visible?"":" visibility: hidden;",filter=skipShadow?"":this.getSvgFilter(),fill=getSvgColorString("fill",this.fill),stroke=getSvgColorString("stroke",this.stroke);return[stroke,"stroke-width: ",strokeWidth,"; ","stroke-dasharray: ",strokeDashArray,"; ","stroke-linecap: ",strokeLineCap,"; ","stroke-linejoin: ",strokeLineJoin,"; ","stroke-miterlimit: ",strokeMiterLimit,"; ",fill,"fill-rule: ",fillRule,"; ","opacity: ",opacity,";",filter,visibility].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var toFixed=fabric.util.toFixed,angle=this.getAngle(),skewX=this.getSkewX()%360,skewY=this.getSkewY()%360,center=this.getCenterPoint(),NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,translatePart="path-group"===this.type?"":"translate("+toFixed(center.x,NUM_FRACTION_DIGITS)+" "+toFixed(center.y,NUM_FRACTION_DIGITS)+")",anglePart=0!==angle?" rotate("+toFixed(angle,NUM_FRACTION_DIGITS)+")":"",scalePart=1===this.scaleX&&1===this.scaleY?"":" scale("+toFixed(this.scaleX,NUM_FRACTION_DIGITS)+" "+toFixed(this.scaleY,NUM_FRACTION_DIGITS)+")",skewXPart=0!==skewX?" skewX("+toFixed(skewX,NUM_FRACTION_DIGITS)+")":"",skewYPart=0!==skewY?" skewY("+toFixed(skewY,NUM_FRACTION_DIGITS)+")":"",addTranslateX="path-group"===this.type?this.width:0,flipXPart=this.flipX?" matrix(-1 0 0 1 "+addTranslateX+" 0) ":"",addTranslateY="path-group"===this.type?this.height:0,flipYPart=this.flipY?" matrix(1 0 0 -1 0 "+addTranslateY+")":"";return[translatePart,anglePart,scalePart,flipXPart,flipYPart,skewXPart,skewYPart].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var markup=[];return this.fill&&this.fill.toLive&&markup.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&markup.push(this.stroke.toSVG(this,!1)),this.shadow&&markup.push(this.shadow.toSVG(this)),markup}})}(),fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(prop){return this.get(prop)!==this.originalState[prop]},this)},saveState:function(options){return this.stateProperties.forEach(function(prop){this.originalState[prop]=this.get(prop)},this),options&&options.stateProperties&&options.stateProperties.forEach(function(prop){this.originalState[prop]=this.get(prop)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var degreesToRadians=fabric.util.degreesToRadians,isVML=function(){return"undefined"!=typeof G_vmlCanvasManager};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(pointer){if(!this.hasControls||!this.active)return!1;var xPoints,lines,ex=pointer.x,ey=pointer.y;this.__corner=0;for(var i in this.oCoords)if(this.isControlVisible(i)&&("mtr"!==i||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==i&&"mr"!==i&&"mb"!==i&&"ml"!==i)&&(lines=this._getImageLines(this.oCoords[i].corner),xPoints=this._findCrossPoints({x:ex,y:ey},lines),0!==xPoints&&xPoints%2===1))return this.__corner=i,i;return!1},_setCornerCoords:function(){var x,y,coords=this.oCoords,newTheta=degreesToRadians(45-this.angle),cornerHypotenuse=.707106*this.cornerSize,cosHalfOffset=cornerHypotenuse*Math.cos(newTheta),sinHalfOffset=cornerHypotenuse*Math.sin(newTheta);for(var point in coords)x=coords[point].x,y=coords[point].y,coords[point].corner={tl:{x:x-sinHalfOffset,y:y-cosHalfOffset},tr:{x:x+cosHalfOffset,y:y-sinHalfOffset},bl:{x:x-cosHalfOffset,y:y+sinHalfOffset},br:{x:x+sinHalfOffset,y:y+cosHalfOffset}}},_getNonTransformedDimensions:function(){var strokeWidth=this.strokeWidth,w=this.width,h=this.height,addStrokeToW=!0,addStrokeToH=!0;return"line"===this.type&&"butt"===this.strokeLineCap&&(addStrokeToH=w,addStrokeToW=h),addStrokeToH&&(h+=0>h?-strokeWidth:strokeWidth),addStrokeToW&&(w+=0>w?-strokeWidth:strokeWidth),{x:w,y:h}},_getTransformedDimensions:function(skewX,skewY){"undefined"==typeof skewX&&(skewX=this.skewX),"undefined"==typeof skewY&&(skewY=this.skewY);var i,bbox,dimensions=this._getNonTransformedDimensions(),dimX=dimensions.x/2,dimY=dimensions.y/2,points=[{x:-dimX,y:-dimY},{x:dimX,y:-dimY},{x:-dimX,y:dimY},{x:dimX,y:dimY}],transformMatrix=this._calcDimensionsTransformMatrix(skewX,skewY,!1);for(i=0;i<points.length;i++)points[i]=fabric.util.transformPoint(points[i],transformMatrix);return bbox=fabric.util.makeBoundingBoxFromPoints(points),{x:bbox.width,y:bbox.height}},_calculateCurrentDimensions:function(){var vpt=this.getViewportTransform(),dim=this._getTransformedDimensions(),w=dim.x,h=dim.y;return w+=2*this.padding,h+=2*this.padding,fabric.util.transformPoint(new fabric.Point(w,h),vpt,!0)},drawSelectionBackground:function(ctx){if(!this.selectionBackgroundColor||!this.active||this.group)return this;ctx.save();var center=this.getCenterPoint(),wh=this._calculateCurrentDimensions();return ctx.translate(center.x,center.y),ctx.rotate(degreesToRadians(this.angle)),ctx.fillStyle=this.selectionBackgroundColor,ctx.fillRect(-wh.x/2,-wh.y/2,wh.x,wh.y),ctx.restore(),this},drawBorders:function(ctx){if(!this.hasBorders)return this;var wh=this._calculateCurrentDimensions(),strokeWidth=1/this.borderScaleFactor,width=wh.x+strokeWidth,height=wh.y+strokeWidth;if(ctx.save(),ctx.strokeStyle=this.borderColor,this._setLineDash(ctx,this.borderDashArray,null),ctx.strokeRect(-width/2,-height/2,width,height),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var rotateHeight=-height/2;ctx.beginPath(),ctx.moveTo(0,rotateHeight),ctx.lineTo(0,rotateHeight-this.rotatingPointOffset),ctx.closePath(),ctx.stroke()}return ctx.restore(),this},drawBordersInGroup:function(ctx,options){if(!this.hasBorders)return this;var p=this._getNonTransformedDimensions(),matrix=fabric.util.customTransformMatrix(options.scaleX,options.scaleY,options.skewX),wh=fabric.util.transformPoint(p,matrix),strokeWidth=1/this.borderScaleFactor,width=wh.x+strokeWidth+2*this.padding,height=wh.y+strokeWidth+2*this.padding;return ctx.save(),this._setLineDash(ctx,this.borderDashArray,null),ctx.strokeStyle=this.borderColor,ctx.strokeRect(-width/2,-height/2,width,height),ctx.restore(),this},drawControls:function(ctx){if(!this.hasControls)return this;var wh=this._calculateCurrentDimensions(),width=wh.x,height=wh.y,scaleOffset=this.cornerSize,left=-(width+scaleOffset)/2,top=-(height+scaleOffset)/2,methodName=this.transparentCorners?"stroke":"fill";return ctx.save(),ctx.strokeStyle=ctx.fillStyle=this.cornerColor,this.transparentCorners||(ctx.strokeStyle=this.cornerStrokeColor),this._setLineDash(ctx,this.cornerDashArray,null),this._drawControl("tl",ctx,methodName,left,top),this._drawControl("tr",ctx,methodName,left+width,top),this._drawControl("bl",ctx,methodName,left,top+height),this._drawControl("br",ctx,methodName,left+width,top+height),this.get("lockUniScaling")||(this._drawControl("mt",ctx,methodName,left+width/2,top),this._drawControl("mb",ctx,methodName,left+width/2,top+height),this._drawControl("mr",ctx,methodName,left+width,top+height/2),this._drawControl("ml",ctx,methodName,left,top+height/2)),this.hasRotatingPoint&&this._drawControl("mtr",ctx,methodName,left+width/2,top-this.rotatingPointOffset),ctx.restore(),this},_drawControl:function(control,ctx,methodName,left,top){if(this.isControlVisible(control)){var size=this.cornerSize,stroke=!this.transparentCorners&&this.cornerStrokeColor;switch(this.cornerStyle){case"circle":ctx.beginPath(),ctx.arc(left+size/2,top+size/2,size/2,0,2*Math.PI,!1),ctx[methodName](),stroke&&ctx.stroke();break;default:isVML()||this.transparentCorners||ctx.clearRect(left,top,size,size),ctx[methodName+"Rect"](left,top,size,size),stroke&&ctx.strokeRect(left,top,size,size)}}},isControlVisible:function(controlName){return this._getControlsVisibility()[controlName]},setControlVisible:function(controlName,visible){return this._getControlsVisibility()[controlName]=visible,this},setControlsVisibility:function(options){options||(options={});for(var p in options)this.setControlVisible(p,options[p]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;return fabric.util.animate({startValue:object.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(value){object.set("left",value),_this.renderAll(),onChange()},onComplete:function(){object.setCoords(),onComplete()}}),this},fxCenterObjectV:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;return fabric.util.animate({startValue:object.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(value){object.set("top",value),_this.renderAll(),onChange()},onComplete:function(){object.setCoords(),onComplete()}}),this},fxRemove:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;return fabric.util.animate({startValue:object.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){object.set("active",!1)},onChange:function(value){object.set("opacity",value),_this.renderAll(),onChange()},onComplete:function(){_this.remove(object),onComplete()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var prop,skipCallbacks,propsToAnimate=[];for(prop in arguments[0])propsToAnimate.push(prop);for(var i=0,len=propsToAnimate.length;len>i;i++)prop=propsToAnimate[i],skipCallbacks=i!==len-1,this._animate(prop,arguments[0][prop],arguments[1],skipCallbacks)}else this._animate.apply(this,arguments);return this},_animate:function(property,to,options,skipCallbacks){var propPair,_this=this;to=to.toString(),options=options?fabric.util.object.clone(options):{},~property.indexOf(".")&&(propPair=property.split("."));var currentValue=propPair?this.get(propPair[0])[propPair[1]]:this.get(property);"from"in options||(options.from=currentValue),to=~to.indexOf("=")?currentValue+parseFloat(to.replace("=","")):parseFloat(to),fabric.util.animate({startValue:options.from,endValue:to,byValue:options.by,easing:options.easing,duration:options.duration,abort:options.abort&&function(){return options.abort.call(_this)},onChange:function(value){propPair?_this[propPair[0]][propPair[1]]=value:_this.set(property,value),skipCallbacks||options.onChange&&options.onChange()},onComplete:function(){skipCallbacks||(_this.setCoords(),options.onComplete&&options.onComplete())}})}}),function(global){"use strict";function makeEdgeToOriginGetter(propertyNames,originValues){var origin=propertyNames.origin,axis1=propertyNames.axis1,axis2=propertyNames.axis2,dimension=propertyNames.dimension,nearest=originValues.nearest,center=originValues.center,farthest=originValues.farthest;return function(){switch(this.get(origin)){case nearest:return Math.min(this.get(axis1),this.get(axis2));case center:return Math.min(this.get(axis1),this.get(axis2))+.5*this.get(dimension);case farthest:return Math.max(this.get(axis1),this.get(axis2))}}}var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,coordProps={x1:1,x2:1,y1:1,y2:1},supportsLineDash=fabric.StaticCanvas.supports("setLineDash");return fabric.Line?void fabric.warn("fabric.Line is already defined"):(fabric.Line=fabric.util.createClass(fabric.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(points,options){options=options||{},points||(points=[0,0,0,0]),this.callSuper("initialize",options),this.set("x1",points[0]),this.set("y1",points[1]),this.set("x2",points[2]),this.set("y2",points[3]),this._setWidthHeight(options)},_setWidthHeight:function(options){options||(options={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in options?options.left:this._getLeftToOriginX(),this.top="top"in options?options.top:this._getTopToOriginY()},_set:function(key,value){return this.callSuper("_set",key,value),"undefined"!=typeof coordProps[key]&&this._setWidthHeight(),this},_getLeftToOriginX:makeEdgeToOriginGetter({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:makeEdgeToOriginGetter({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(ctx,noTransform){if(ctx.beginPath(),noTransform){var cp=this.getCenterPoint();ctx.translate(cp.x-this.strokeWidth/2,cp.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&supportsLineDash){var p=this.calcLinePoints();ctx.moveTo(p.x1,p.y1),ctx.lineTo(p.x2,p.y2)}ctx.lineWidth=this.strokeWidth;var origStrokeStyle=ctx.strokeStyle;ctx.strokeStyle=this.stroke||ctx.fillStyle,this.stroke&&this._renderStroke(ctx),ctx.strokeStyle=origStrokeStyle},_renderDashedStroke:function(ctx){var p=this.calcLinePoints();ctx.beginPath(),fabric.util.drawDashedLine(ctx,p.x1,p.y1,p.x2,p.y2,this.strokeDashArray),ctx.closePath()},toObject:function(propertiesToInclude){return extend(this.callSuper("toObject",propertiesToInclude),this.calcLinePoints())},calcLinePoints:function(){var xMult=this.x1<=this.x2?-1:1,yMult=this.y1<=this.y2?-1:1,x1=xMult*this.width*.5,y1=yMult*this.height*.5,x2=xMult*this.width*-.5,y2=yMult*this.height*-.5;return{x1:x1,x2:x2,y1:y1,y2:y2}},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),p={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&"path-group"===this.group.type||(p=this.calcLinePoints()),markup.push("<line ",'x1="',p.x1,'" y1="',p.y1,'" x2="',p.x2,'" y2="',p.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),reviver?reviver(markup.join("")):markup.join("")},complexity:function(){return 1}}),fabric.Line.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),fabric.Line.fromElement=function(element,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Line.ATTRIBUTE_NAMES),points=[parsedAttributes.x1||0,parsedAttributes.y1||0,parsedAttributes.x2||0,parsedAttributes.y2||0];return new fabric.Line(points,extend(parsedAttributes,options))},void(fabric.Line.fromObject=function(object){var points=[object.x1,object.y1,object.x2,object.y2];return new fabric.Line(points,object)}))}(exports),function(global){"use strict";function isValidRadius(attributes){return"radius"in attributes&&attributes.radius>=0}var fabric=global.fabric||(global.fabric={}),pi=Math.PI,extend=fabric.util.object.extend;return fabric.Circle?void fabric.warn("fabric.Circle is already defined."):(fabric.Circle=fabric.util.createClass(fabric.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*pi,initialize:function(options){options=options||{},this.callSuper("initialize",options),this.set("radius",options.radius||0),this.startAngle=options.startAngle||this.startAngle,this.endAngle=options.endAngle||this.endAngle},_set:function(key,value){return this.callSuper("_set",key,value),"radius"===key&&this.setRadius(value),this},toObject:function(propertiesToInclude){return extend(this.callSuper("toObject",propertiesToInclude),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),x=0,y=0,angle=(this.endAngle-this.startAngle)%(2*pi);if(0===angle)this.group&&"path-group"===this.group.type&&(x=this.left+this.radius,y=this.top+this.radius),markup.push("<circle ",'cx="'+x+'" cy="'+y+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var startX=Math.cos(this.startAngle)*this.radius,startY=Math.sin(this.startAngle)*this.radius,endX=Math.cos(this.endAngle)*this.radius,endY=Math.sin(this.endAngle)*this.radius,largeFlag=angle>pi?"1":"0";markup.push('<path d="M '+startX+" "+startY," A "+this.radius+" "+this.radius," 0 ",+largeFlag+" 1"," "+endX+" "+endY,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return reviver?reviver(markup.join("")):markup.join("")},_render:function(ctx,noTransform){ctx.beginPath(),ctx.arc(noTransform?this.left+this.radius:0,noTransform?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1),this._renderFill(ctx),this._renderStroke(ctx)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(value){return this.radius=value,this.set("width",2*value).set("height",2*value)},complexity:function(){return 1}}),fabric.Circle.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),fabric.Circle.fromElement=function(element,options){options||(options={});var parsedAttributes=fabric.parseAttributes(element,fabric.Circle.ATTRIBUTE_NAMES);if(!isValidRadius(parsedAttributes))throw new Error("value of `r` attribute is required and can not be negative");parsedAttributes.left=parsedAttributes.left||0,parsedAttributes.top=parsedAttributes.top||0;var obj=new fabric.Circle(extend(parsedAttributes,options));return obj.left-=obj.radius,obj.top-=obj.radius,obj},void(fabric.Circle.fromObject=function(object){return new fabric.Circle(object)}))}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={});return fabric.Triangle?void fabric.warn("fabric.Triangle is already defined"):(fabric.Triangle=fabric.util.createClass(fabric.Object,{type:"triangle",initialize:function(options){options=options||{},this.callSuper("initialize",options),this.set("width",options.width||100).set("height",options.height||100)},_render:function(ctx){var widthBy2=this.width/2,heightBy2=this.height/2;ctx.beginPath(),ctx.moveTo(-widthBy2,heightBy2),ctx.lineTo(0,-heightBy2),ctx.lineTo(widthBy2,heightBy2),ctx.closePath(),this._renderFill(ctx),this._renderStroke(ctx)},_renderDashedStroke:function(ctx){var widthBy2=this.width/2,heightBy2=this.height/2;ctx.beginPath(),fabric.util.drawDashedLine(ctx,-widthBy2,heightBy2,0,-heightBy2,this.strokeDashArray),fabric.util.drawDashedLine(ctx,0,-heightBy2,widthBy2,heightBy2,this.strokeDashArray),fabric.util.drawDashedLine(ctx,widthBy2,heightBy2,-widthBy2,heightBy2,this.strokeDashArray),ctx.closePath()},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),widthBy2=this.width/2,heightBy2=this.height/2,points=[-widthBy2+" "+heightBy2,"0 "+-heightBy2,widthBy2+" "+heightBy2].join(",");return markup.push("<polygon ",'points="',points,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),reviver?reviver(markup.join("")):markup.join("")},complexity:function(){return 1}}),void(fabric.Triangle.fromObject=function(object){return new fabric.Triangle(object)}))}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),piBy2=2*Math.PI,extend=fabric.util.object.extend;return fabric.Ellipse?void fabric.warn("fabric.Ellipse is already defined."):(fabric.Ellipse=fabric.util.createClass(fabric.Object,{type:"ellipse",rx:0,ry:0,initialize:function(options){options=options||{},this.callSuper("initialize",options),this.set("rx",options.rx||0),this.set("ry",options.ry||0)},_set:function(key,value){switch(this.callSuper("_set",key,value),key){case"rx":this.rx=value,this.set("width",2*value);break;case"ry":this.ry=value,this.set("height",2*value)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(propertiesToInclude){return extend(this.callSuper("toObject",propertiesToInclude),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),x=0,y=0;return this.group&&"path-group"===this.group.type&&(x=this.left+this.rx,y=this.top+this.ry),markup.push("<ellipse ",'cx="',x,'" cy="',y,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),reviver?reviver(markup.join("")):markup.join("")},_render:function(ctx,noTransform){ctx.beginPath(),ctx.save(),ctx.transform(1,0,0,this.ry/this.rx,0,0),ctx.arc(noTransform?this.left+this.rx:0,noTransform?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,piBy2,!1),ctx.restore(),this._renderFill(ctx),this._renderStroke(ctx)},complexity:function(){return 1}}),fabric.Ellipse.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),fabric.Ellipse.fromElement=function(element,options){options||(options={});var parsedAttributes=fabric.parseAttributes(element,fabric.Ellipse.ATTRIBUTE_NAMES);parsedAttributes.left=parsedAttributes.left||0,parsedAttributes.top=parsedAttributes.top||0;var ellipse=new fabric.Ellipse(extend(parsedAttributes,options));return ellipse.top-=ellipse.ry,ellipse.left-=ellipse.rx,ellipse},void(fabric.Ellipse.fromObject=function(object){return new fabric.Ellipse(object)}))}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;if(fabric.Rect)return void fabric.warn("fabric.Rect is already defined");var stateProperties=fabric.Object.prototype.stateProperties.concat();stateProperties.push("rx","ry","x","y"),fabric.Rect=fabric.util.createClass(fabric.Object,{stateProperties:stateProperties,
type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(options){options=options||{},this.callSuper("initialize",options),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(ctx,noTransform){if(1===this.width&&1===this.height)return void ctx.fillRect(-.5,-.5,1,1);var rx=this.rx?Math.min(this.rx,this.width/2):0,ry=this.ry?Math.min(this.ry,this.height/2):0,w=this.width,h=this.height,x=noTransform?this.left:-this.width/2,y=noTransform?this.top:-this.height/2,isRounded=0!==rx||0!==ry,k=.4477152502;ctx.beginPath(),ctx.moveTo(x+rx,y),ctx.lineTo(x+w-rx,y),isRounded&&ctx.bezierCurveTo(x+w-k*rx,y,x+w,y+k*ry,x+w,y+ry),ctx.lineTo(x+w,y+h-ry),isRounded&&ctx.bezierCurveTo(x+w,y+h-k*ry,x+w-k*rx,y+h,x+w-rx,y+h),ctx.lineTo(x+rx,y+h),isRounded&&ctx.bezierCurveTo(x+k*rx,y+h,x,y+h-k*ry,x,y+h-ry),ctx.lineTo(x,y+ry),isRounded&&ctx.bezierCurveTo(x,y+k*ry,x+k*rx,y,x+rx,y),ctx.closePath(),this._renderFill(ctx),this._renderStroke(ctx)},_renderDashedStroke:function(ctx){var x=-this.width/2,y=-this.height/2,w=this.width,h=this.height;ctx.beginPath(),fabric.util.drawDashedLine(ctx,x,y,x+w,y,this.strokeDashArray),fabric.util.drawDashedLine(ctx,x+w,y,x+w,y+h,this.strokeDashArray),fabric.util.drawDashedLine(ctx,x+w,y+h,x,y+h,this.strokeDashArray),fabric.util.drawDashedLine(ctx,x,y+h,x,y,this.strokeDashArray),ctx.closePath()},toObject:function(propertiesToInclude){var object=extend(this.callSuper("toObject",propertiesToInclude),{rx:this.get("rx")||0,ry:this.get("ry")||0});return this.includeDefaultValues||this._removeDefaultValues(object),object},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),x=this.left,y=this.top;return this.group&&"path-group"===this.group.type||(x=-this.width/2,y=-this.height/2),markup.push("<rect ",'x="',x,'" y="',y,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),reviver?reviver(markup.join("")):markup.join("")},complexity:function(){return 1}}),fabric.Rect.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),fabric.Rect.fromElement=function(element,options){if(!element)return null;options=options||{};var parsedAttributes=fabric.parseAttributes(element,fabric.Rect.ATTRIBUTE_NAMES);parsedAttributes.left=parsedAttributes.left||0,parsedAttributes.top=parsedAttributes.top||0;var rect=new fabric.Rect(extend(options?fabric.util.object.clone(options):{},parsedAttributes));return rect.visible=rect.width>0&&rect.height>0,rect},fabric.Rect.fromObject=function(object){return new fabric.Rect(object)}}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={});return fabric.Polyline?void fabric.warn("fabric.Polyline is already defined"):(fabric.Polyline=fabric.util.createClass(fabric.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(points,options){return fabric.Polygon.prototype.initialize.call(this,points,options)},_calcDimensions:function(){return fabric.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return fabric.Polygon.prototype._applyPointOffset.call(this)},toObject:function(propertiesToInclude){return fabric.Polygon.prototype.toObject.call(this,propertiesToInclude)},toSVG:function(reviver){return fabric.Polygon.prototype.toSVG.call(this,reviver)},_render:function(ctx,noTransform){fabric.Polygon.prototype.commonRender.call(this,ctx,noTransform)&&(this._renderFill(ctx),this._renderStroke(ctx))},_renderDashedStroke:function(ctx){var p1,p2;ctx.beginPath();for(var i=0,len=this.points.length;len>i;i++)p1=this.points[i],p2=this.points[i+1]||p1,fabric.util.drawDashedLine(ctx,p1.x,p1.y,p2.x,p2.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),fabric.Polyline.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(),fabric.Polyline.fromElement=function(element,options){if(!element)return null;options||(options={});var points=fabric.parsePointsAttribute(element.getAttribute("points")),parsedAttributes=fabric.parseAttributes(element,fabric.Polyline.ATTRIBUTE_NAMES);return new fabric.Polyline(points,fabric.util.object.extend(parsedAttributes,options))},void(fabric.Polyline.fromObject=function(object){var points=object.points;return new fabric.Polyline(points,object,!0)}))}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,min=fabric.util.array.min,max=fabric.util.array.max,toFixed=fabric.util.toFixed;return fabric.Polygon?void fabric.warn("fabric.Polygon is already defined"):(fabric.Polygon=fabric.util.createClass(fabric.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(points,options){options=options||{},this.points=points||[],this.callSuper("initialize",options),this._calcDimensions(),"top"in options||(this.top=this.minY),"left"in options||(this.left=this.minX),this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var points=this.points,minX=min(points,"x"),minY=min(points,"y"),maxX=max(points,"x"),maxY=max(points,"y");this.width=maxX-minX||0,this.height=maxY-minY||0,this.minX=minX||0,this.minY=minY||0},toObject:function(propertiesToInclude){return extend(this.callSuper("toObject",propertiesToInclude),{points:this.points.concat()})},toSVG:function(reviver){for(var addTransform,points=[],markup=this._createBaseSVGMarkup(),i=0,len=this.points.length;len>i;i++)points.push(toFixed(this.points[i].x,2),",",toFixed(this.points[i].y,2)," ");return this.group&&"path-group"===this.group.type||(addTransform=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),markup.push("<",this.type," ",'points="',points.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),addTransform," ",this.getSvgTransformMatrix(),'"/>\n'),reviver?reviver(markup.join("")):markup.join("")},_render:function(ctx,noTransform){this.commonRender(ctx,noTransform)&&(this._renderFill(ctx),(this.stroke||this.strokeDashArray)&&(ctx.closePath(),this._renderStroke(ctx)))},commonRender:function(ctx,noTransform){var point,len=this.points.length;if(!len||isNaN(this.points[len-1].y))return!1;noTransform||ctx.translate(-this.pathOffset.x,-this.pathOffset.y),ctx.beginPath(),ctx.moveTo(this.points[0].x,this.points[0].y);for(var i=0;len>i;i++)point=this.points[i],ctx.lineTo(point.x,point.y);return!0},_renderDashedStroke:function(ctx){fabric.Polyline.prototype._renderDashedStroke.call(this,ctx),ctx.closePath()},complexity:function(){return this.points.length}}),fabric.Polygon.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(),fabric.Polygon.fromElement=function(element,options){if(!element)return null;options||(options={});var points=fabric.parsePointsAttribute(element.getAttribute("points")),parsedAttributes=fabric.parseAttributes(element,fabric.Polygon.ATTRIBUTE_NAMES);return new fabric.Polygon(points,extend(parsedAttributes,options))},void(fabric.Polygon.fromObject=function(object){return new fabric.Polygon(object.points,object,!0)}))}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),min=fabric.util.array.min,max=fabric.util.array.max,extend=fabric.util.object.extend,_toString=Object.prototype.toString,drawArc=fabric.util.drawArc,commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},repeatedCommands={m:"l",M:"L"};return fabric.Path?void fabric.warn("fabric.Path is already defined"):(fabric.Path=fabric.util.createClass(fabric.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(path,options){options=options||{},this.setOptions(options),path||(path=[]);var fromArray="[object Array]"===_toString.call(path);this.path=fromArray?path:path.match&&path.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(fromArray||(this.path=this._parsePath()),this._setPositionDimensions(options),options.sourcePath&&this.setSourcePath(options.sourcePath))},_setPositionDimensions:function(options){var calcDim=this._parseDimensions();this.minX=calcDim.left,this.minY=calcDim.top,this.width=calcDim.width,this.height=calcDim.height,"undefined"==typeof options.left&&(this.left=calcDim.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0)),"undefined"==typeof options.top&&(this.top=calcDim.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0)),this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(ctx){var current,tempX,tempY,previous=null,subpathStartX=0,subpathStartY=0,x=0,y=0,controlX=0,controlY=0,l=-this.pathOffset.x,t=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(l=0,t=0),ctx.beginPath();for(var i=0,len=this.path.length;len>i;++i){switch(current=this.path[i],current[0]){case"l":x+=current[1],y+=current[2],ctx.lineTo(x+l,y+t);break;case"L":x=current[1],y=current[2],ctx.lineTo(x+l,y+t);break;case"h":x+=current[1],ctx.lineTo(x+l,y+t);break;case"H":x=current[1],ctx.lineTo(x+l,y+t);break;case"v":y+=current[1],ctx.lineTo(x+l,y+t);break;case"V":y=current[1],ctx.lineTo(x+l,y+t);break;case"m":x+=current[1],y+=current[2],subpathStartX=x,subpathStartY=y,ctx.moveTo(x+l,y+t);break;case"M":x=current[1],y=current[2],subpathStartX=x,subpathStartY=y,ctx.moveTo(x+l,y+t);break;case"c":tempX=x+current[5],tempY=y+current[6],controlX=x+current[3],controlY=y+current[4],ctx.bezierCurveTo(x+current[1]+l,y+current[2]+t,controlX+l,controlY+t,tempX+l,tempY+t),x=tempX,y=tempY;break;case"C":x=current[5],y=current[6],controlX=current[3],controlY=current[4],ctx.bezierCurveTo(current[1]+l,current[2]+t,controlX+l,controlY+t,x+l,y+t);break;case"s":tempX=x+current[3],tempY=y+current[4],null===previous[0].match(/[CcSs]/)?(controlX=x,controlY=y):(controlX=2*x-controlX,controlY=2*y-controlY),ctx.bezierCurveTo(controlX+l,controlY+t,x+current[1]+l,y+current[2]+t,tempX+l,tempY+t),controlX=x+current[1],controlY=y+current[2],x=tempX,y=tempY;break;case"S":tempX=current[3],tempY=current[4],null===previous[0].match(/[CcSs]/)?(controlX=x,controlY=y):(controlX=2*x-controlX,controlY=2*y-controlY),ctx.bezierCurveTo(controlX+l,controlY+t,current[1]+l,current[2]+t,tempX+l,tempY+t),x=tempX,y=tempY,controlX=current[1],controlY=current[2];break;case"q":tempX=x+current[3],tempY=y+current[4],controlX=x+current[1],controlY=y+current[2],ctx.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t),x=tempX,y=tempY;break;case"Q":tempX=current[3],tempY=current[4],ctx.quadraticCurveTo(current[1]+l,current[2]+t,tempX+l,tempY+t),x=tempX,y=tempY,controlX=current[1],controlY=current[2];break;case"t":tempX=x+current[1],tempY=y+current[2],null===previous[0].match(/[QqTt]/)?(controlX=x,controlY=y):(controlX=2*x-controlX,controlY=2*y-controlY),ctx.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t),x=tempX,y=tempY;break;case"T":tempX=current[1],tempY=current[2],null===previous[0].match(/[QqTt]/)?(controlX=x,controlY=y):(controlX=2*x-controlX,controlY=2*y-controlY),ctx.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t),x=tempX,y=tempY;break;case"a":drawArc(ctx,x+l,y+t,[current[1],current[2],current[3],current[4],current[5],current[6]+x+l,current[7]+y+t]),x+=current[6],y+=current[7];break;case"A":drawArc(ctx,x+l,y+t,[current[1],current[2],current[3],current[4],current[5],current[6]+l,current[7]+t]),x=current[6],y=current[7];break;case"z":case"Z":x=subpathStartX,y=subpathStartY,ctx.closePath()}previous=current}this._renderFill(ctx),this._renderStroke(ctx)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(propertiesToInclude){var o=extend(this.callSuper("toObject",propertiesToInclude),{path:this.path.map(function(item){return item.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(o.sourcePath=this.sourcePath),this.transformMatrix&&(o.transformMatrix=this.transformMatrix),o},toDatalessObject:function(propertiesToInclude){var o=this.toObject(propertiesToInclude);return this.sourcePath&&(o.path=this.sourcePath),delete o.sourcePath,o},toSVG:function(reviver){for(var chunks=[],markup=this._createBaseSVGMarkup(),addTransform="",i=0,len=this.path.length;len>i;i++)chunks.push(this.path[i].join(" "));var path=chunks.join(" ");return this.group&&"path-group"===this.group.type||(addTransform=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),markup.push("<path ",'d="',path,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),addTransform,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),reviver?reviver(markup.join("")):markup.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var currentPath,parsed,match,coordsStr,coordsParsed,result=[],coords=[],re=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,i=0,len=this.path.length;len>i;i++){for(currentPath=this.path[i],coordsStr=currentPath.slice(1).trim(),coords.length=0;match=re.exec(coordsStr);)coords.push(match[0]);coordsParsed=[currentPath.charAt(0)];for(var j=0,jlen=coords.length;jlen>j;j++)parsed=parseFloat(coords[j]),isNaN(parsed)||coordsParsed.push(parsed);var command=coordsParsed[0],commandLength=commandLengths[command.toLowerCase()],repeatedCommand=repeatedCommands[command]||command;if(coordsParsed.length-1>commandLength)for(var k=1,klen=coordsParsed.length;klen>k;k+=commandLength)result.push([command].concat(coordsParsed.slice(k,k+commandLength))),command=repeatedCommand;else result.push(coordsParsed)}return result},_parseDimensions:function(){for(var current,tempX,tempY,bounds,aX=[],aY=[],previous=null,subpathStartX=0,subpathStartY=0,x=0,y=0,controlX=0,controlY=0,i=0,len=this.path.length;len>i;++i){switch(current=this.path[i],current[0]){case"l":x+=current[1],y+=current[2],bounds=[];break;case"L":x=current[1],y=current[2],bounds=[];break;case"h":x+=current[1],bounds=[];break;case"H":x=current[1],bounds=[];break;case"v":y+=current[1],bounds=[];break;case"V":y=current[1],bounds=[];break;case"m":x+=current[1],y+=current[2],subpathStartX=x,subpathStartY=y,bounds=[];break;case"M":x=current[1],y=current[2],subpathStartX=x,subpathStartY=y,bounds=[];break;case"c":tempX=x+current[5],tempY=y+current[6],controlX=x+current[3],controlY=y+current[4],bounds=fabric.util.getBoundsOfCurve(x,y,x+current[1],y+current[2],controlX,controlY,tempX,tempY),x=tempX,y=tempY;break;case"C":x=current[5],y=current[6],controlX=current[3],controlY=current[4],bounds=fabric.util.getBoundsOfCurve(x,y,current[1],current[2],controlX,controlY,x,y);break;case"s":tempX=x+current[3],tempY=y+current[4],null===previous[0].match(/[CcSs]/)?(controlX=x,controlY=y):(controlX=2*x-controlX,controlY=2*y-controlY),bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,x+current[1],y+current[2],tempX,tempY),controlX=x+current[1],controlY=y+current[2],x=tempX,y=tempY;break;case"S":tempX=current[3],tempY=current[4],null===previous[0].match(/[CcSs]/)?(controlX=x,controlY=y):(controlX=2*x-controlX,controlY=2*y-controlY),bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,current[1],current[2],tempX,tempY),x=tempX,y=tempY,controlX=current[1],controlY=current[2];break;case"q":tempX=x+current[3],tempY=y+current[4],controlX=x+current[1],controlY=y+current[2],bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,tempX,tempY),x=tempX,y=tempY;break;case"Q":controlX=current[1],controlY=current[2],bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,current[3],current[4]),x=current[3],y=current[4];break;case"t":tempX=x+current[1],tempY=y+current[2],null===previous[0].match(/[QqTt]/)?(controlX=x,controlY=y):(controlX=2*x-controlX,controlY=2*y-controlY),bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,tempX,tempY),x=tempX,y=tempY;break;case"T":tempX=current[1],tempY=current[2],null===previous[0].match(/[QqTt]/)?(controlX=x,controlY=y):(controlX=2*x-controlX,controlY=2*y-controlY),bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,tempX,tempY),x=tempX,y=tempY;break;case"a":bounds=fabric.util.getBoundsOfArc(x,y,current[1],current[2],current[3],current[4],current[5],current[6]+x,current[7]+y),x+=current[6],y+=current[7];break;case"A":bounds=fabric.util.getBoundsOfArc(x,y,current[1],current[2],current[3],current[4],current[5],current[6],current[7]),x=current[6],y=current[7];break;case"z":case"Z":x=subpathStartX,y=subpathStartY}previous=current,bounds.forEach(function(point){aX.push(point.x),aY.push(point.y)}),aX.push(x),aY.push(y)}var minX=min(aX)||0,minY=min(aY)||0,maxX=max(aX)||0,maxY=max(aY)||0,deltaX=maxX-minX,deltaY=maxY-minY,o={left:minX,top:minY,width:deltaX,height:deltaY};return o}}),fabric.Path.fromObject=function(object,callback){"string"==typeof object.path?fabric.loadSVGFromURL(object.path,function(elements){var path=elements[0],pathUrl=object.path;delete object.path,fabric.util.object.extend(path,object),path.setSourcePath(pathUrl),callback(path)}):callback(new fabric.Path(object.path,object))},fabric.Path.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(["d"]),fabric.Path.fromElement=function(element,callback,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Path.ATTRIBUTE_NAMES);callback&&callback(new fabric.Path(parsedAttributes.d,extend(parsedAttributes,options)))},void(fabric.Path.async=!0))}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,invoke=fabric.util.array.invoke,parentToObject=fabric.Object.prototype.toObject;return fabric.PathGroup?void fabric.warn("fabric.PathGroup is already defined"):(fabric.PathGroup=fabric.util.createClass(fabric.Path,{type:"path-group",fill:"",initialize:function(paths,options){options=options||{},this.paths=paths||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;options.toBeParsed&&(this.parseDimensionsFromPaths(options),delete options.toBeParsed),this.setOptions(options),this.setCoords(),options.sourcePath&&this.setSourcePath(options.sourcePath)},parseDimensionsFromPaths:function(options){for(var points,p,path,height,width,m,xC=[],yC=[],j=this.paths.length;j--;){path=this.paths[j],height=path.height+path.strokeWidth,width=path.width+path.strokeWidth,points=[{x:path.left,y:path.top},{x:path.left+width,y:path.top},{x:path.left,y:path.top+height},{x:path.left+width,y:path.top+height}],m=this.paths[j].transformMatrix;for(var i=0;i<points.length;i++)p=points[i],m&&(p=fabric.util.transformPoint(p,m,!1)),xC.push(p.x),yC.push(p.y)}options.width=Math.max.apply(null,xC),options.height=Math.max.apply(null,yC)},render:function(ctx){if(this.visible){ctx.save(),this.transformMatrix&&ctx.transform.apply(ctx,this.transformMatrix),this.transform(ctx),this._setShadow(ctx),this.clipTo&&fabric.util.clipContext(this,ctx),ctx.translate(-this.width/2,-this.height/2);for(var i=0,l=this.paths.length;l>i;++i)this.paths[i].render(ctx,!0);this.clipTo&&ctx.restore(),ctx.restore()}},_set:function(prop,value){if("fill"===prop&&value&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(prop,value);return this.callSuper("_set",prop,value)},toObject:function(propertiesToInclude){var o=extend(parentToObject.call(this,propertiesToInclude),{paths:invoke(this.getObjects(),"toObject",propertiesToInclude)});return this.sourcePath&&(o.sourcePath=this.sourcePath),o},toDatalessObject:function(propertiesToInclude){var o=this.toObject(propertiesToInclude);return this.sourcePath&&(o.paths=this.sourcePath),o},toSVG:function(reviver){var objects=this.getObjects(),p=this.getPointByOrigin("left","top"),translatePart="translate("+p.x+" "+p.y+")",markup=this._createBaseSVGMarkup();markup.push("<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),translatePart,this.getSvgTransform(),'" ',">\n");for(var i=0,len=objects.length;len>i;i++)markup.push("	",objects[i].toSVG(reviver));return markup.push("</g>\n"),reviver?reviver(markup.join("")):markup.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var firstPathFill=this.getObjects()[0].get("fill")||"";return"string"!=typeof firstPathFill?!1:(firstPathFill=firstPathFill.toLowerCase(),this.getObjects().every(function(path){var pathFill=path.get("fill")||"";return"string"==typeof pathFill&&pathFill.toLowerCase()===firstPathFill}))},complexity:function(){return this.paths.reduce(function(total,path){return total+(path&&path.complexity?path.complexity():0)},0)},getObjects:function(){return this.paths}}),fabric.PathGroup.fromObject=function(object,callback){"string"==typeof object.paths?fabric.loadSVGFromURL(object.paths,function(elements){var pathUrl=object.paths;delete object.paths;var pathGroup=fabric.util.groupSVGElements(elements,object,pathUrl);callback(pathGroup)}):fabric.util.enlivenObjects(object.paths,function(enlivenedObjects){delete object.paths,callback(new fabric.PathGroup(enlivenedObjects,object))})},void(fabric.PathGroup.async=!0))}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,min=fabric.util.array.min,max=fabric.util.array.max,invoke=fabric.util.array.invoke;if(!fabric.Group){var _lockProperties={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};fabric.Group=fabric.util.createClass(fabric.Object,fabric.Collection,{type:"group",strokeWidth:0,initialize:function(objects,options,isAlreadyGrouped){options=options||{},this._objects=[],isAlreadyGrouped&&this.callSuper("initialize",options),this._objects=objects||[];for(var i=this._objects.length;i--;)this._objects[i].group=this;this.originalState={},options.originX&&(this.originX=options.originX),options.originY&&(this.originY=options.originY),isAlreadyGrouped?this._updateObjectsCoords(!0):(this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",options)),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(skipCoordsChange){for(var i=this._objects.length;i--;)this._updateObjectCoords(this._objects[i],skipCoordsChange)},_updateObjectCoords:function(object,skipCoordsChange){if(object.__origHasControls=object.hasControls,object.hasControls=!1,!skipCoordsChange){var objectLeft=object.getLeft(),objectTop=object.getTop(),center=this.getCenterPoint();object.set({originalLeft:objectLeft,originalTop:objectTop,left:objectLeft-center.x,top:objectTop-center.y}),object.setCoords()}},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(object){return this._restoreObjectsState(),fabric.util.resetObjectTransform(this),object&&(this._objects.push(object),object.group=this,object._set("canvas",this.canvas)),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(object){object.set("active",!0),object.group=this},removeWithUpdate:function(object){return this._restoreObjectsState(),fabric.util.resetObjectTransform(this),this.forEachObject(this._setObjectActive,this),this.remove(object),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(object){object.group=this,object._set("canvas",this.canvas)},_onObjectRemoved:function(object){delete object.group,object.set("active",!1)},delegatedProperties:{fill:!0,stroke:!0,strokeWidth:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(key,value){var i=this._objects.length;if(this.delegatedProperties[key]||"canvas"===key)for(;i--;)this._objects[i].set(key,value);else for(;i--;)this._objects[i].setOnGroup(key,value);this.callSuper("_set",key,value)},toObject:function(propertiesToInclude){return extend(this.callSuper("toObject",propertiesToInclude),{objects:invoke(this._objects,"toObject",propertiesToInclude)})},render:function(ctx){if(this.visible){ctx.save(),this.transformMatrix&&ctx.transform.apply(ctx,this.transformMatrix),this.transform(ctx),this._setShadow(ctx),this.clipTo&&fabric.util.clipContext(this,ctx);for(var i=0,len=this._objects.length;len>i;i++)this._renderObject(this._objects[i],ctx);this.clipTo&&ctx.restore(),ctx.restore()}},_renderControls:function(ctx,noTransform){this.callSuper("_renderControls",ctx,noTransform);for(var i=0,len=this._objects.length;len>i;i++)this._objects[i]._renderControls(ctx)},_renderObject:function(object,ctx){if(object.visible){var originalHasRotatingPoint=object.hasRotatingPoint;object.hasRotatingPoint=!1,object.render(ctx),object.hasRotatingPoint=originalHasRotatingPoint}},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(object){var matrix=object.calcTransformMatrix(),options=fabric.util.qrDecompose(matrix),center=new fabric.Point(options.translateX,options.translateY);return object.scaleX=options.scaleX,object.scaleY=options.scaleY,object.skewX=options.skewX,object.skewY=options.skewY,object.angle=options.angle,object.flipX=!1,object.flipY=!1,object.setPositionByOrigin(center,"center","center"),object},_restoreObjectState:function(object){return this.realizeTransform(object),object.setCoords(),object.hasControls=object.__origHasControls,delete object.__origHasControls,object.set("active",!1),delete object.group,this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(object){object.setCoords()}),this},_calcBounds:function(onlyWidthHeight){for(var o,prop,j,aX=[],aY=[],props=["tr","br","bl","tl"],i=0,iLen=this._objects.length,jLen=props.length;iLen>i;++i)for(o=this._objects[i],o.setCoords(),j=0;jLen>j;j++)prop=props[j],aX.push(o.oCoords[prop].x),aY.push(o.oCoords[prop].y);this.set(this._getBounds(aX,aY,onlyWidthHeight))},_getBounds:function(aX,aY,onlyWidthHeight){var ivt=fabric.util.invertTransform(this.getViewportTransform()),minXY=fabric.util.transformPoint(new fabric.Point(min(aX),min(aY)),ivt),maxXY=fabric.util.transformPoint(new fabric.Point(max(aX),max(aY)),ivt),obj={width:maxXY.x-minXY.x||0,height:maxXY.y-minXY.y||0};return onlyWidthHeight||(obj.left=minXY.x||0,obj.top=minXY.y||0,"center"===this.originX&&(obj.left+=obj.width/2),"right"===this.originX&&(obj.left+=obj.width),"center"===this.originY&&(obj.top+=obj.height/2),"bottom"===this.originY&&(obj.top+=obj.height)),obj},toSVG:function(reviver){var markup=this._createBaseSVGMarkup();markup.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var i=0,len=this._objects.length;len>i;i++)markup.push("	",this._objects[i].toSVG(reviver));return markup.push("</g>\n"),reviver?reviver(markup.join("")):markup.join("")},get:function(prop){if(prop in _lockProperties){if(this[prop])return this[prop];for(var i=0,len=this._objects.length;len>i;i++)if(this._objects[i][prop])return!0;return!1}return prop in this.delegatedProperties?this._objects[0]&&this._objects[0].get(prop):this[prop]}}),fabric.Group.fromObject=function(object,callback){fabric.util.enlivenObjects(object.objects,function(enlivenedObjects){delete object.objects,callback&&callback(new fabric.Group(enlivenedObjects,object,!0))})},fabric.Group.async=!0}}(exports),function(global){"use strict";var extend=fabric.util.object.extend;return global.fabric||(global.fabric={}),global.fabric.Image?void fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,initialize:function(element,options){options||(options={}),this.filters=[],this.resizeFilters=[],this.callSuper("initialize",options),this._initElement(element,options)},getElement:function(){return this._element},setElement:function(element,callback,options){return this._element=element,this._originalElement=element,this._initConfig(options),0!==this.filters.length?this.applyFilters(callback):callback&&callback(),this},setCrossOrigin:function(value){return this.crossOrigin=value,this._element.crossOrigin=value,this},getOriginalSize:function(){var element=this.getElement();return{width:element.width,height:element.height}},_stroke:function(ctx){if(this.stroke&&0!==this.strokeWidth){var w=this.width/2,h=this.height/2;ctx.beginPath(),ctx.moveTo(-w,-h),ctx.lineTo(w,-h),ctx.lineTo(w,h),ctx.lineTo(-w,h),ctx.lineTo(-w,-h),ctx.closePath()}},_renderDashedStroke:function(ctx){var x=-this.width/2,y=-this.height/2,w=this.width,h=this.height;ctx.save(),this._setStrokeStyles(ctx),ctx.beginPath(),fabric.util.drawDashedLine(ctx,x,y,x+w,y,this.strokeDashArray),fabric.util.drawDashedLine(ctx,x+w,y,x+w,y+h,this.strokeDashArray),fabric.util.drawDashedLine(ctx,x+w,y+h,x,y+h,this.strokeDashArray),fabric.util.drawDashedLine(ctx,x,y+h,x,y,this.strokeDashArray),ctx.closePath(),ctx.restore()},toObject:function(propertiesToInclude){var filters=[],resizeFilters=[],element=this._originalElement,scaleX=1,scaleY=1;this.filters.forEach(function(filterObj){filterObj&&("Resize"===filterObj.type&&(scaleX*=filterObj.scaleX,scaleY*=filterObj.scaleY),filters.push(filterObj.toObject()))}),this.resizeFilters.forEach(function(filterObj){filterObj&&resizeFilters.push(filterObj.toObject())});var object=extend(this.callSuper("toObject",propertiesToInclude),{src:element?element.src||element._src:"",filters:filters,resizeFilters:resizeFilters,crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice});return object.width/=scaleX,object.height/=scaleY,this.includeDefaultValues||this._removeDefaultValues(object),object},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),x=-this.width/2,y=-this.height/2,preserveAspectRatio="none";if(this.group&&"path-group"===this.group.type&&(x=this.left,y=this.top),"none"!==this.alignX&&"none"!==this.alignY&&(preserveAspectRatio="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),markup.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',x,'" y="',y,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',preserveAspectRatio,'"',"></image>\n"),this.stroke||this.strokeDashArray){var origFill=this.fill;this.fill=null,markup.push("<rect ",'x="',x,'" y="',y,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=origFill}return markup.push("</g>\n"),reviver?reviver(markup.join("")):markup.join("")},getSrc:function(){return this.getElement()?this.getElement().src||this.getElement()._src:void 0},setSrc:function(src,callback,options){fabric.util.loadImage(src,function(img){return this.setElement(img,callback,options)},this,options&&options.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(callback,propertiesToInclude){this.constructor.fromObject(this.toObject(propertiesToInclude),callback)},applyFilters:function(callback,filters,imgElement,forResizing){if(filters=filters||this.filters,imgElement=imgElement||this._originalElement){var imgEl=imgElement,canvasEl=fabric.util.createCanvasElement(),replacement=fabric.util.createImage(),_this=this;return canvasEl.width=imgEl.width,canvasEl.height=imgEl.height,canvasEl.getContext("2d").drawImage(imgEl,0,0,imgEl.width,imgEl.height),0===filters.length?(this._element=imgElement,callback&&callback(),canvasEl):(filters.forEach(function(filter){filter&&filter.applyTo(canvasEl,filter.scaleX||_this.scaleX,filter.scaleY||_this.scaleY),!forResizing&&filter&&"Resize"===filter.type&&(_this.width*=filter.scaleX,_this.height*=filter.scaleY)}),replacement.width=canvasEl.width,replacement.height=canvasEl.height,fabric.isLikelyNode?(replacement.src=canvasEl.toBuffer(void 0,fabric.Image.pngCompression),
_this._element=replacement,!forResizing&&(_this._filteredEl=replacement),callback&&callback()):(replacement.onload=function(){_this._element=replacement,!forResizing&&(_this._filteredEl=replacement),callback&&callback(),replacement.onload=canvasEl=imgEl=null},replacement.src=canvasEl.toDataURL("image/png")),canvasEl)}},_render:function(ctx,noTransform){var x,y,elementToDraw,imageMargins=this._findMargins();x=noTransform?this.left:-this.width/2,y=noTransform?this.top:-this.height/2,"slice"===this.meetOrSlice&&(ctx.beginPath(),ctx.rect(x,y,this.width,this.height),ctx.clip()),this.isMoving===!1&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,elementToDraw=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):elementToDraw=this._element,elementToDraw&&ctx.drawImage(elementToDraw,x+imageMargins.marginX,y+imageMargins.marginY,imageMargins.width,imageMargins.height),this._stroke(ctx),this._renderStroke(ctx)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var scales,scale,width=this.width,height=this.height,marginX=0,marginY=0;return"none"===this.alignX&&"none"===this.alignY||(scales=[this.width/this._element.width,this.height/this._element.height],scale="meet"===this.meetOrSlice?Math.min.apply(null,scales):Math.max.apply(null,scales),width=this._element.width*scale,height=this._element.height*scale,"Mid"===this.alignX&&(marginX=(this.width-width)/2),"Max"===this.alignX&&(marginX=this.width-width),"Mid"===this.alignY&&(marginY=(this.height-height)/2),"Max"===this.alignY&&(marginY=this.height-height)),{width:width,height:height,marginX:marginX,marginY:marginY}},_resetWidthHeight:function(){var element=this.getElement();this.set("width",element.width),this.set("height",element.height)},_initElement:function(element,options){this.setElement(fabric.util.getById(element),null,options),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(options){options||(options={}),this.setOptions(options),this._setWidthHeight(options),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(filters,callback){filters&&filters.length?fabric.util.enlivenObjects(filters,function(enlivenedObjects){callback&&callback(enlivenedObjects)},"fabric.Image.filters"):callback&&callback()},_setWidthHeight:function(options){this.width="width"in options?options.width:this.getElement()?this.getElement().width||0:0,this.height="height"in options?options.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(object,callback){fabric.util.loadImage(object.src,function(img){fabric.Image.prototype._initFilters.call(object,object.filters,function(filters){object.filters=filters||[],fabric.Image.prototype._initFilters.call(object,object.resizeFilters,function(resizeFilters){object.resizeFilters=resizeFilters||[];var instance=new fabric.Image(img,object);callback&&callback(instance)})})},null,object.crossOrigin)},fabric.Image.fromURL=function(url,callback,imgOptions){fabric.util.loadImage(url,function(img){callback&&callback(new fabric.Image(img,imgOptions))},null,imgOptions&&imgOptions.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),fabric.Image.fromElement=function(element,callback,options){var preserveAR,parsedAttributes=fabric.parseAttributes(element,fabric.Image.ATTRIBUTE_NAMES);parsedAttributes.preserveAspectRatio&&(preserveAR=fabric.util.parsePreserveAspectRatioAttribute(parsedAttributes.preserveAspectRatio),extend(parsedAttributes,preserveAR)),fabric.Image.fromURL(parsedAttributes["xlink:href"],callback,extend(options?fabric.util.object.clone(options):{},parsedAttributes))},fabric.Image.async=!0,void(fabric.Image.pngCompression=1))}(exports),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var angle=this.getAngle()%360;return angle>0?90*Math.round((angle-1)/90):90*Math.round(angle/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(value){_this.setAngle(value),onChange()},onComplete:function(){_this.setCoords(),onComplete()},onStart:function(){_this.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(object){return object.straighten(),this.renderAll(),this},fxStraightenObject:function(object){return object.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(options){options&&this.setOptions(options)},setOptions:function(options){for(var prop in options)this[prop]=options[prop]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Brightness=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Brightness",initialize:function(options){options=options||{},this.brightness=options.brightness||0},applyTo:function(canvasEl){for(var context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,brightness=this.brightness,i=0,len=data.length;len>i;i+=4)data[i]+=brightness,data[i+1]+=brightness,data[i+2]+=brightness;context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper("toObject"),{brightness:this.brightness})}}),fabric.Image.filters.Brightness.fromObject=function(object){return new fabric.Image.filters.Brightness(object)}}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Convolute=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Convolute",initialize:function(options){options=options||{},this.opaque=options.opaque,this.matrix=options.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(canvasEl){for(var r,g,b,a,dstOff,scx,scy,srcOff,wt,weights=this.matrix,context=canvasEl.getContext("2d"),pixels=context.getImageData(0,0,canvasEl.width,canvasEl.height),side=Math.round(Math.sqrt(weights.length)),halfSide=Math.floor(side/2),src=pixels.data,sw=pixels.width,sh=pixels.height,output=context.createImageData(sw,sh),dst=output.data,alphaFac=this.opaque?1:0,y=0;sh>y;y++)for(var x=0;sw>x;x++){dstOff=4*(y*sw+x),r=0,g=0,b=0,a=0;for(var cy=0;side>cy;cy++)for(var cx=0;side>cx;cx++)scy=y+cy-halfSide,scx=x+cx-halfSide,0>scy||scy>sh||0>scx||scx>sw||(srcOff=4*(scy*sw+scx),wt=weights[cy*side+cx],r+=src[srcOff]*wt,g+=src[srcOff+1]*wt,b+=src[srcOff+2]*wt,a+=src[srcOff+3]*wt);dst[dstOff]=r,dst[dstOff+1]=g,dst[dstOff+2]=b,dst[dstOff+3]=a+alphaFac*(255-a)}context.putImageData(output,0,0)},toObject:function(){return extend(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),fabric.Image.filters.Convolute.fromObject=function(object){return new fabric.Image.filters.Convolute(object)}}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.GradientTransparency=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(options){options=options||{},this.threshold=options.threshold||100},applyTo:function(canvasEl){for(var context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,threshold=this.threshold,total=data.length,i=0,len=data.length;len>i;i+=4)data[i+3]=threshold+255*(total-i)/total;context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper("toObject"),{threshold:this.threshold})}}),fabric.Image.filters.GradientTransparency.fromObject=function(object){return new fabric.Image.filters.GradientTransparency(object)}}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Grayscale=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(canvasEl){for(var average,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,len=imageData.width*imageData.height*4,index=0;len>index;)average=(data[index]+data[index+1]+data[index+2])/3,data[index]=average,data[index+1]=average,data[index+2]=average,index+=4;context.putImageData(imageData,0,0)}}),fabric.Image.filters.Grayscale.fromObject=function(){return new fabric.Image.filters.Grayscale}}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Invert=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Invert",applyTo:function(canvasEl){var i,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length;for(i=0;iLen>i;i+=4)data[i]=255-data[i],data[i+1]=255-data[i+1],data[i+2]=255-data[i+2];context.putImageData(imageData,0,0)}}),fabric.Image.filters.Invert.fromObject=function(){return new fabric.Image.filters.Invert}}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Mask=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Mask",initialize:function(options){options=options||{},this.mask=options.mask,this.channel=[0,1,2,3].indexOf(options.channel)>-1?options.channel:0},applyTo:function(canvasEl){if(this.mask){var i,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,maskEl=this.mask.getElement(),maskCanvasEl=fabric.util.createCanvasElement(),channel=this.channel,iLen=imageData.width*imageData.height*4;maskCanvasEl.width=canvasEl.width,maskCanvasEl.height=canvasEl.height,maskCanvasEl.getContext("2d").drawImage(maskEl,0,0,canvasEl.width,canvasEl.height);var maskImageData=maskCanvasEl.getContext("2d").getImageData(0,0,canvasEl.width,canvasEl.height),maskData=maskImageData.data;for(i=0;iLen>i;i+=4)data[i+3]=maskData[i+channel];context.putImageData(imageData,0,0)}},toObject:function(){return extend(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),fabric.Image.filters.Mask.fromObject=function(object,callback){fabric.util.loadImage(object.mask.src,function(img){object.mask=new fabric.Image(img,object.mask),callback&&callback(new fabric.Image.filters.Mask(object))})},fabric.Image.filters.Mask.async=!0}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Noise=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Noise",initialize:function(options){options=options||{},this.noise=options.noise||0},applyTo:function(canvasEl){for(var rand,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,noise=this.noise,i=0,len=data.length;len>i;i+=4)rand=(.5-Math.random())*noise,data[i]+=rand,data[i+1]+=rand,data[i+2]+=rand;context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper("toObject"),{noise:this.noise})}}),fabric.Image.filters.Noise.fromObject=function(object){return new fabric.Image.filters.Noise(object)}}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Pixelate=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(options){options=options||{},this.blocksize=options.blocksize||4},applyTo:function(canvasEl){var index,i,j,r,g,b,a,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=imageData.height,jLen=imageData.width;for(i=0;iLen>i;i+=this.blocksize)for(j=0;jLen>j;j+=this.blocksize){index=4*i*jLen+4*j,r=data[index],g=data[index+1],b=data[index+2],a=data[index+3];for(var _i=i,_ilen=i+this.blocksize;_ilen>_i;_i++)for(var _j=j,_jlen=j+this.blocksize;_jlen>_j;_j++)index=4*_i*jLen+4*_j,data[index]=r,data[index+1]=g,data[index+2]=b,data[index+3]=a}context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper("toObject"),{blocksize:this.blocksize})}}),fabric.Image.filters.Pixelate.fromObject=function(object){return new fabric.Image.filters.Pixelate(object)}}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.RemoveWhite=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(options){options=options||{},this.threshold=options.threshold||30,this.distance=options.distance||20},applyTo:function(canvasEl){for(var r,g,b,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,threshold=this.threshold,distance=this.distance,limit=255-threshold,abs=Math.abs,i=0,len=data.length;len>i;i+=4)r=data[i],g=data[i+1],b=data[i+2],r>limit&&g>limit&&b>limit&&abs(r-g)<distance&&abs(r-b)<distance&&abs(g-b)<distance&&(data[i+3]=0);context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),fabric.Image.filters.RemoveWhite.fromObject=function(object){return new fabric.Image.filters.RemoveWhite(object)}}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Sepia=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(canvasEl){var i,avg,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length;for(i=0;iLen>i;i+=4)avg=.3*data[i]+.59*data[i+1]+.11*data[i+2],data[i]=avg+100,data[i+1]=avg+50,data[i+2]=avg+255;context.putImageData(imageData,0,0)}}),fabric.Image.filters.Sepia.fromObject=function(){return new fabric.Image.filters.Sepia}}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Sepia2=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(canvasEl){var i,r,g,b,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length;for(i=0;iLen>i;i+=4)r=data[i],g=data[i+1],b=data[i+2],data[i]=(.393*r+.769*g+.189*b)/1.351,data[i+1]=(.349*r+.686*g+.168*b)/1.203,data[i+2]=(.272*r+.534*g+.131*b)/2.14;context.putImageData(imageData,0,0)}}),fabric.Image.filters.Sepia2.fromObject=function(){return new fabric.Image.filters.Sepia2}}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Tint=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Tint",initialize:function(options){options=options||{},this.color=options.color||"#000000",this.opacity="undefined"!=typeof options.opacity?options.opacity:new fabric.Color(this.color).getAlpha()},applyTo:function(canvasEl){var i,tintR,tintG,tintB,r,g,b,alpha1,source,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length;for(source=new fabric.Color(this.color).getSource(),tintR=source[0]*this.opacity,tintG=source[1]*this.opacity,tintB=source[2]*this.opacity,alpha1=1-this.opacity,i=0;iLen>i;i+=4)r=data[i],g=data[i+1],b=data[i+2],data[i]=tintR+r*alpha1,data[i+1]=tintG+g*alpha1,data[i+2]=tintB+b*alpha1;context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),fabric.Image.filters.Tint.fromObject=function(object){return new fabric.Image.filters.Tint(object)}}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Multiply=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Multiply",initialize:function(options){options=options||{},this.color=options.color||"#000000"},applyTo:function(canvasEl){var i,source,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length;for(source=new fabric.Color(this.color).getSource(),i=0;iLen>i;i+=4)data[i]*=source[0]/255,data[i+1]*=source[1]/255,data[i+2]*=source[2]/255;context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper("toObject"),{color:this.color})}}),fabric.Image.filters.Multiply.fromObject=function(object){return new fabric.Image.filters.Multiply(object)}}(exports),function(global){"use strict";var fabric=global.fabric;fabric.Image.filters.Blend=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Blend",initialize:function(options){options=options||{},this.color=options.color||"#000",this.image=options.image||!1,this.mode=options.mode||"multiply",this.alpha=options.alpha||1},applyTo:function(canvasEl){var tr,tg,tb,r,g,b,_r,_g,_b,source,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,isImage=!1;if(this.image){isImage=!0;var _el=fabric.util.createCanvasElement();_el.width=this.image.width,_el.height=this.image.height;var tmpCanvas=new fabric.StaticCanvas(_el);tmpCanvas.add(this.image);var context2=tmpCanvas.getContext("2d");source=context2.getImageData(0,0,tmpCanvas.width,tmpCanvas.height).data}else source=new fabric.Color(this.color).getSource(),tr=source[0]*this.alpha,tg=source[1]*this.alpha,tb=source[2]*this.alpha;for(var i=0,len=data.length;len>i;i+=4)switch(r=data[i],g=data[i+1],b=data[i+2],isImage&&(tr=source[i]*this.alpha,tg=source[i+1]*this.alpha,tb=source[i+2]*this.alpha),this.mode){case"multiply":data[i]=r*tr/255,data[i+1]=g*tg/255,data[i+2]=b*tb/255;break;case"screen":data[i]=1-(1-r)*(1-tr),data[i+1]=1-(1-g)*(1-tg),data[i+2]=1-(1-b)*(1-tb);break;case"add":data[i]=Math.min(255,r+tr),data[i+1]=Math.min(255,g+tg),data[i+2]=Math.min(255,b+tb);break;case"diff":case"difference":data[i]=Math.abs(r-tr),data[i+1]=Math.abs(g-tg),data[i+2]=Math.abs(b-tb);break;case"subtract":_r=r-tr,_g=g-tg,_b=b-tb,data[i]=0>_r?0:_r,data[i+1]=0>_g?0:_g,data[i+2]=0>_b?0:_b;break;case"darken":data[i]=Math.min(r,tr),data[i+1]=Math.min(g,tg),data[i+2]=Math.min(b,tb);break;case"lighten":data[i]=Math.max(r,tr),data[i+1]=Math.max(g,tg),data[i+2]=Math.max(b,tb)}context.putImageData(imageData,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}}),fabric.Image.filters.Blend.fromObject=function(object){return new fabric.Image.filters.Blend(object)}}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),pow=Math.pow,floor=Math.floor,sqrt=Math.sqrt,abs=Math.abs,max=Math.max,round=Math.round,sin=Math.sin,ceil=Math.ceil;fabric.Image.filters.Resize=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(canvasEl,scaleX,scaleY){this.rcpScaleX=1/scaleX,this.rcpScaleY=1/scaleY;var imageData,oW=canvasEl.width,oH=canvasEl.height,dW=round(oW*scaleX),dH=round(oH*scaleY);"sliceHack"===this.resizeType&&(imageData=this.sliceByTwo(canvasEl,oW,oH,dW,dH)),"hermite"===this.resizeType&&(imageData=this.hermiteFastResize(canvasEl,oW,oH,dW,dH)),"bilinear"===this.resizeType&&(imageData=this.bilinearFiltering(canvasEl,oW,oH,dW,dH)),"lanczos"===this.resizeType&&(imageData=this.lanczosResize(canvasEl,oW,oH,dW,dH)),canvasEl.width=dW,canvasEl.height=dH,canvasEl.getContext("2d").putImageData(imageData,0,0)},sliceByTwo:function(canvasEl,width,height,newWidth,newHeight){var imageData,context=canvasEl.getContext("2d"),multW=.5,multH=.5,signW=1,signH=1,doneW=!1,doneH=!1,stepW=width,stepH=height,tmpCanvas=fabric.util.createCanvasElement(),tmpCtx=tmpCanvas.getContext("2d");for(newWidth=floor(newWidth),newHeight=floor(newHeight),tmpCanvas.width=max(newWidth,width),tmpCanvas.height=max(newHeight,height),newWidth>width&&(multW=2,signW=-1),newHeight>height&&(multH=2,signH=-1),imageData=context.getImageData(0,0,width,height),canvasEl.width=max(newWidth,width),canvasEl.height=max(newHeight,height),context.putImageData(imageData,0,0);!doneW||!doneH;)width=stepW,height=stepH,newWidth*signW<floor(stepW*multW*signW)?stepW=floor(stepW*multW):(stepW=newWidth,doneW=!0),newHeight*signH<floor(stepH*multH*signH)?stepH=floor(stepH*multH):(stepH=newHeight,doneH=!0),imageData=context.getImageData(0,0,width,height),tmpCtx.putImageData(imageData,0,0),context.clearRect(0,0,stepW,stepH),context.drawImage(tmpCanvas,0,0,width,height,0,0,stepW,stepH);return context.getImageData(0,0,newWidth,newHeight)},lanczosResize:function(canvasEl,oW,oH,dW,dH){function lanczosCreate(lobes){return function(x){if(x>lobes)return 0;if(x*=Math.PI,abs(x)<1e-16)return 1;var xx=x/lobes;return sin(x)*sin(xx)/x/xx}}function process(u){var v,i,weight,idx,a,red,green,blue,alpha,fX,fY;for(center.x=(u+.5)*ratioX,icenter.x=floor(center.x),v=0;dH>v;v++){for(center.y=(v+.5)*ratioY,icenter.y=floor(center.y),a=0,red=0,green=0,blue=0,alpha=0,i=icenter.x-range2X;i<=icenter.x+range2X;i++)if(!(0>i||i>=oW)){fX=floor(1e3*abs(i-center.x)),cacheLanc[fX]||(cacheLanc[fX]={});for(var j=icenter.y-range2Y;j<=icenter.y+range2Y;j++)0>j||j>=oH||(fY=floor(1e3*abs(j-center.y)),cacheLanc[fX][fY]||(cacheLanc[fX][fY]=lanczos(sqrt(pow(fX*rcpRatioX,2)+pow(fY*rcpRatioY,2))/1e3)),weight=cacheLanc[fX][fY],weight>0&&(idx=4*(j*oW+i),a+=weight,red+=weight*srcData[idx],green+=weight*srcData[idx+1],blue+=weight*srcData[idx+2],alpha+=weight*srcData[idx+3]))}idx=4*(v*dW+u),destData[idx]=red/a,destData[idx+1]=green/a,destData[idx+2]=blue/a,destData[idx+3]=alpha/a}return++u<dW?process(u):destImg}var context=canvasEl.getContext("2d"),srcImg=context.getImageData(0,0,oW,oH),destImg=context.getImageData(0,0,dW,dH),srcData=srcImg.data,destData=destImg.data,lanczos=lanczosCreate(this.lanczosLobes),ratioX=this.rcpScaleX,ratioY=this.rcpScaleY,rcpRatioX=2/this.rcpScaleX,rcpRatioY=2/this.rcpScaleY,range2X=ceil(ratioX*this.lanczosLobes/2),range2Y=ceil(ratioY*this.lanczosLobes/2),cacheLanc={},center={},icenter={};return process(0)},bilinearFiltering:function(canvasEl,w,h,w2,h2){var a,b,c,d,x,y,i,j,xDiff,yDiff,chnl,color,origPix,offset=0,ratioX=this.rcpScaleX,ratioY=this.rcpScaleY,context=canvasEl.getContext("2d"),w4=4*(w-1),img=context.getImageData(0,0,w,h),pixels=img.data,destImage=context.getImageData(0,0,w2,h2),destPixels=destImage.data;for(i=0;h2>i;i++)for(j=0;w2>j;j++)for(x=floor(ratioX*j),y=floor(ratioY*i),xDiff=ratioX*j-x,yDiff=ratioY*i-y,origPix=4*(y*w+x),chnl=0;4>chnl;chnl++)a=pixels[origPix+chnl],b=pixels[origPix+4+chnl],c=pixels[origPix+w4+chnl],d=pixels[origPix+w4+4+chnl],color=a*(1-xDiff)*(1-yDiff)+b*xDiff*(1-yDiff)+c*yDiff*(1-xDiff)+d*xDiff*yDiff,destPixels[offset++]=color;return destImage},hermiteFastResize:function(canvasEl,oW,oH,dW,dH){for(var ratioW=this.rcpScaleX,ratioH=this.rcpScaleY,ratioWHalf=ceil(ratioW/2),ratioHHalf=ceil(ratioH/2),context=canvasEl.getContext("2d"),img=context.getImageData(0,0,oW,oH),data=img.data,img2=context.getImageData(0,0,dW,dH),data2=img2.data,j=0;dH>j;j++)for(var i=0;dW>i;i++){for(var x2=4*(i+j*dW),weight=0,weights=0,weightsAlpha=0,gxR=0,gxG=0,gxB=0,gxA=0,centerY=(j+.5)*ratioH,yy=floor(j*ratioH);(j+1)*ratioH>yy;yy++)for(var dy=abs(centerY-(yy+.5))/ratioHHalf,centerX=(i+.5)*ratioW,w0=dy*dy,xx=floor(i*ratioW);(i+1)*ratioW>xx;xx++){var dx=abs(centerX-(xx+.5))/ratioWHalf,w=sqrt(w0+dx*dx);w>1&&-1>w||(weight=2*w*w*w-3*w*w+1,weight>0&&(dx=4*(xx+yy*oW),gxA+=weight*data[dx+3],weightsAlpha+=weight,data[dx+3]<255&&(weight=weight*data[dx+3]/250),gxR+=weight*data[dx],gxG+=weight*data[dx+1],gxB+=weight*data[dx+2],weights+=weight))}data2[x2]=gxR/weights,data2[x2+1]=gxG/weights,data2[x2+2]=gxB/weights,data2[x2+3]=gxA/weightsAlpha}return img2},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),fabric.Image.filters.Resize.fromObject=function(object){return new fabric.Image.filters.Resize(object)}}(exports),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,clone=fabric.util.object.clone,toFixed=fabric.util.toFixed,supportsLineDash=fabric.StaticCanvas.supports("setLineDash"),NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;if(fabric.Text)return void fabric.warn("fabric.Text is already defined");var stateProperties=fabric.Object.prototype.stateProperties.concat();stateProperties.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),fabric.Text=fabric.util.createClass(fabric.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0,textAlign:!0},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:stateProperties,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(text,options){options=options||{},this.text=text,this.__skipDimension=!0,this.setOptions(options),this.__skipDimension=!1,this._initDimensions()},_initDimensions:function(ctx){this.__skipDimension||(ctx||(ctx=fabric.util.createCanvasElement().getContext("2d"),this._setTextStyles(ctx)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this.width=this._getTextWidth(ctx),this.height=this._getTextHeight(ctx))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(ctx){this.clipTo&&fabric.util.clipContext(this,ctx),this._setOpacity(ctx),this._setShadow(ctx),this._setupCompositeOperation(ctx),this._renderTextBackground(ctx),this._setStrokeStyles(ctx),this._setFillStyles(ctx),this._renderText(ctx),this._renderTextDecoration(ctx),this.clipTo&&ctx.restore()},_renderText:function(ctx){this._translateForTextAlign(ctx),this._renderTextFill(ctx),this._renderTextStroke(ctx),this._translateForTextAlign(ctx,!0)},_translateForTextAlign:function(ctx,back){if("left"!==this.textAlign&&"justify"!==this.textAlign){var sign=back?-1:1;ctx.translate("center"===this.textAlign?sign*this.width/2:sign*this.width,0)}},_setTextStyles:function(ctx){ctx.textBaseline="alphabetic",this.skipTextAlign||(ctx.textAlign=this.textAlign),ctx.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(ctx){for(var maxWidth=this._getLineWidth(ctx,0),i=1,len=this._textLines.length;len>i;i++){var currentLineWidth=this._getLineWidth(ctx,i);currentLineWidth>maxWidth&&(maxWidth=currentLineWidth)}return maxWidth},_renderChars:function(method,ctx,chars,left,top){var shortM=method.slice(0,-4);if(this[shortM].toLive){var offsetX=-this.width/2+this[shortM].offsetX||0,offsetY=-this.height/2+this[shortM].offsetY||0;ctx.save(),ctx.translate(offsetX,offsetY),left-=offsetX,top-=offsetY}ctx[method](chars,left,top),this[shortM].toLive&&ctx.restore()},_renderTextLine:function(method,ctx,line,left,top,lineIndex){top-=this.fontSize*this._fontSizeFraction;var lineWidth=this._getLineWidth(ctx,lineIndex);if("justify"!==this.textAlign||this.width<lineWidth)return void this._renderChars(method,ctx,line,left,top,lineIndex);for(var word,words=line.split(/\s+/),charOffset=0,wordsWidth=this._getWidthOfWords(ctx,line,lineIndex,0),widthDiff=this.width-wordsWidth,numSpaces=words.length-1,spaceWidth=numSpaces>0?widthDiff/numSpaces:0,leftOffset=0,i=0,len=words.length;len>i;i++){for(;" "===line[charOffset]&&charOffset<line.length;)charOffset++;word=words[i],this._renderChars(method,ctx,word,left+leftOffset,top,lineIndex,charOffset),leftOffset+=this._getWidthOfWords(ctx,word,lineIndex,charOffset)+spaceWidth,charOffset+=word.length}},_getWidthOfWords:function(ctx,line){return ctx.measureText(line.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},isEmptyStyles:function(){return!0},_renderTextFill:function(ctx){if(this.fill||!this.isEmptyStyles())for(var lineHeights=0,i=0,len=this._textLines.length;len>i;i++){var heightOfLine=this._getHeightOfLine(ctx,i),maxHeight=heightOfLine/this.lineHeight;this._renderTextLine("fillText",ctx,this._textLines[i],this._getLeftOffset(),this._getTopOffset()+lineHeights+maxHeight,i),lineHeights+=heightOfLine}},_renderTextStroke:function(ctx){if(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles()){var lineHeights=0;this.shadow&&!this.shadow.affectStroke&&this._removeShadow(ctx),ctx.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),supportsLineDash&&ctx.setLineDash(this.strokeDashArray)),ctx.beginPath();for(var i=0,len=this._textLines.length;len>i;i++){var heightOfLine=this._getHeightOfLine(ctx,i),maxHeight=heightOfLine/this.lineHeight;this._renderTextLine("strokeText",ctx,this._textLines[i],this._getLeftOffset(),this._getTopOffset()+lineHeights+maxHeight,i),lineHeights+=heightOfLine}ctx.closePath(),ctx.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(ctx){this._renderTextBoxBackground(ctx),this._renderTextLinesBackground(ctx)},_renderTextBoxBackground:function(ctx){this.backgroundColor&&(ctx.fillStyle=this.backgroundColor,ctx.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),this._removeShadow(ctx))},_renderTextLinesBackground:function(ctx){if(this.textBackgroundColor){var heightOfLine,lineWidth,lineLeftOffset,lineTopOffset=0;ctx.fillStyle=this.textBackgroundColor;for(var i=0,len=this._textLines.length;len>i;i++)heightOfLine=this._getHeightOfLine(ctx,i),lineWidth=this._getLineWidth(ctx,i),lineWidth>0&&(lineLeftOffset=this._getLineLeftOffset(lineWidth),ctx.fillRect(this._getLeftOffset()+lineLeftOffset,this._getTopOffset()+lineTopOffset,lineWidth,heightOfLine/this.lineHeight)),lineTopOffset+=heightOfLine;this._removeShadow(ctx)}},_getLineLeftOffset:function(lineWidth){return"center"===this.textAlign?(this.width-lineWidth)/2:"right"===this.textAlign?this.width-lineWidth:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[]},_shouldClearCache:function(){var shouldClear=!1;if(this._forceClearCache)return this._forceClearCache=!1,!0;for(var prop in this._dimensionAffectingProps)this["__"+prop]!==this[prop]&&(this["__"+prop]=this[prop],shouldClear=!0);return shouldClear},_getLineWidth:function(ctx,lineIndex){if(this.__lineWidths[lineIndex])return-1===this.__lineWidths[lineIndex]?this.width:this.__lineWidths[lineIndex];var width,wordCount,line=this._textLines[lineIndex];return width=""===line?0:this._measureLine(ctx,lineIndex),this.__lineWidths[lineIndex]=width,width&&"justify"===this.textAlign&&(wordCount=line.split(/\s+/),wordCount.length>1&&(this.__lineWidths[lineIndex]=-1)),width},_measureLine:function(ctx,lineIndex){return ctx.measureText(this._textLines[lineIndex]).width},_renderTextDecoration:function(ctx){function renderLinesAtOffset(offsets){var i,len,j,oLen,lineWidth,lineLeftOffset,heightOfLine,lineHeight=0;for(i=0,len=_this._textLines.length;len>i;i++){
for(lineWidth=_this._getLineWidth(ctx,i),lineLeftOffset=_this._getLineLeftOffset(lineWidth),heightOfLine=_this._getHeightOfLine(ctx,i),j=0,oLen=offsets.length;oLen>j;j++)ctx.fillRect(_this._getLeftOffset()+lineLeftOffset,lineHeight+(_this._fontSizeMult-1+offsets[j])*_this.fontSize-halfOfVerticalBox,lineWidth,_this.fontSize/15);lineHeight+=heightOfLine}}if(this.textDecoration){var halfOfVerticalBox=this.height/2,_this=this,offsets=[];this.textDecoration.indexOf("underline")>-1&&offsets.push(.85),this.textDecoration.indexOf("line-through")>-1&&offsets.push(.43),this.textDecoration.indexOf("overline")>-1&&offsets.push(-.12),offsets.length>0&&renderLinesAtOffset(offsets)}},_getFontDeclaration:function(){return[fabric.isLikelyNode?this.fontWeight:this.fontStyle,fabric.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",fabric.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(ctx,noTransform){this.visible&&(ctx.save(),this._setTextStyles(ctx),this._shouldClearCache()&&this._initDimensions(ctx),this.drawSelectionBackground(ctx),noTransform||this.transform(ctx),this.transformMatrix&&ctx.transform.apply(ctx,this.transformMatrix),this.group&&"path-group"===this.group.type&&ctx.translate(this.left,this.top),this._render(ctx),ctx.restore())},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(propertiesToInclude){var object=extend(this.callSuper("toObject",propertiesToInclude),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});return this.includeDefaultValues||this._removeDefaultValues(object),object},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),offsets=this._getSVGLeftTopOffsets(this.ctx),textAndBg=this._getSVGTextAndBg(offsets.textTop,offsets.textLeft);return this._wrapSVGTextAndBg(markup,textAndBg),reviver?reviver(markup.join("")):markup.join("")},_getSVGLeftTopOffsets:function(ctx){var lineTop=this._getHeightOfLine(ctx,0),textLeft=-this.width/2,textTop=0;return{textLeft:textLeft+(this.group&&"path-group"===this.group.type?this.left:0),textTop:textTop+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:lineTop}},_wrapSVGTextAndBg:function(markup,textAndBg){var noShadow=!0,filter=this.getSvgFilter(),style=""===filter?"":' style="'+filter+'"';markup.push('	<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',style,">\n",textAndBg.textBgRects.join(""),"		<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(noShadow),'" >\n',textAndBg.textSpans.join(""),"		</text>\n","	</g>\n")},_getSVGTextAndBg:function(textTopOffset,textLeftOffset){var textSpans=[],textBgRects=[],height=0;this._setSVGBg(textBgRects);for(var i=0,len=this._textLines.length;len>i;i++)this.textBackgroundColor&&this._setSVGTextLineBg(textBgRects,i,textLeftOffset,textTopOffset,height),this._setSVGTextLineText(i,textSpans,height,textLeftOffset,textTopOffset,textBgRects),height+=this._getHeightOfLine(this.ctx,i);return{textSpans:textSpans,textBgRects:textBgRects}},_setSVGTextLineText:function(i,textSpans,height,textLeftOffset,textTopOffset){var yPos=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-textTopOffset+height-this.height/2;return"justify"===this.textAlign?void this._setSVGTextLineJustifed(i,textSpans,yPos,textLeftOffset):void textSpans.push('			<tspan x="',toFixed(textLeftOffset+this._getLineLeftOffset(this._getLineWidth(this.ctx,i)),NUM_FRACTION_DIGITS),'" ','y="',toFixed(yPos,NUM_FRACTION_DIGITS),'" ',this._getFillAttributes(this.fill),">",fabric.util.string.escapeXml(this._textLines[i]),"</tspan>\n")},_setSVGTextLineJustifed:function(i,textSpans,yPos,textLeftOffset){var ctx=fabric.util.createCanvasElement().getContext("2d");this._setTextStyles(ctx);var word,len,line=this._textLines[i],words=line.split(/\s+/),wordsWidth=this._getWidthOfWords(ctx,line),widthDiff=this.width-wordsWidth,numSpaces=words.length-1,spaceWidth=numSpaces>0?widthDiff/numSpaces:0,attributes=this._getFillAttributes(this.fill);for(textLeftOffset+=this._getLineLeftOffset(this._getLineWidth(ctx,i)),i=0,len=words.length;len>i;i++)word=words[i],textSpans.push('			<tspan x="',toFixed(textLeftOffset,NUM_FRACTION_DIGITS),'" ','y="',toFixed(yPos,NUM_FRACTION_DIGITS),'" ',attributes,">",fabric.util.string.escapeXml(word),"</tspan>\n"),textLeftOffset+=this._getWidthOfWords(ctx,word)+spaceWidth},_setSVGTextLineBg:function(textBgRects,i,textLeftOffset,textTopOffset,height){textBgRects.push("		<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',toFixed(textLeftOffset+this._getLineLeftOffset(this._getLineWidth(this.ctx,i)),NUM_FRACTION_DIGITS),'" y="',toFixed(height-this.height/2,NUM_FRACTION_DIGITS),'" width="',toFixed(this._getLineWidth(this.ctx,i),NUM_FRACTION_DIGITS),'" height="',toFixed(this._getHeightOfLine(this.ctx,i)/this.lineHeight,NUM_FRACTION_DIGITS),'"></rect>\n')},_setSVGBg:function(textBgRects){this.backgroundColor&&textBgRects.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',toFixed(-this.width/2,NUM_FRACTION_DIGITS),'" y="',toFixed(-this.height/2,NUM_FRACTION_DIGITS),'" width="',toFixed(this.width,NUM_FRACTION_DIGITS),'" height="',toFixed(this.height,NUM_FRACTION_DIGITS),'"></rect>\n')},_getFillAttributes:function(value){var fillColor=value&&"string"==typeof value?new fabric.Color(value):"";return fillColor&&fillColor.getSource()&&1!==fillColor.getAlpha()?'opacity="'+fillColor.getAlpha()+'" fill="'+fillColor.setAlpha(1).toRgb()+'"':'fill="'+value+'"'},_set:function(key,value){this.callSuper("_set",key,value),key in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),fabric.Text.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),fabric.Text.DEFAULT_SVG_FONT_SIZE=16,fabric.Text.fromElement=function(element,options){if(!element)return null;var parsedAttributes=fabric.parseAttributes(element,fabric.Text.ATTRIBUTE_NAMES);options=fabric.util.object.extend(options?fabric.util.object.clone(options):{},parsedAttributes),options.top=options.top||0,options.left=options.left||0,"dx"in parsedAttributes&&(options.left+=parsedAttributes.dx),"dy"in parsedAttributes&&(options.top+=parsedAttributes.dy),"fontSize"in options||(options.fontSize=fabric.Text.DEFAULT_SVG_FONT_SIZE),options.originX||(options.originX="left");var textContent="";"textContent"in element?textContent=element.textContent:"firstChild"in element&&null!==element.firstChild&&"data"in element.firstChild&&null!==element.firstChild.data&&(textContent=element.firstChild.data),textContent=textContent.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var text=new fabric.Text(textContent,options),offX=0;return"left"===text.originX&&(offX=text.getWidth()/2),"right"===text.originX&&(offX=-text.getWidth()/2),text.set({left:text.getLeft()+offX,top:text.getTop()-text.getHeight()/2+text.fontSize*(.18+text._fontSizeFraction)}),text},fabric.Text.fromObject=function(object){return new fabric.Text(object.text,clone(object))},fabric.util.createAccessors(fabric.Text)}(exports),function(){var clone=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},__widthOfSpace:[],initialize:function(text,options){this.styles=options?options.styles||{}:{},this.callSuper("initialize",text,options),this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache"),this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var obj=this.styles;for(var p1 in obj)for(var p2 in obj[p1])for(var p3 in obj[p1][p2])return!1;return!0},setSelectionStart:function(index){index=Math.max(index,0),this.selectionStart!==index&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionStart=index),this._updateTextarea()},setSelectionEnd:function(index){index=Math.min(index,this.text.length),this.selectionEnd!==index&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionEnd=index),this._updateTextarea()},getSelectionStyles:function(startIndex,endIndex){if(2===arguments.length){for(var styles=[],i=startIndex;endIndex>i;i++)styles.push(this.getSelectionStyles(i));return styles}var loc=this.get2DCursorLocation(startIndex),style=this._getStyleDeclaration(loc.lineIndex,loc.charIndex);return style||{}},setSelectionStyles:function(styles){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,styles);else for(var i=this.selectionStart;i<this.selectionEnd;i++)this._extendStyles(i,styles);return this._forceClearCache=!0,this},_extendStyles:function(index,styles){var loc=this.get2DCursorLocation(index);this._getLineStyle(loc.lineIndex)||this._setLineStyle(loc.lineIndex,{}),this._getStyleDeclaration(loc.lineIndex,loc.charIndex)||this._setStyleDeclaration(loc.lineIndex,loc.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(loc.lineIndex,loc.charIndex),styles)},_render:function(ctx){this.callSuper("_render",ctx),this.ctx=ctx,this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var boundaries,ctx,chars=this.text.split("");this.canvas.contextTop?(ctx=this.canvas.contextTop,ctx.save(),ctx.transform.apply(ctx,this.canvas.viewportTransform),this.transform(ctx),this.transformMatrix&&ctx.transform.apply(ctx,this.transformMatrix)):(ctx=this.ctx,ctx.save()),this.selectionStart===this.selectionEnd?(boundaries=this._getCursorBoundaries(chars,"cursor"),this.renderCursor(boundaries,ctx)):(boundaries=this._getCursorBoundaries(chars,"selection"),this.renderSelection(chars,boundaries,ctx)),ctx.restore()}},get2DCursorLocation:function(selectionStart){"undefined"==typeof selectionStart&&(selectionStart=this.selectionStart);for(var len=this._textLines.length,i=0;len>i;i++){if(selectionStart<=this._textLines[i].length)return{lineIndex:i,charIndex:selectionStart};selectionStart-=this._textLines[i].length+1}return{lineIndex:i-1,charIndex:this._textLines[i-1].length<selectionStart?this._textLines[i-1].length:selectionStart}},getCurrentCharStyle:function(lineIndex,charIndex){var style=this._getStyleDeclaration(lineIndex,0===charIndex?0:charIndex-1);return{fontSize:style&&style.fontSize||this.fontSize,fill:style&&style.fill||this.fill,textBackgroundColor:style&&style.textBackgroundColor||this.textBackgroundColor,textDecoration:style&&style.textDecoration||this.textDecoration,fontFamily:style&&style.fontFamily||this.fontFamily,fontWeight:style&&style.fontWeight||this.fontWeight,fontStyle:style&&style.fontStyle||this.fontStyle,stroke:style&&style.stroke||this.stroke,strokeWidth:style&&style.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(lineIndex,charIndex){var style=this._getStyleDeclaration(lineIndex,0===charIndex?0:charIndex-1);return style&&style.fontSize?style.fontSize:this.fontSize},getCurrentCharColor:function(lineIndex,charIndex){var style=this._getStyleDeclaration(lineIndex,0===charIndex?0:charIndex-1);return style&&style.fill?style.fill:this.cursorColor},_getCursorBoundaries:function(chars,typeOfBoundaries){var left=Math.round(this._getLeftOffset()),top=this._getTopOffset(),offsets=this._getCursorBoundariesOffsets(chars,typeOfBoundaries);return{left:left,top:top,leftOffset:offsets.left+offsets.lineLeft,topOffset:offsets.top}},_getCursorBoundariesOffsets:function(chars,typeOfBoundaries){for(var lineLeftOffset=0,lineIndex=0,charIndex=0,topOffset=0,leftOffset=0,i=0;i<this.selectionStart;i++)"\n"===chars[i]?(leftOffset=0,topOffset+=this._getHeightOfLine(this.ctx,lineIndex),lineIndex++,charIndex=0):(leftOffset+=this._getWidthOfChar(this.ctx,chars[i],lineIndex,charIndex),charIndex++),lineLeftOffset=this._getLineLeftOffset(this._getLineWidth(this.ctx,lineIndex));return"cursor"===typeOfBoundaries&&(topOffset+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,lineIndex)/this.lineHeight-this.getCurrentCharFontSize(lineIndex,charIndex)*(1-this._fontSizeFraction)),{top:topOffset,left:leftOffset,lineLeft:lineLeftOffset}},renderCursor:function(boundaries,ctx){var cursorLocation=this.get2DCursorLocation(),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex,charHeight=this.getCurrentCharFontSize(lineIndex,charIndex),leftOffset=0===lineIndex&&0===charIndex?this._getLineLeftOffset(this._getLineWidth(ctx,lineIndex)):boundaries.leftOffset;ctx.fillStyle=this.getCurrentCharColor(lineIndex,charIndex),ctx.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,ctx.fillRect(boundaries.left+leftOffset,boundaries.top+boundaries.topOffset,this.cursorWidth/this.scaleX,charHeight)},renderSelection:function(chars,boundaries,ctx){ctx.fillStyle=this.selectionColor;for(var start=this.get2DCursorLocation(this.selectionStart),end=this.get2DCursorLocation(this.selectionEnd),startLine=start.lineIndex,endLine=end.lineIndex,i=startLine;endLine>=i;i++){var lineOffset=this._getLineLeftOffset(this._getLineWidth(ctx,i))||0,lineHeight=this._getHeightOfLine(this.ctx,i),boxWidth=0,line=this._textLines[i];if(i===startLine)for(var j=0,len=line.length;len>j;j++)j>=start.charIndex&&(i!==endLine||j<end.charIndex)&&(boxWidth+=this._getWidthOfChar(ctx,line[j],i,j)),j<start.charIndex&&(lineOffset+=this._getWidthOfChar(ctx,line[j],i,j));else if(i>startLine&&endLine>i)boxWidth+=this._getLineWidth(ctx,i)||5;else if(i===endLine)for(var j2=0,j2len=end.charIndex;j2len>j2;j2++)boxWidth+=this._getWidthOfChar(ctx,line[j2],i,j2);ctx.fillRect(boundaries.left+lineOffset,boundaries.top+boundaries.topOffset,boxWidth,lineHeight),boundaries.topOffset+=lineHeight}},_renderChars:function(method,ctx,line,left,top,lineIndex,charOffset){if(this.isEmptyStyles())return this._renderCharsFast(method,ctx,line,left,top);charOffset=charOffset||0,this.skipTextAlign=!0,left-="center"===this.textAlign?this.width/2:"right"===this.textAlign?this.width:0;var prevStyle,thisStyle,lineHeight=this._getHeightOfLine(ctx,lineIndex),lineLeftOffset=this._getLineLeftOffset(this._getLineWidth(ctx,lineIndex)),charsToRender="";left+=lineLeftOffset||0,ctx.save(),top-=lineHeight/this.lineHeight*this._fontSizeFraction;for(var i=charOffset,len=line.length+charOffset;len>=i;i++)prevStyle=prevStyle||this.getCurrentCharStyle(lineIndex,i),thisStyle=this.getCurrentCharStyle(lineIndex,i+1),(this._hasStyleChanged(prevStyle,thisStyle)||i===len)&&(this._renderChar(method,ctx,lineIndex,i-1,charsToRender,left,top,lineHeight),charsToRender="",prevStyle=thisStyle),charsToRender+=line[i-charOffset];ctx.restore()},_renderCharsFast:function(method,ctx,line,left,top){this.skipTextAlign=!1,"fillText"===method&&this.fill&&this.callSuper("_renderChars",method,ctx,line,left,top),"strokeText"===method&&(this.stroke&&this.strokeWidth>0||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",method,ctx,line,left,top)},_renderChar:function(method,ctx,lineIndex,i,_char,left,top,lineHeight){var charWidth,charHeight,shouldFill,shouldStroke,offset,textDecoration,decl=this._getStyleDeclaration(lineIndex,i);decl?(charHeight=this._getHeightOfChar(ctx,_char,lineIndex,i),shouldStroke=decl.stroke,shouldFill=decl.fill,textDecoration=decl.textDecoration):charHeight=this.fontSize,shouldStroke=(shouldStroke||this.stroke)&&"strokeText"===method,shouldFill=(shouldFill||this.fill)&&"fillText"===method,decl&&ctx.save(),charWidth=this._applyCharStylesGetWidth(ctx,_char,lineIndex,i,decl||{}),textDecoration=textDecoration||this.textDecoration,decl&&decl.textBackgroundColor&&this._removeShadow(ctx),shouldFill&&ctx.fillText(_char,left,top),shouldStroke&&ctx.strokeText(_char,left,top),(textDecoration||""!==textDecoration)&&(offset=this._fontSizeFraction*lineHeight/this.lineHeight,this._renderCharDecoration(ctx,textDecoration,left,top,offset,charWidth,charHeight)),decl&&ctx.restore(),ctx.translate(charWidth,0)},_hasStyleChanged:function(prevStyle,thisStyle){return prevStyle.fill!==thisStyle.fill||prevStyle.fontSize!==thisStyle.fontSize||prevStyle.textBackgroundColor!==thisStyle.textBackgroundColor||prevStyle.textDecoration!==thisStyle.textDecoration||prevStyle.fontFamily!==thisStyle.fontFamily||prevStyle.fontWeight!==thisStyle.fontWeight||prevStyle.fontStyle!==thisStyle.fontStyle||prevStyle.stroke!==thisStyle.stroke||prevStyle.strokeWidth!==thisStyle.strokeWidth},_renderCharDecoration:function(ctx,textDecoration,left,top,offset,charWidth,charHeight){if(textDecoration){var i,decoration,decorationWeight=charHeight/15,positions={underline:top+charHeight/10,"line-through":top-charHeight*(this._fontSizeFraction+this._fontSizeMult-1)+decorationWeight,overline:top-(this._fontSizeMult-this._fontSizeFraction)*charHeight},decorations=["underline","line-through","overline"];for(i=0;i<decorations.length;i++)decoration=decorations[i],textDecoration.indexOf(decoration)>-1&&ctx.fillRect(left,positions[decoration],charWidth,decorationWeight)}},_renderTextLine:function(method,ctx,line,left,top,lineIndex){this.isEmptyStyles()||(top+=this.fontSize*(this._fontSizeFraction+.03)),this.callSuper("_renderTextLine",method,ctx,line,left,top,lineIndex)},_renderTextDecoration:function(ctx){return this.isEmptyStyles()?this.callSuper("_renderTextDecoration",ctx):void 0},_renderTextLinesBackground:function(ctx){this.callSuper("_renderTextLinesBackground",ctx);for(var heightOfLine,lineWidth,lineLeftOffset,line,_char,style,lineTopOffset=0,leftOffset=this._getLeftOffset(),topOffset=this._getTopOffset(),i=0,len=this._textLines.length;len>i;i++)if(heightOfLine=this._getHeightOfLine(ctx,i),line=this._textLines[i],""!==line&&this.styles&&this._getLineStyle(i)){lineWidth=this._getLineWidth(ctx,i),lineLeftOffset=this._getLineLeftOffset(lineWidth);for(var j=0,jlen=line.length;jlen>j;j++)style=this._getStyleDeclaration(i,j),style&&style.textBackgroundColor&&(_char=line[j],ctx.fillStyle=style.textBackgroundColor,ctx.fillRect(leftOffset+lineLeftOffset+this._getWidthOfCharsAt(ctx,i,j),topOffset+lineTopOffset,this._getWidthOfChar(ctx,_char,i,j)+1,heightOfLine/this.lineHeight));lineTopOffset+=heightOfLine}else lineTopOffset+=heightOfLine},_getCacheProp:function(_char,styleDeclaration){return _char+styleDeclaration.fontFamily+styleDeclaration.fontSize+styleDeclaration.fontWeight+styleDeclaration.fontStyle+styleDeclaration.shadow},_applyCharStylesGetWidth:function(ctx,_char,lineIndex,charIndex,decl){var width,charDecl=this._getStyleDeclaration(lineIndex,charIndex),styleDeclaration=decl&&clone(decl)||clone(charDecl);this._applyFontStyles(styleDeclaration);var cacheProp=this._getCacheProp(_char,styleDeclaration);if(!charDecl&&this._charWidthsCache[cacheProp]&&this.caching)return this._charWidthsCache[cacheProp];"string"==typeof styleDeclaration.shadow&&(styleDeclaration.shadow=new fabric.Shadow(styleDeclaration.shadow));var fill=styleDeclaration.fill||this.fill;return ctx.fillStyle=fill.toLive?fill.toLive(ctx,this):fill,styleDeclaration.stroke&&(ctx.strokeStyle=styleDeclaration.stroke&&styleDeclaration.stroke.toLive?styleDeclaration.stroke.toLive(ctx,this):styleDeclaration.stroke),ctx.lineWidth=styleDeclaration.strokeWidth||this.strokeWidth,ctx.font=this._getFontDeclaration.call(styleDeclaration),styleDeclaration.shadow&&(styleDeclaration.scaleX=this.scaleX,styleDeclaration.scaleY=this.scaleY,styleDeclaration.canvas=this.canvas,this._setShadow.call(styleDeclaration,ctx)),this.caching&&this._charWidthsCache[cacheProp]?this._charWidthsCache[cacheProp]:(width=ctx.measureText(_char).width,this.caching&&(this._charWidthsCache[cacheProp]=width),width)},_applyFontStyles:function(styleDeclaration){styleDeclaration.fontFamily||(styleDeclaration.fontFamily=this.fontFamily),styleDeclaration.fontSize||(styleDeclaration.fontSize=this.fontSize),styleDeclaration.fontWeight||(styleDeclaration.fontWeight=this.fontWeight),styleDeclaration.fontStyle||(styleDeclaration.fontStyle=this.fontStyle)},_getStyleDeclaration:function(lineIndex,charIndex,returnCloneOrEmpty){return returnCloneOrEmpty?this.styles[lineIndex]&&this.styles[lineIndex][charIndex]?clone(this.styles[lineIndex][charIndex]):{}:this.styles[lineIndex]&&this.styles[lineIndex][charIndex]?this.styles[lineIndex][charIndex]:null},_setStyleDeclaration:function(lineIndex,charIndex,style){this.styles[lineIndex][charIndex]=style},_deleteStyleDeclaration:function(lineIndex,charIndex){delete this.styles[lineIndex][charIndex]},_getLineStyle:function(lineIndex){return this.styles[lineIndex]},_setLineStyle:function(lineIndex,style){this.styles[lineIndex]=style},_deleteLineStyle:function(lineIndex){delete this.styles[lineIndex]},_getWidthOfChar:function(ctx,_char,lineIndex,charIndex){if(!this._isMeasuring&&"justify"===this.textAlign&&this._reSpacesAndTabs.test(_char))return this._getWidthOfSpace(ctx,lineIndex);var styleDeclaration=this._getStyleDeclaration(lineIndex,charIndex,!0);this._applyFontStyles(styleDeclaration);var cacheProp=this._getCacheProp(_char,styleDeclaration);if(this._charWidthsCache[cacheProp]&&this.caching)return this._charWidthsCache[cacheProp];if(ctx){ctx.save();var width=this._applyCharStylesGetWidth(ctx,_char,lineIndex,charIndex);return ctx.restore(),width}},_getHeightOfChar:function(ctx,lineIndex,charIndex){var style=this._getStyleDeclaration(lineIndex,charIndex);return style&&style.fontSize?style.fontSize:this.fontSize},_getWidthOfCharsAt:function(ctx,lineIndex,charIndex){var i,_char,width=0;for(i=0;charIndex>i;i++)_char=this._textLines[lineIndex][i],width+=this._getWidthOfChar(ctx,_char,lineIndex,i);return width},_measureLine:function(ctx,lineIndex){this._isMeasuring=!0;var width=this._getWidthOfCharsAt(ctx,lineIndex,this._textLines[lineIndex].length);return this._isMeasuring=!1,width},_getWidthOfSpace:function(ctx,lineIndex){if(this.__widthOfSpace[lineIndex])return this.__widthOfSpace[lineIndex];var line=this._textLines[lineIndex],wordsWidth=this._getWidthOfWords(ctx,line,lineIndex,0),widthDiff=this.width-wordsWidth,numSpaces=line.length-line.replace(this._reSpacesAndTabs,"").length,width=Math.max(widthDiff/numSpaces,ctx.measureText(" ").width);return this.__widthOfSpace[lineIndex]=width,width},_getWidthOfWords:function(ctx,line,lineIndex,charOffset){for(var width=0,charIndex=0;charIndex<line.length;charIndex++){var _char=line[charIndex];_char.match(/\s/)||(width+=this._getWidthOfChar(ctx,_char,lineIndex,charIndex+charOffset))}return width},_getHeightOfLine:function(ctx,lineIndex){if(this.__lineHeights[lineIndex])return this.__lineHeights[lineIndex];for(var line=this._textLines[lineIndex],maxHeight=this._getHeightOfChar(ctx,lineIndex,0),i=1,len=line.length;len>i;i++){var currentCharHeight=this._getHeightOfChar(ctx,lineIndex,i);currentCharHeight>maxHeight&&(maxHeight=currentCharHeight)}return this.__lineHeights[lineIndex]=maxHeight*this.lineHeight*this._fontSizeMult,this.__lineHeights[lineIndex]},_getTextHeight:function(ctx){for(var height=0,i=0,len=this._textLines.length;len>i;i++)height+=this._getHeightOfLine(ctx,i);return height},toObject:function(propertiesToInclude){var i,j,row,clonedStyles={};for(i in this.styles){row=this.styles[i],clonedStyles[i]={};for(j in row)clonedStyles[i][j]=clone(row[j])}return fabric.util.object.extend(this.callSuper("toObject",propertiesToInclude),{styles:clonedStyles})}}),fabric.IText.fromObject=function(object){return new fabric.IText(object.text,clone(object))}}(),function(){var clone=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var _this=this;setTimeout(function(){_this.selected=!0},100)})},initAddedHandler:function(){var _this=this;this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers()),_this.canvas&&(_this.canvas._iTextInstances=_this.canvas._iTextInstances||[],_this.canvas._iTextInstances.push(_this))})},initRemovedHandler:function(){var _this=this;this.on("removed",function(){_this.canvas&&(_this.canvas._iTextInstances=_this.canvas._iTextInstances||[],fabric.util.removeFromArray(_this.canvas._iTextInstances,_this))})},_initCanvasHandlers:function(){var _this=this;this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers(_this.canvas)}),this.canvas.on("mouse:up",function(){_this.canvas._iTextInstances&&_this.canvas._iTextInstances.forEach(function(obj){obj.__isMousedown=!1})}),this.canvas.on("object:selected",function(){fabric.IText.prototype.exitEditingOnOthers(_this.canvas)})},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(obj,targetOpacity,duration,completeMethod){var tickState;return tickState={isAborted:!1,abort:function(){this.isAborted=!0}},obj.animate("_currentCursorOpacity",targetOpacity,{duration:duration,onComplete:function(){tickState.isAborted||obj[completeMethod]()},onChange:function(){obj.canvas&&(obj.canvas.clearContext(obj.canvas.contextTop||obj.ctx),obj.renderCursorOrSelection())},abort:function(){return tickState.isAborted}}),tickState},_onTickComplete:function(){var _this=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){_this._currentTickCompleteState=_this._animateCursor(_this,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(restart){var _this=this,delay=restart?0:this.cursorDelay;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&(this.canvas.clearContext(this.canvas.contextTop||this.ctx),this.renderCursorOrSelection()),this._cursorTimeout2&&clearTimeout(this._cursorTimeout2),this._cursorTimeout2=setTimeout(function(){_this._tick()},delay)},abortCursorAnimation:function(){this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.setSelectionStart(0),this.setSelectionEnd(this.text.length)},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(startFrom){var offset=0,index=startFrom-1;if(this._reSpace.test(this.text.charAt(index)))for(;this._reSpace.test(this.text.charAt(index));)offset++,index--;for(;/\S/.test(this.text.charAt(index))&&index>-1;)offset++,index--;return startFrom-offset},findWordBoundaryRight:function(startFrom){var offset=0,index=startFrom;if(this._reSpace.test(this.text.charAt(index)))for(;this._reSpace.test(this.text.charAt(index));)offset++,index++;for(;/\S/.test(this.text.charAt(index))&&index<this.text.length;)offset++,index++;return startFrom+offset},findLineBoundaryLeft:function(startFrom){for(var offset=0,index=startFrom-1;!/\n/.test(this.text.charAt(index))&&index>-1;)offset++,index--;return startFrom-offset},findLineBoundaryRight:function(startFrom){for(var offset=0,index=startFrom;!/\n/.test(this.text.charAt(index))&&index<this.text.length;)offset++,index++;return startFrom+offset},getNumNewLinesInSelectedText:function(){for(var selectedText=this.getSelectedText(),numNewLines=0,i=0,len=selectedText.length;len>i;i++)"\n"===selectedText[i]&&numNewLines++;return numNewLines},searchWordBoundary:function(selectionStart,direction){for(var index=this._reSpace.test(this.text.charAt(selectionStart))?selectionStart-1:selectionStart,_char=this.text.charAt(index),reNonWord=/[ \n\.,;!\?\-]/;!reNonWord.test(_char)&&index>0&&index<this.text.length;)index+=direction,_char=this.text.charAt(index);return reNonWord.test(_char)&&"\n"!==_char&&(index+=1===direction?0:1),index},selectWord:function(selectionStart){var newSelectionStart=this.searchWordBoundary(selectionStart,-1),newSelectionEnd=this.searchWordBoundary(selectionStart,1);this.setSelectionStart(newSelectionStart),this.setSelectionEnd(newSelectionEnd)},selectLine:function(selectionStart){var newSelectionStart=this.findLineBoundaryLeft(selectionStart),newSelectionEnd=this.findLineBoundaryRight(selectionStart);this.setSelectionStart(newSelectionStart),this.setSelectionEnd(newSelectionEnd)},enterEditing:function(e){return!this.isEditing&&this.editable?(this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(e),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this.canvas?(this.canvas.renderAll(),this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this):this):void 0},exitEditingOnOthers:function(canvas){canvas._iTextInstances&&canvas._iTextInstances.forEach(function(obj){obj.selected=!1,obj.isEditing&&obj.exitEditing()})},initMouseMoveHandler:function(){var _this=this;this.canvas.on("mouse:move",function(options){if(_this.__isMousedown&&_this.isEditing){var newSelectionStart=_this.getSelectionStartFromPointer(options.e);newSelectionStart>=_this.__selectionStartOnMouseDown?(_this.setSelectionStart(_this.__selectionStartOnMouseDown),_this.setSelectionEnd(newSelectionStart)):(_this.setSelectionStart(newSelectionStart),_this.setSelectionEnd(_this.__selectionStartOnMouseDown))}})},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(this.hiddenTextarea&&!this.inCompositionMode&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd,this.selectionStart===this.selectionEnd)){var p=this._calcTextareaPosition();this.hiddenTextarea.style.left=p.x+"px",this.hiddenTextarea.style.top=p.y+"px"}},_calcTextareaPosition:function(){var chars=this.text.split(""),boundaries=this._getCursorBoundaries(chars,"cursor"),cursorLocation=this.get2DCursorLocation(),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex,charHeight=this.getCurrentCharFontSize(lineIndex,charIndex),leftOffset=0===lineIndex&&0===charIndex?this._getLineLeftOffset(this._getLineWidth(this.ctx,lineIndex)):boundaries.leftOffset,m=this.calcTransformMatrix(),p={x:boundaries.left+leftOffset,y:boundaries.top+boundaries.topOffset+charHeight};return this.hiddenTextarea.style.fontSize=charHeight+"px",fabric.util.transformPoint(p,m)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,
this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var isTextChanged=this._textBeforeEdit!==this.text;return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),isTextChanged&&this.fire("modified"),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),isTextChanged&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var prop in this.styles)this._textLines[prop]||delete this.styles[prop]},_removeCharsFromTo:function(start,end){for(;end!==start;)this._removeSingleCharAndStyle(start+1),end--;this.setSelectionStart(start)},_removeSingleCharAndStyle:function(index){var isBeginningOfLine="\n"===this.text[index-1],indexStyle=isBeginningOfLine?index:index-1;this.removeStyleObject(isBeginningOfLine,indexStyle),this.text=this.text.slice(0,index-1)+this.text.slice(index),this._textLines=this._splitTextIntoLines()},insertChars:function(_chars,useCopiedStyle){var style;if(this.selectionEnd-this.selectionStart>1&&(this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart)),!useCopiedStyle&&this.isEmptyStyles())return void this.insertChar(_chars,!1);for(var i=0,len=_chars.length;len>i;i++)useCopiedStyle&&(style=fabric.copiedTextStyle[i]),this.insertChar(_chars[i],len-1>i,style)},insertChar:function(_char,skipUpdate,styleObject){var isEndOfLine="\n"===this.text[this.selectionStart];this.text=this.text.slice(0,this.selectionStart)+_char+this.text.slice(this.selectionEnd),this._textLines=this._splitTextIntoLines(),this.insertStyleObjects(_char,isEndOfLine,styleObject),this.selectionStart+=_char.length,this.selectionEnd=this.selectionStart,skipUpdate||(this._updateTextarea(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this}))},insertNewlineStyleObject:function(lineIndex,charIndex,isEndOfLine){this.shiftLineStyles(lineIndex,1),this.styles[lineIndex+1]||(this.styles[lineIndex+1]={});var currentCharStyle={},newLineStyles={};if(this.styles[lineIndex]&&this.styles[lineIndex][charIndex-1]&&(currentCharStyle=this.styles[lineIndex][charIndex-1]),isEndOfLine)newLineStyles[0]=clone(currentCharStyle),this.styles[lineIndex+1]=newLineStyles;else{for(var index in this.styles[lineIndex])parseInt(index,10)>=charIndex&&(newLineStyles[parseInt(index,10)-charIndex]=this.styles[lineIndex][index],delete this.styles[lineIndex][index]);this.styles[lineIndex+1]=newLineStyles}this._forceClearCache=!0},insertCharStyleObject:function(lineIndex,charIndex,style){var currentLineStyles=this.styles[lineIndex],currentLineStylesCloned=clone(currentLineStyles);0!==charIndex||style||(charIndex=1);for(var index in currentLineStylesCloned){var numericIndex=parseInt(index,10);numericIndex>=charIndex&&(currentLineStyles[numericIndex+1]=currentLineStylesCloned[numericIndex],currentLineStylesCloned[numericIndex-1]||delete currentLineStyles[numericIndex])}this.styles[lineIndex][charIndex]=style||clone(currentLineStyles[charIndex-1]),this._forceClearCache=!0},insertStyleObjects:function(_chars,isEndOfLine,styleObject){var cursorLocation=this.get2DCursorLocation(),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex;this._getLineStyle(lineIndex)||this._setLineStyle(lineIndex,{}),"\n"===_chars?this.insertNewlineStyleObject(lineIndex,charIndex,isEndOfLine):this.insertCharStyleObject(lineIndex,charIndex,styleObject)},shiftLineStyles:function(lineIndex,offset){var clonedStyles=clone(this.styles);for(var line in this.styles){var numericLine=parseInt(line,10);numericLine>lineIndex&&(this.styles[numericLine+offset]=clonedStyles[numericLine],clonedStyles[numericLine-offset]||delete this.styles[numericLine])}},removeStyleObject:function(isBeginningOfLine,index){var cursorLocation=this.get2DCursorLocation(index),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex;this._removeStyleObject(isBeginningOfLine,cursorLocation,lineIndex,charIndex)},_getTextOnPreviousLine:function(lIndex){return this._textLines[lIndex-1]},_removeStyleObject:function(isBeginningOfLine,cursorLocation,lineIndex,charIndex){if(isBeginningOfLine){var textOnPreviousLine=this._getTextOnPreviousLine(cursorLocation.lineIndex),newCharIndexOnPrevLine=textOnPreviousLine?textOnPreviousLine.length:0;this.styles[lineIndex-1]||(this.styles[lineIndex-1]={});for(charIndex in this.styles[lineIndex])this.styles[lineIndex-1][parseInt(charIndex,10)+newCharIndexOnPrevLine]=this.styles[lineIndex][charIndex];this.shiftLineStyles(cursorLocation.lineIndex,-1)}else{var currentLineStyles=this.styles[lineIndex];currentLineStyles&&delete currentLineStyles[charIndex];var currentLineStylesCloned=clone(currentLineStyles);for(var i in currentLineStylesCloned){var numericIndex=parseInt(i,10);numericIndex>=charIndex&&0!==numericIndex&&(currentLineStyles[numericIndex-1]=currentLineStylesCloned[numericIndex],delete currentLineStyles[numericIndex])}}},insertNewline:function(){this.insertChars("\n")}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(options){this.__newClickTime=+new Date;var newPointer=this.canvas.getPointer(options.e);this.isTripleClick(newPointer)?(this.fire("tripleclick",options),this._stopEvent(options.e)):this.isDoubleClick(newPointer)&&(this.fire("dblclick",options),this._stopEvent(options.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=newPointer,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(newPointer){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===newPointer.x&&this.__lastPointer.y===newPointer.y&&this.__lastIsEditing},isTripleClick:function(newPointer){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===newPointer.x&&this.__lastPointer.y===newPointer.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(options){this.selectWord(this.getSelectionStartFromPointer(options.e))}),this.on("tripleclick",function(options){this.selectLine(this.getSelectionStartFromPointer(options.e))})},initMousedownHandler:function(){this.on("mousedown",function(options){if(this.editable){var pointer=this.canvas.getPointer(options.e);this.__mousedownX=pointer.x,this.__mousedownY=pointer.y,this.__isMousedown=!0,this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea),this.selected&&this.setCursorByClick(options.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))}})},_isObjectMoved:function(e){var pointer=this.canvas.getPointer(e);return this.__mousedownX!==pointer.x||this.__mousedownY!==pointer.y},initMouseupHandler:function(){this.on("mouseup",function(options){this.__isMousedown=!1,this.editable&&!this._isObjectMoved(options.e)&&(this.__lastSelected&&!this.__corner&&(this.enterEditing(options.e),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(e){var newSelectionStart=this.getSelectionStartFromPointer(e);e.shiftKey?newSelectionStart<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(newSelectionStart)):this.setSelectionEnd(newSelectionStart):(this.setSelectionStart(newSelectionStart),this.setSelectionEnd(newSelectionStart))},getSelectionStartFromPointer:function(e){for(var newSelectionStart,line,mouseOffset=this.getLocalPointer(e),prevWidth=0,width=0,height=0,charIndex=0,i=0,len=this._textLines.length;len>i;i++){line=this._textLines[i],height+=this._getHeightOfLine(this.ctx,i)*this.scaleY;var widthOfLine=this._getLineWidth(this.ctx,i),lineLeftOffset=this._getLineLeftOffset(widthOfLine);width=lineLeftOffset*this.scaleX;for(var j=0,jlen=line.length;jlen>j;j++){if(prevWidth=width,width+=this._getWidthOfChar(this.ctx,line[j],i,this.flipX?jlen-j:j)*this.scaleX,!(height<=mouseOffset.y||width<=mouseOffset.x))return this._getNewSelectionStartFromOffset(mouseOffset,prevWidth,width,charIndex+i,jlen);charIndex++}if(mouseOffset.y<height)return this._getNewSelectionStartFromOffset(mouseOffset,prevWidth,width,charIndex+i-1,jlen)}return"undefined"==typeof newSelectionStart?this.text.length:void 0},_getNewSelectionStartFromOffset:function(mouseOffset,prevWidth,width,index,jlen){var distanceBtwLastCharAndCursor=mouseOffset.x-prevWidth,distanceBtwNextCharAndCursor=width-mouseOffset.x,offset=distanceBtwNextCharAndCursor>distanceBtwLastCharAndCursor?0:1,newSelectionStart=index+offset;return this.flipX&&(newSelectionStart=jlen-newSelectionStart),newSelectionStart>this.text.length&&(newSelectionStart=this.text.length),newSelectionStart}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(e){var p;e&&this.canvas?p=this.canvas.getPointer(e):(this.oCoords||this.setCoords(),p=this.oCoords.tl),this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.style.cssText="position: absolute; top: "+p.y+"px; left: "+p.x+"px; opacity: 0; width: 0px; height: 0px; z-index: -999;",this.canvas?this.canvas.lowerCanvasEl.parentNode.appendChild(this.hiddenTextarea):fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.cut.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMapUp:{67:"copy",88:"cut"},_ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(e){if(this.isEditing){if(e.keyCode in this._keysMap)this[this._keysMap[e.keyCode]](e);else{if(!(e.keyCode in this._ctrlKeysMapDown&&(e.ctrlKey||e.metaKey)))return;this[this._ctrlKeysMapDown[e.keyCode]](e)}e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.renderAll()}},onKeyUp:function(e){return!this.isEditing||this._copyDone?void(this._copyDone=!1):void(e.keyCode in this._ctrlKeysMapUp&&(e.ctrlKey||e.metaKey)&&(this[this._ctrlKeysMapUp[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.renderAll()))},onInput:function(e){if(this.isEditing&&!this.inCompositionMode){var diff,charsToInsert,start,offset=this.selectionStart||0,offsetEnd=this.selectionEnd||0,textLength=this.text.length,newTextLength=this.hiddenTextarea.value.length;newTextLength>textLength?(start="left"===this._selectionDirection?offsetEnd:offset,diff=newTextLength-textLength,charsToInsert=this.hiddenTextarea.value.slice(start,start+diff)):(diff=newTextLength-textLength+offsetEnd-offset,charsToInsert=this.hiddenTextarea.value.slice(offset,offset+diff)),this.insertChars(charsToInsert),e.stopPropagation()}},onCompositionStart:function(){this.inCompositionMode=!0,this.prevCompositionLength=0,this.compositionStart=this.selectionStart},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(e){var data=e.data;this.selectionStart=this.compositionStart,this.selectionEnd=this.selectionEnd===this.selectionStart?this.compositionStart+this.prevCompositionLength:this.selectionEnd,this.insertChars(data,!1),this.prevCompositionLength=data.length},forwardDelete:function(e){if(this.selectionStart===this.selectionEnd){if(this.selectionStart===this.text.length)return;this.moveCursorRight(e)}this.removeChars(e)},copy:function(e){if(this.selectionStart!==this.selectionEnd){var selectedText=this.getSelectedText(),clipboardData=this._getClipboardData(e);clipboardData&&clipboardData.setData("text",selectedText),fabric.copiedText=selectedText,fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd),e.stopImmediatePropagation(),e.preventDefault(),this._copyDone=!0}},paste:function(e){var copiedText=null,clipboardData=this._getClipboardData(e),useCopiedStyle=!0;clipboardData?(copiedText=clipboardData.getData("text").replace(/\r/g,""),fabric.copiedTextStyle&&fabric.copiedText===copiedText||(useCopiedStyle=!1)):copiedText=fabric.copiedText,copiedText&&this.insertChars(copiedText,useCopiedStyle),e.stopImmediatePropagation(),e.preventDefault()},cut:function(e){this.selectionStart!==this.selectionEnd&&(this.copy(e),this.removeChars(e))},_getClipboardData:function(e){return e&&e.clipboardData||fabric.window.clipboardData},getDownCursorOffset:function(e,isRight){var _char,lineLeftOffset,selectionProp=isRight?this.selectionEnd:this.selectionStart,cursorLocation=this.get2DCursorLocation(selectionProp),lineIndex=cursorLocation.lineIndex,textOnSameLineBeforeCursor=this._textLines[lineIndex].slice(0,cursorLocation.charIndex),textOnSameLineAfterCursor=this._textLines[lineIndex].slice(cursorLocation.charIndex),textOnNextLine=this._textLines[lineIndex+1]||"";if(lineIndex===this._textLines.length-1||e.metaKey||34===e.keyCode)return this.text.length-selectionProp;var widthOfSameLineBeforeCursor=this._getLineWidth(this.ctx,lineIndex);lineLeftOffset=this._getLineLeftOffset(widthOfSameLineBeforeCursor);for(var widthOfCharsOnSameLineBeforeCursor=lineLeftOffset,i=0,len=textOnSameLineBeforeCursor.length;len>i;i++)_char=textOnSameLineBeforeCursor[i],widthOfCharsOnSameLineBeforeCursor+=this._getWidthOfChar(this.ctx,_char,lineIndex,i);var indexOnNextLine=this._getIndexOnNextLine(cursorLocation,textOnNextLine,widthOfCharsOnSameLineBeforeCursor);return textOnSameLineAfterCursor.length+1+indexOnNextLine},_getIndexOnNextLine:function(cursorLocation,textOnNextLine,widthOfCharsOnSameLineBeforeCursor){for(var foundMatch,lineIndex=cursorLocation.lineIndex+1,widthOfNextLine=this._getLineWidth(this.ctx,lineIndex),lineLeftOffset=this._getLineLeftOffset(widthOfNextLine),widthOfCharsOnNextLine=lineLeftOffset,indexOnNextLine=0,j=0,jlen=textOnNextLine.length;jlen>j;j++){var _char=textOnNextLine[j],widthOfChar=this._getWidthOfChar(this.ctx,_char,lineIndex,j);if(widthOfCharsOnNextLine+=widthOfChar,widthOfCharsOnNextLine>widthOfCharsOnSameLineBeforeCursor){foundMatch=!0;var leftEdge=widthOfCharsOnNextLine-widthOfChar,rightEdge=widthOfCharsOnNextLine,offsetFromLeftEdge=Math.abs(leftEdge-widthOfCharsOnSameLineBeforeCursor),offsetFromRightEdge=Math.abs(rightEdge-widthOfCharsOnSameLineBeforeCursor);indexOnNextLine=offsetFromLeftEdge>offsetFromRightEdge?j+1:j;break}}return foundMatch||(indexOnNextLine=textOnNextLine.length),indexOnNextLine},moveCursorDown:function(e){this.abortCursorAnimation(),this._currentCursorOpacity=1;var offset=this.getDownCursorOffset(e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorDownWithShift(offset):this.moveCursorDownWithoutShift(offset),this.initDelayedCursor()},moveCursorDownWithoutShift:function(offset){this._selectionDirection="right",this.setSelectionStart(this.selectionStart+offset),this.setSelectionEnd(this.selectionStart)},swapSelectionPoints:function(){var swapSel=this.selectionEnd;this.setSelectionEnd(this.selectionStart),this.setSelectionStart(swapSel)},moveCursorDownWithShift:function(offset){this.selectionEnd===this.selectionStart&&(this._selectionDirection="right"),"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd+offset):this.setSelectionStart(this.selectionStart+offset),this.selectionEnd<this.selectionStart&&"left"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="right"),this.selectionEnd>this.text.length&&this.setSelectionEnd(this.text.length)},getUpCursorOffset:function(e,isRight){var selectionProp=isRight?this.selectionEnd:this.selectionStart,cursorLocation=this.get2DCursorLocation(selectionProp),lineIndex=cursorLocation.lineIndex;if(0===lineIndex||e.metaKey||33===e.keyCode)return selectionProp;for(var _char,textOnSameLineBeforeCursor=this._textLines[lineIndex].slice(0,cursorLocation.charIndex),textOnPreviousLine=this._textLines[lineIndex-1]||"",widthOfSameLineBeforeCursor=this._getLineWidth(this.ctx,cursorLocation.lineIndex),lineLeftOffset=this._getLineLeftOffset(widthOfSameLineBeforeCursor),widthOfCharsOnSameLineBeforeCursor=lineLeftOffset,i=0,len=textOnSameLineBeforeCursor.length;len>i;i++)_char=textOnSameLineBeforeCursor[i],widthOfCharsOnSameLineBeforeCursor+=this._getWidthOfChar(this.ctx,_char,lineIndex,i);var indexOnPrevLine=this._getIndexOnPrevLine(cursorLocation,textOnPreviousLine,widthOfCharsOnSameLineBeforeCursor);return textOnPreviousLine.length-indexOnPrevLine+textOnSameLineBeforeCursor.length},_getIndexOnPrevLine:function(cursorLocation,textOnPreviousLine,widthOfCharsOnSameLineBeforeCursor){for(var foundMatch,lineIndex=cursorLocation.lineIndex-1,widthOfPreviousLine=this._getLineWidth(this.ctx,lineIndex),lineLeftOffset=this._getLineLeftOffset(widthOfPreviousLine),widthOfCharsOnPreviousLine=lineLeftOffset,indexOnPrevLine=0,j=0,jlen=textOnPreviousLine.length;jlen>j;j++){var _char=textOnPreviousLine[j],widthOfChar=this._getWidthOfChar(this.ctx,_char,lineIndex,j);if(widthOfCharsOnPreviousLine+=widthOfChar,widthOfCharsOnPreviousLine>widthOfCharsOnSameLineBeforeCursor){foundMatch=!0;var leftEdge=widthOfCharsOnPreviousLine-widthOfChar,rightEdge=widthOfCharsOnPreviousLine,offsetFromLeftEdge=Math.abs(leftEdge-widthOfCharsOnSameLineBeforeCursor),offsetFromRightEdge=Math.abs(rightEdge-widthOfCharsOnSameLineBeforeCursor);indexOnPrevLine=offsetFromLeftEdge>offsetFromRightEdge?j:j-1;break}}return foundMatch||(indexOnPrevLine=textOnPreviousLine.length-1),indexOnPrevLine},moveCursorUp:function(e){this.abortCursorAnimation(),this._currentCursorOpacity=1;var offset=this.getUpCursorOffset(e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorUpWithShift(offset):this.moveCursorUpWithoutShift(offset),this.initDelayedCursor()},moveCursorUpWithShift:function(offset){this.selectionEnd===this.selectionStart&&(this._selectionDirection="left"),"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd-offset):this.setSelectionStart(this.selectionStart-offset),this.selectionEnd<this.selectionStart&&"right"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="left")},moveCursorUpWithoutShift:function(offset){this.selectionStart===this.selectionEnd&&this.setSelectionStart(this.selectionStart-offset),this.setSelectionEnd(this.selectionStart),this._selectionDirection="left"},moveCursorLeft:function(e){0===this.selectionStart&&0===this.selectionEnd||(this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorLeftWithShift(e):this.moveCursorLeftWithoutShift(e),this.initDelayedCursor())},_move:function(e,prop,direction){var propMethod="selectionStart"===prop?"setSelectionStart":"setSelectionEnd";e.altKey?this[propMethod](this["findWordBoundary"+direction](this[prop])):e.metaKey||35===e.keyCode||36===e.keyCode?this[propMethod](this["findLineBoundary"+direction](this[prop])):this[propMethod](this[prop]+("Left"===direction?-1:1))},_moveLeft:function(e,prop){this._move(e,prop,"Left")},_moveRight:function(e,prop){this._move(e,prop,"Right")},moveCursorLeftWithoutShift:function(e){this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this._moveLeft(e,"selectionStart"),this.setSelectionEnd(this.selectionStart)},moveCursorLeftWithShift:function(e){"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(e,"selectionStart"))},moveCursorRight:function(e){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorRightWithShift(e):this.moveCursorRightWithoutShift(e),this.initDelayedCursor())},moveCursorRightWithShift:function(e){"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):(this._selectionDirection="right",this._moveRight(e,"selectionEnd"))},moveCursorRightWithoutShift:function(e){this._selectionDirection="right",this.selectionStart===this.selectionEnd?(this._moveRight(e,"selectionStart"),this.setSelectionEnd(this.selectionStart)):(this.setSelectionEnd(this.selectionEnd+this.getNumNewLinesInSelectedText()),this.setSelectionStart(this.selectionEnd))},removeChars:function(e){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(e):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart),this._removeExtraneousStyles(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(e){if(0!==this.selectionStart)if(e.metaKey){var leftLineBoundary=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(leftLineBoundary,this.selectionStart),this.setSelectionStart(leftLineBoundary)}else if(e.altKey){var leftWordBoundary=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(leftWordBoundary,this.selectionStart),this.setSelectionStart(leftWordBoundary)}else this._removeSingleCharAndStyle(this.selectionStart),this.setSelectionStart(this.selectionStart-1)}}),function(){var toFixed=fabric.util.toFixed,NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(lineIndex,textSpans,height,textLeftOffset,textTopOffset,textBgRects){this._getLineStyle(lineIndex)?this._setSVGTextLineChars(lineIndex,textSpans,height,textLeftOffset,textBgRects):fabric.Text.prototype._setSVGTextLineText.call(this,lineIndex,textSpans,height,textLeftOffset,textTopOffset)},_setSVGTextLineChars:function(lineIndex,textSpans,height,textLeftOffset,textBgRects){for(var chars=this._textLines[lineIndex],charOffset=0,lineLeftOffset=this._getLineLeftOffset(this._getLineWidth(this.ctx,lineIndex))-this.width/2,lineOffset=this._getSVGLineTopOffset(lineIndex),heightOfLine=this._getHeightOfLine(this.ctx,lineIndex),i=0,len=chars.length;len>i;i++){var styleDecl=this._getStyleDeclaration(lineIndex,i)||{};textSpans.push(this._createTextCharSpan(chars[i],styleDecl,lineLeftOffset,lineOffset.lineTop+lineOffset.offset,charOffset));var charWidth=this._getWidthOfChar(this.ctx,chars[i],lineIndex,i);styleDecl.textBackgroundColor&&textBgRects.push(this._createTextCharBg(styleDecl,lineLeftOffset,lineOffset.lineTop,heightOfLine,charWidth,charOffset)),charOffset+=charWidth}},_getSVGLineTopOffset:function(lineIndex){for(var lineTopOffset=0,lastHeight=0,j=0;lineIndex>j;j++)lineTopOffset+=this._getHeightOfLine(this.ctx,j);return lastHeight=this._getHeightOfLine(this.ctx,j),{lineTop:lineTopOffset,offset:(this._fontSizeMult-this._fontSizeFraction)*lastHeight/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(styleDecl,lineLeftOffset,lineTopOffset,heightOfLine,charWidth,charOffset){return['		<rect fill="',styleDecl.textBackgroundColor,'" x="',toFixed(lineLeftOffset+charOffset,NUM_FRACTION_DIGITS),'" y="',toFixed(lineTopOffset-this.height/2,NUM_FRACTION_DIGITS),'" width="',toFixed(charWidth,NUM_FRACTION_DIGITS),'" height="',toFixed(heightOfLine/this.lineHeight,NUM_FRACTION_DIGITS),'"></rect>\n'].join("")},_createTextCharSpan:function(_char,styleDecl,lineLeftOffset,lineTopOffset,charOffset){var fillStyles=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text",getSvgFilter:fabric.Object.prototype.getSvgFilter},styleDecl));return['			<tspan x="',toFixed(lineLeftOffset+charOffset,NUM_FRACTION_DIGITS),'" y="',toFixed(lineTopOffset-this.height/2,NUM_FRACTION_DIGITS),'" ',styleDecl.fontFamily?'font-family="'+styleDecl.fontFamily.replace(/"/g,"'")+'" ':"",styleDecl.fontSize?'font-size="'+styleDecl.fontSize+'" ':"",styleDecl.fontStyle?'font-style="'+styleDecl.fontStyle+'" ':"",styleDecl.fontWeight?'font-weight="'+styleDecl.fontWeight+'" ':"",styleDecl.textDecoration?'text-decoration="'+styleDecl.textDecoration+'" ':"",'style="',fillStyles,'">',fabric.util.string.escapeXml(_char),"</tspan>\n"].join("")}})}(),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),clone=fabric.util.object.clone;fabric.Textbox=fabric.util.createClass(fabric.IText,fabric.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:0,__cachedLines:null,lockScalingY:!0,lockScalingFlip:!0,initialize:function(text,options){this.ctx=fabric.util.createCanvasElement().getContext("2d"),this.callSuper("initialize",text,options),this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility()),this._dimensionAffectingProps.width=!0},_initDimensions:function(ctx){this.__skipDimension||(ctx||(ctx=fabric.util.createCanvasElement().getContext("2d"),this._setTextStyles(ctx)),this.dynamicMinWidth=0,this._textLines=this._splitTextIntoLines(),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this._clearCache(),this.height=this._getTextHeight(ctx))},_generateStyleMap:function(){for(var realLineCount=0,realLineCharCount=0,charCount=0,map={},i=0;i<this._textLines.length;i++)"\n"===this.text[charCount]?(realLineCharCount=0,charCount++,realLineCount++):" "===this.text[charCount]&&(realLineCharCount++,charCount++),map[i]={line:realLineCount,offset:realLineCharCount},charCount+=this._textLines[i].length,realLineCharCount+=this._textLines[i].length;return map},_getStyleDeclaration:function(lineIndex,charIndex,returnCloneOrEmpty){if(this._styleMap){var map=this._styleMap[lineIndex];if(!map)return returnCloneOrEmpty?{}:null;lineIndex=map.line,charIndex=map.offset+charIndex}return this.callSuper("_getStyleDeclaration",lineIndex,charIndex,returnCloneOrEmpty)},_setStyleDeclaration:function(lineIndex,charIndex,style){var map=this._styleMap[lineIndex];lineIndex=map.line,charIndex=map.offset+charIndex,this.styles[lineIndex][charIndex]=style},_deleteStyleDeclaration:function(lineIndex,charIndex){var map=this._styleMap[lineIndex];lineIndex=map.line,charIndex=map.offset+charIndex,delete this.styles[lineIndex][charIndex]},_getLineStyle:function(lineIndex){var map=this._styleMap[lineIndex];return this.styles[map.line]},_setLineStyle:function(lineIndex,style){var map=this._styleMap[lineIndex];this.styles[map.line]=style},_deleteLineStyle:function(lineIndex){var map=this._styleMap[lineIndex];delete this.styles[map.line]},_wrapText:function(ctx,text){var i,lines=text.split(this._reNewline),wrapped=[];for(i=0;i<lines.length;i++)wrapped=wrapped.concat(this._wrapLine(ctx,lines[i],i));return wrapped},_measureText:function(ctx,text,lineIndex,charOffset){var width=0;charOffset=charOffset||0;for(var i=0,len=text.length;len>i;i++)width+=this._getWidthOfChar(ctx,text[i],lineIndex,i+charOffset);return width},_wrapLine:function(ctx,text,lineIndex){for(var lineWidth=0,lines=[],line="",words=text.split(" "),word="",offset=0,infix=" ",wordWidth=0,infixWidth=0,largestWordWidth=0,lineJustStarted=!0,i=0;i<words.length;i++)word=words[i],wordWidth=this._measureText(ctx,word,lineIndex,offset),offset+=word.length,lineWidth+=infixWidth+wordWidth,lineWidth>=this.width&&!lineJustStarted&&(lines.push(line),line="",lineWidth=wordWidth,lineJustStarted=!0),lineJustStarted||(line+=infix),line+=word,infixWidth=this._measureText(ctx,infix,lineIndex,offset),offset++,lineJustStarted=!1,wordWidth>largestWordWidth&&(largestWordWidth=wordWidth);return i&&lines.push(line),largestWordWidth>this.dynamicMinWidth&&(this.dynamicMinWidth=largestWordWidth),lines},_splitTextIntoLines:function(){var originalAlign=this.textAlign;this.ctx.save(),this._setTextStyles(this.ctx),this.textAlign="left";var lines=this._wrapText(this.ctx,this.text);return this.textAlign=originalAlign,this.ctx.restore(),this._textLines=lines,this._styleMap=this._generateStyleMap(),lines},setOnGroup:function(key,value){"scaleX"===key&&(this.set("scaleX",Math.abs(1/value)),this.set("width",this.get("width")*value/("undefined"==typeof this.__oldScaleX?1:this.__oldScaleX)),this.__oldScaleX=value)},get2DCursorLocation:function(selectionStart){"undefined"==typeof selectionStart&&(selectionStart=this.selectionStart);for(var numLines=this._textLines.length,removed=0,i=0;numLines>i;i++){var line=this._textLines[i],lineLen=line.length;if(removed+lineLen>=selectionStart)return{lineIndex:i,charIndex:selectionStart-removed};removed+=lineLen,"\n"!==this.text[removed]&&" "!==this.text[removed]||removed++}return{lineIndex:numLines-1,charIndex:this._textLines[numLines-1].length}},_getCursorBoundariesOffsets:function(chars,typeOfBoundaries){for(var topOffset=0,leftOffset=0,cursorLocation=this.get2DCursorLocation(),lineChars=this._textLines[cursorLocation.lineIndex].split(""),lineLeftOffset=this._getLineLeftOffset(this._getLineWidth(this.ctx,cursorLocation.lineIndex)),i=0;i<cursorLocation.charIndex;i++)leftOffset+=this._getWidthOfChar(this.ctx,lineChars[i],cursorLocation.lineIndex,i);for(i=0;i<cursorLocation.lineIndex;i++)topOffset+=this._getHeightOfLine(this.ctx,i);return"cursor"===typeOfBoundaries&&(topOffset+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,cursorLocation.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(cursorLocation.lineIndex,cursorLocation.charIndex)*(1-this._fontSizeFraction)),{top:topOffset,left:leftOffset,lineLeft:lineLeftOffset}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(propertiesToInclude){return fabric.util.object.extend(this.callSuper("toObject",propertiesToInclude),{minWidth:this.minWidth})}}),fabric.Textbox.fromObject=function(object){return new fabric.Textbox(object.text,clone(object))},fabric.Textbox.getTextboxControlVisibility=function(){return{tl:!1,tr:!1,br:!1,bl:!1,ml:!0,mt:!1,mr:!0,mb:!1,mtr:!0}},fabric.Textbox.instances=[]}(exports),function(){var setObjectScaleOverridden=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(localMouse,transform,lockScalingX,lockScalingY,by,lockScalingFlip,_dim){var t=transform.target;if(!(t instanceof fabric.Textbox))return setObjectScaleOverridden.call(fabric.Canvas.prototype,localMouse,transform,lockScalingX,lockScalingY,by,lockScalingFlip,_dim);var w=t.width*(localMouse.x/transform.scaleX/(t.width+t.strokeWidth));return w>=t.getMinWidth()?(t.set("width",w),!0):void 0},fabric.Group.prototype._refreshControlsVisibility=function(){if("undefined"!=typeof fabric.Textbox)for(var i=this._objects.length;i--;)if(this._objects[i]instanceof fabric.Textbox)return void this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility());
};var clone=fabric.util.object.clone;fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var prop in this._styleMap)this._textLines[prop]||delete this.styles[this._styleMap[prop].line]},insertCharStyleObject:function(lineIndex,charIndex,style){var map=this._styleMap[lineIndex];lineIndex=map.line,charIndex=map.offset+charIndex,fabric.IText.prototype.insertCharStyleObject.apply(this,[lineIndex,charIndex,style])},insertNewlineStyleObject:function(lineIndex,charIndex,isEndOfLine){var map=this._styleMap[lineIndex];lineIndex=map.line,charIndex=map.offset+charIndex,fabric.IText.prototype.insertNewlineStyleObject.apply(this,[lineIndex,charIndex,isEndOfLine])},shiftLineStyles:function(lineIndex,offset){var clonedStyles=clone(this.styles),map=this._styleMap[lineIndex];lineIndex=map.line;for(var line in this.styles){var numericLine=parseInt(line,10);numericLine>lineIndex&&(this.styles[numericLine+offset]=clonedStyles[numericLine],clonedStyles[numericLine-offset]||delete this.styles[numericLine])}},_getTextOnPreviousLine:function(lIndex){for(var textOnPreviousLine=this._textLines[lIndex-1];this._styleMap[lIndex-2]&&this._styleMap[lIndex-2].line===this._styleMap[lIndex-1].line;)textOnPreviousLine=this._textLines[lIndex-2]+textOnPreviousLine,lIndex--;return textOnPreviousLine},removeStyleObject:function(isBeginningOfLine,index){var cursorLocation=this.get2DCursorLocation(index),map=this._styleMap[cursorLocation.lineIndex],lineIndex=map.line,charIndex=map.offset+cursorLocation.charIndex;this._removeStyleObject(isBeginningOfLine,cursorLocation,lineIndex,charIndex)}})}(),function(){var override=fabric.IText.prototype._getNewSelectionStartFromOffset;fabric.IText.prototype._getNewSelectionStartFromOffset=function(mouseOffset,prevWidth,width,index,jlen){index=override.call(this,mouseOffset,prevWidth,width,index,jlen);for(var tmp=0,removed=0,i=0;i<this._textLines.length&&(tmp+=this._textLines[i].length,!(tmp+removed>=index));i++)"\n"!==this.text[tmp+removed]&&" "!==this.text[tmp+removed]||removed++;return index-i+removed}}(),function(){function request(url,encoding,callback){var oURL=URL.parse(url);oURL.port||(oURL.port=0===oURL.protocol.indexOf("https:")?443:80);var reqHandler=0===oURL.protocol.indexOf("https:")?HTTPS:HTTP,req=reqHandler.request({hostname:oURL.hostname,port:oURL.port,path:oURL.path,method:"GET"},function(response){var body="";encoding&&response.setEncoding(encoding),response.on("end",function(){callback(body)}),response.on("data",function(chunk){200===response.statusCode&&(body+=chunk)})});req.on("error",function(err){err.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+oURL.hostname+":"+oURL.port):fabric.log(err.message),callback(null)}),req.end()}function requestFs(path,callback){var fs=__webpack_require__(38);fs.readFile(path,function(err,data){if(err)throw fabric.log(err),err;callback(data)})}if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=__webpack_require__(40).DOMParser,URL=__webpack_require__(15),HTTP=__webpack_require__(11),HTTPS=__webpack_require__(22),Canvas=__webpack_require__(10),Image=__webpack_require__(10).Image;fabric.util.loadImage=function(url,callback,context){function createImageAndCallBack(data){data?(img.src=new Buffer(data,"binary"),img._src=url,callback&&callback.call(context,img)):(img=null,callback&&callback.call(context,null,!0))}var img=new Image;url&&(url instanceof Buffer||0===url.indexOf("data"))?(img.src=img._src=url,callback&&callback.call(context,img)):url&&0!==url.indexOf("http")?requestFs(url,createImageAndCallBack):url?request(url,"binary",createImageAndCallBack):callback&&callback.call(context,url)},fabric.loadSVGFromURL=function(url,callback,reviver){url=url.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),0!==url.indexOf("http")?requestFs(url,function(body){fabric.loadSVGFromString(body.toString(),callback,reviver)}):request(url,"",function(body){fabric.loadSVGFromString(body,callback,reviver)})},fabric.loadSVGFromString=function(string,callback,reviver){var doc=(new DOMParser).parseFromString(string);fabric.parseSVGDocument(doc.documentElement,function(results,options){callback&&callback(results,options)},reviver)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.Image.fromObject=function(object,callback){fabric.util.loadImage(object.src,function(img){var oImg=new fabric.Image(img);oImg._initConfig(object),oImg._initFilters(object.filters,function(filters){oImg.filters=filters||[],oImg._initFilters(object.resizeFilters,function(resizeFilters){oImg.resizeFilters=resizeFilters||[],callback&&callback(oImg)})})})},fabric.createCanvasForNode=function(width,height,options,nodeCanvasOptions){nodeCanvasOptions=nodeCanvasOptions||options;var canvasEl=fabric.document.createElement("canvas"),nodeCanvas=new Canvas(width||600,height||600,nodeCanvasOptions);canvasEl.style={},canvasEl.width=nodeCanvas.width,canvasEl.height=nodeCanvas.height;var FabricCanvas=fabric.Canvas||fabric.StaticCanvas,fabricCanvas=new FabricCanvas(canvasEl,options);return fabricCanvas.contextContainer=nodeCanvas.getContext("2d"),fabricCanvas.nodeCanvas=nodeCanvas,fabricCanvas.Font=Canvas.Font,fabricCanvas},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(opts){return this.nodeCanvas.createJPEGStream(opts)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(width,options){return origSetWidth.call(this,width,options),this.nodeCanvas.width=width,this},fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(height,options){return origSetHeight.call(this,height,options),this.nodeCanvas.height=height,this},fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}()}).call(exports,__webpack_require__(3).Buffer,__webpack_require__(4))},function(module,exports,__webpack_require__){var Stream=__webpack_require__(5),Response=__webpack_require__(21),Base64=__webpack_require__(16),inherits=__webpack_require__(1),Request=module.exports=function(xhr,params){var self=this;self.writable=!0,self.xhr=xhr,self.body=[],self.uri=(params.protocol||"http:")+"//"+params.host+(params.port?":"+params.port:"")+(params.path||"/"),"undefined"==typeof params.withCredentials&&(params.withCredentials=!0);try{xhr.withCredentials=params.withCredentials}catch(e){}if(params.responseType)try{xhr.responseType=params.responseType}catch(e){}if(xhr.open(params.method||"GET",self.uri,!0),xhr.onerror=function(event){self.emit("error",new Error("Network error"))},self._headers={},params.headers)for(var keys=objectKeys(params.headers),i=0;i<keys.length;i++){var key=keys[i];if(self.isSafeRequestHeader(key)){var value=params.headers[key];self.setHeader(key,value)}}params.auth&&this.setHeader("Authorization","Basic "+Base64.btoa(params.auth));var res=new Response;res.on("close",function(){self.emit("close")}),res.on("ready",function(){self.emit("response",res)}),res.on("error",function(err){self.emit("error",err)}),xhr.onreadystatechange=function(){xhr.__aborted||res.handle(xhr)}};inherits(Request,Stream),Request.prototype.setHeader=function(key,value){this._headers[key.toLowerCase()]=value},Request.prototype.getHeader=function(key){return this._headers[key.toLowerCase()]},Request.prototype.removeHeader=function(key){delete this._headers[key.toLowerCase()]},Request.prototype.write=function(s){this.body.push(s)},Request.prototype.destroy=function(s){this.xhr.__aborted=!0,this.xhr.abort(),this.emit("close")},Request.prototype.end=function(s){void 0!==s&&this.body.push(s);for(var keys=objectKeys(this._headers),i=0;i<keys.length;i++){var key=keys[i],value=this._headers[key];if(isArray(value))for(var j=0;j<value.length;j++)this.xhr.setRequestHeader(key,value[j]);else this.xhr.setRequestHeader(key,value)}if(0===this.body.length)this.xhr.send("");else if("string"==typeof this.body[0])this.xhr.send(this.body.join(""));else if(isArray(this.body[0])){for(var body=[],i=0;i<this.body.length;i++)body.push.apply(body,this.body[i]);this.xhr.send(body)}else if(/Array/.test(Object.prototype.toString.call(this.body[0]))){for(var len=0,i=0;i<this.body.length;i++)len+=this.body[i].length;for(var body=new this.body[0].constructor(len),k=0,i=0;i<this.body.length;i++)for(var b=this.body[i],j=0;j<b.length;j++)body[k++]=b[j];this.xhr.send(body)}else if(isXHR2Compatible(this.body[0]))this.xhr.send(this.body[0]);else{for(var body="",i=0;i<this.body.length;i++)body+=this.body[i].toString();this.xhr.send(body)}},Request.unsafeHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"],Request.prototype.isSafeRequestHeader=function(headerName){return headerName?-1===indexOf(Request.unsafeHeaders,headerName.toLowerCase()):!1};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys},isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)},indexOf=function(xs,x){if(xs.indexOf)return xs.indexOf(x);for(var i=0;i<xs.length;i++)if(xs[i]===x)return i;return-1},isXHR2Compatible=function(obj){return"undefined"!=typeof Blob&&obj instanceof Blob?!0:"undefined"!=typeof ArrayBuffer&&obj instanceof ArrayBuffer?!0:"undefined"!=typeof FormData&&obj instanceof FormData?!0:void 0}},function(module,exports,__webpack_require__){function parseHeaders(res){for(var lines=res.getAllResponseHeaders().split(/\r?\n/),headers={},i=0;i<lines.length;i++){var line=lines[i];if(""!==line){var m=line.match(/^([^:]+):\s*(.*)/);if(m){var key=m[1].toLowerCase(),value=m[2];void 0!==headers[key]?isArray(headers[key])?headers[key].push(value):headers[key]=[headers[key],value]:headers[key]=value}else headers[line]=!0}}return headers}var Stream=__webpack_require__(5),util=__webpack_require__(36),Response=module.exports=function(res){this.offset=0,this.readable=!0};util.inherits(Response,Stream);var capable={streaming:!0,status2:!0};Response.prototype.getResponse=function(xhr){var respType=String(xhr.responseType).toLowerCase();return"blob"===respType?xhr.responseBlob||xhr.response:"arraybuffer"===respType?xhr.response:xhr.responseText},Response.prototype.getHeader=function(key){return this.headers[key.toLowerCase()]},Response.prototype.handle=function(res){if(2===res.readyState&&capable.status2){try{this.statusCode=res.status,this.headers=parseHeaders(res)}catch(err){capable.status2=!1}capable.status2&&this.emit("ready")}else if(capable.streaming&&3===res.readyState){try{this.statusCode||(this.statusCode=res.status,this.headers=parseHeaders(res),this.emit("ready"))}catch(err){}try{this._emitData(res)}catch(err){capable.streaming=!1}}else 4===res.readyState&&(this.statusCode||(this.statusCode=res.status,this.emit("ready")),this._emitData(res),res.error?this.emit("error",this.getResponse(res)):this.emit("end"),this.emit("close"))},Response.prototype._emitData=function(res){var respBody=this.getResponse(res);return respBody.toString().match(/ArrayBuffer/)?(this.emit("data",new Uint8Array(respBody,this.offset)),void(this.offset=respBody.byteLength)):void(respBody.length>this.offset&&(this.emit("data",respBody.slice(this.offset)),this.offset=respBody.length))};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},function(module,exports,__webpack_require__){var http=__webpack_require__(11),https=module.exports;for(var key in http)http.hasOwnProperty(key)&&(https[key]=http[key]);https.request=function(params,cb){return params||(params={}),params.scheme="https",http.request.call(this,params,cb)}},function(module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:(s?-1:1)*(1/0);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=0>value||0===value&&0>1/value?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},function(module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},function(module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;len>i;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?Array.isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj}},function(module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?Object.keys(obj).map(function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return Array.isArray(obj[k])?obj[k].map(function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""}},function(module,exports,__webpack_require__){"use strict";exports.decode=exports.parse=__webpack_require__(25),exports.encode=exports.stringify=__webpack_require__(26)},function(module,exports){module.exports=Array.isArray||function(arr){return"[object Array]"==Object.prototype.toString.call(arr)}},function(module,exports,__webpack_require__){module.exports=__webpack_require__(2)},function(module,exports,__webpack_require__){module.exports=__webpack_require__(12)},function(module,exports,__webpack_require__){(function(process){exports=module.exports=__webpack_require__(13),exports.Stream=__webpack_require__(5),exports.Readable=exports,exports.Writable=__webpack_require__(9),exports.Duplex=__webpack_require__(2),exports.Transform=__webpack_require__(8),exports.PassThrough=__webpack_require__(12),process.browser||"disable"!==process.env.READABLE_STREAM||(module.exports=__webpack_require__(5))}).call(exports,__webpack_require__(4))},function(module,exports,__webpack_require__){module.exports=__webpack_require__(8)},function(module,exports,__webpack_require__){module.exports=__webpack_require__(9)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;(function(module,global){!function(root){function error(type){throw RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";parts.length>1&&(result=parts[0]+"@",string=parts[1]),string=string.replace(regexSeparators,".");var labels=string.split("."),encoded=map(labels,fn).join(".");return result+encoded}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;length>counter;)value=string.charCodeAt(counter++),value>=55296&&56319>=value&&length>counter?(extra=string.charCodeAt(counter++),56320==(64512&extra)?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--)):output.push(value);return output}function ucs2encode(array){return map(array,function(value){var output="";return value>65535&&(value-=65536,output+=stringFromCharCode(value>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)}).join("")}function basicToDigit(codePoint){return 10>codePoint-48?codePoint-22:26>codePoint-65?codePoint-65:26>codePoint-97?codePoint-97:base}function digitToBasic(digit,flag){return digit+22+75*(26>digit)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/damp):delta>>1,delta+=floor(delta/numPoints);delta>baseMinusTMin*tMax>>1;k+=base)delta=floor(delta/baseMinusTMin);return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,output=[],inputLength=input.length,i=0,n=initialN,bias=initialBias;for(basic=input.lastIndexOf(delimiter),0>basic&&(basic=0),j=0;basic>j;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;inputLength>index;){for(oldi=i,w=1,k=base;index>=inputLength&&error("invalid-input"),digit=basicToDigit(input.charCodeAt(index++)),(digit>=base||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,t=bias>=k?tMin:k>=bias+tMax?tMax:k-bias,!(t>digit);k+=base)baseMinusT=base-t,w>floor(maxInt/baseMinusT)&&error("overflow"),w*=baseMinusT;out=output.length+1,bias=adapt(i-oldi,out,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(input=ucs2decode(input),inputLength=input.length,n=initialN,delta=0,bias=initialBias,j=0;inputLength>j;++j)currentValue=input[j],128>currentValue&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push(delimiter);inputLength>handledCPCount;){for(m=maxInt,j=0;inputLength>j;++j)currentValue=input[j],currentValue>=n&&m>currentValue&&(m=currentValue);for(handledCPCountPlusOne=handledCPCount+1,m-n>floor((maxInt-delta)/handledCPCountPlusOne)&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;inputLength>j;++j)if(currentValue=input[j],n>currentValue&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=base;t=bias>=k?tMin:k>=bias+tMax?tMax:k-bias,!(t>q);k+=base)qMinusT=q-t,baseMinusT=base-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}var freeGlobal=("object"==typeof exports&&exports&&!exports.nodeType&&exports,"object"==typeof module&&module&&!module.nodeType&&module,"object"==typeof global&&global);freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal);var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;punycode={version:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode},__WEBPACK_AMD_DEFINE_RESULT__=function(){return punycode}.call(exports,__webpack_require__,exports,module),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(this)}).call(exports,__webpack_require__(37)(module),function(){return this}())},function(module,exports){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},function(module,exports,__webpack_require__){(function(global,process){function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=formatPrimitive(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=arrayToHash(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(0>recurseTimes)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?formatArray(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;l>i;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if(desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]},desc.get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1),str.indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n"))):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;name=JSON.stringify(""+key),name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0,length=output.reduce(function(prev,cur){return numLinesEst++,cur.indexOf("\n")>=0&&numLinesEst++,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);return length>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||"undefined"==typeof arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return 10>n?"0"+n.toString(10):n.toString(10)}function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}for(var i=1,args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];len>i;x=args[++i])str+=isNull(x)||!isObject(x)?" "+x:" "+inspect(x);return str},exports.deprecate=function(fn,msg){function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(process.noDeprecation===!0)return fn;var warned=!1;return deprecated};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=__webpack_require__(35);var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=__webpack_require__(1),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(exports,function(){return this}(),__webpack_require__(4))},function(module,exports){module.exports=function(module){return module.webpackPolyfill||(module.deprecate=function(){},module.paths=[],module.children=[],module.webpackPolyfill=1),module}},10,10,10,10]));